2025-05-15 17:16:10 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 5824
2025-05-15 17:16:10 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 17:16:10 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 17:16:10 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:16:10 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 17:16:10 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 17:16:10 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11599
2025-05-15 17:16:10 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 17:16:10 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 17:16:10 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:16:10 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 17:16:10 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 17:16:10 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11230
2025-05-15 17:16:10 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 17:16:10 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 17:16:10 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:16:10 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 17:16:10 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 17:16:10 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 17:16:10 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:16:10 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 17:16:10 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 17:16:12 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55934
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11599
2025-05-15 17:16:12 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11599, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 17:16:12 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 17:16:12 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:16:12 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:16:12 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11599, deviceId=1
2025-05-15 17:16:12 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:16:12 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:16:12 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 17:16:12 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 17:16:12 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:16:12 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55935
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11230
2025-05-15 17:16:12 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11230, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:16:12 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 17:16:12 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 17:16:12 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 17:16:12 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 17:16:12 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11599, deviceId=1
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:16:12 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:16:12 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:16:12 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11230, deviceId=1
2025-05-15 17:16:12 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 17:16:12 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:16:12 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:16:12 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:16:12 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 17:16:12 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 17:16:12 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:16:12 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 17:16:12 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:16:12 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 17:16:12 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11230, deviceId=1
2025-05-15 17:16:12 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:16:12 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 17:16:12 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 17:16:12 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:16:12 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5824
2025-05-15 17:16:12 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 17:16:12 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 17:16:12 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 17:16:12 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 17:16:12 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 17:16:12 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 17:16:12 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 17:16:12 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:16:12 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5824
2025-05-15 17:16:12 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 17:16:12 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 17:16:12 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 17:16:12 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 17:16:12 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 17:19:21 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3447
2025-05-15 17:19:21 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 17:19:21 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 17:19:21 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:19:21 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 17:19:21 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 17:19:21 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14005
2025-05-15 17:19:21 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 17:19:21 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 17:19:21 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:19:21 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 17:19:21 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 17:19:21 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1948
2025-05-15 17:19:21 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 17:19:21 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 17:19:21 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:19:21 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 17:19:21 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 17:19:21 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 17:19:21 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:19:21 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 17:19:21 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 17:19:23 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55946
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14005
2025-05-15 17:19:23 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=14005, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 17:19:23 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 17:19:23 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:19:23 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:19:23 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=14005, deviceId=1
2025-05-15 17:19:23 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:19:23 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:19:23 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 17:19:23 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 17:19:23 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:19:23 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55947
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1948
2025-05-15 17:19:23 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1948, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 17:19:23 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:19:23 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 17:19:23 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 17:19:23 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 17:19:23 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=14005, deviceId=1
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:19:23 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:19:23 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:19:23 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1948, deviceId=1
2025-05-15 17:19:23 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 17:19:23 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:19:23 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:19:23 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:19:23 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 17:19:23 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 17:19:23 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:19:23 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:19:23 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 17:19:23 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 17:19:23 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1948, deviceId=1
2025-05-15 17:19:23 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:19:23 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 17:19:23 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 17:19:23 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:19:23 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3447
2025-05-15 17:19:23 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 17:19:23 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 17:19:23 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 17:19:23 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 17:19:23 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 17:19:23 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 17:19:23 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 17:19:23 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:19:23 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3447
2025-05-15 17:19:23 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 17:19:23 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 17:19:23 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 17:19:23 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 17:19:23 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 17:20:42.972 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 17:20:43.039 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1703
2025-05-15 17:20:43.041 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 17:20:43.063 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 17:20:43.064 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 17:20:43.064 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:20:43.065 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 17:20:43.070 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 17:20:43.070 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 17:20:43.071 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 17:20:43.071 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9347
2025-05-15 17:20:43.072 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 17:20:43.072 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 17:20:43.073 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 17:20:43.073 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:20:43.073 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 17:20:43.075 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 17:20:43.075 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 17:20:43.075 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:20:43.076 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10254
2025-05-15 17:20:43.076 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 17:20:43.076 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 17:20:43.076 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 17:20:43.077 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:20:43.077 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 17:20:43.078 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 17:20:43.078 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 17:20:43.078 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:20:43.080 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 17:20:43.083 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 17:20:45.095 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55955
2025-05-15 17:20:45.104 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9347
2025-05-15 17:20:45.106 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9347, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:20:45.107 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 17:20:45.107 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 17:20:45.107 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 17:20:45.107 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 17:20:45.107 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:20:45.108 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:20:45.108 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:20:45.109 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9347, deviceId=1
2025-05-15 17:20:45.110 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:20:45.111 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:20:45.135 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:20:45.138 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 17:20:45.138 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 17:20:45.138 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:20:45.139 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55956
2025-05-15 17:20:45.140 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10254
2025-05-15 17:20:45.140 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:20:45.140 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10254, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:20:45.140 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 17:20:45.140 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 17:20:45.141 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 17:20:45.141 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=9347, deviceId=1
2025-05-15 17:20:45.141 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 17:20:45.141 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 17:20:45.141 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:20:45.141 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:20:45.141 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:20:45.142 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 17:20:45.142 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:20:45.142 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10254, deviceId=1
2025-05-15 17:20:45.142 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:20:45.142 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:20:45.143 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:20:45.143 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 17:20:45.143 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 17:20:45.144 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:20:45.145 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 17:20:45.145 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:20:45.145 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 17:20:45.145 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10254, deviceId=1
2025-05-15 17:20:45.146 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:20:45.146 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 17:20:45.148 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 17:20:45.157 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:20:45.182 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1703
2025-05-15 17:20:45.182 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 17:20:45.183 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 17:20:45.183 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 17:20:45.183 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 17:20:45.183 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 17:20:45.183 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 17:20:45.184 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 17:20:45.185 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:20:45.186 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1703
2025-05-15 17:20:45.187 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 17:20:45.187 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 17:20:45.187 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 17:20:45.187 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 17:20:45.187 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 17:21:19.497 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 17:21:19.562 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15477
2025-05-15 17:21:19.565 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 17:21:19.587 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 17:21:19.587 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 17:21:19.587 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:21:19.587 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 17:21:19.592 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 17:21:19.592 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 17:21:19.592 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 17:21:19.593 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4
2025-05-15 17:21:19.593 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 17:21:19.594 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 17:21:19.594 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 17:21:19.595 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:21:19.595 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 17:21:19.596 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 17:21:19.596 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 17:21:19.596 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:21:19.597 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4755
2025-05-15 17:21:19.597 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 17:21:19.598 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 17:21:19.598 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 17:21:19.598 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:21:19.598 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 17:21:19.599 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 17:21:19.600 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 17:21:19.600 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:21:19.603 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 17:21:19.607 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 17:21:21.616 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55961
2025-05-15 17:21:21.626 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4
2025-05-15 17:21:21.628 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:21:21.629 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 17:21:21.629 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 17:21:21.629 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 17:21:21.629 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 17:21:21.630 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:21:21.630 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:21:21.630 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:21:21.631 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4, deviceId=1
2025-05-15 17:21:21.631 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:21:21.632 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:21:21.658 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:21:21.662 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 17:21:21.662 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 17:21:21.662 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:21:21.663 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55962
2025-05-15 17:21:21.663 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4755
2025-05-15 17:21:21.664 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4755, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:21:21.664 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:21:21.664 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 17:21:21.665 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 17:21:21.665 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 17:21:21.665 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 17:21:21.665 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4, deviceId=1
2025-05-15 17:21:21.665 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 17:21:21.666 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:21:21.666 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:21:21.666 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:21:21.666 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:21:21.666 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4755, deviceId=1
2025-05-15 17:21:21.667 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 17:21:21.667 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:21:21.667 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:21:21.668 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:21:21.669 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 17:21:21.669 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 17:21:21.669 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:21:21.669 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 17:21:21.670 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:21:21.670 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 17:21:21.670 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4755, deviceId=1
2025-05-15 17:21:21.671 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:21:21.671 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 17:21:21.673 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 17:21:21.682 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:21:21.707 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15477
2025-05-15 17:21:21.707 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 17:21:21.707 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 17:21:21.707 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 17:21:21.708 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 17:21:21.708 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 17:21:21.708 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 17:21:21.708 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 17:21:21.709 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:21:21.711 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15477
2025-05-15 17:21:21.711 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 17:21:21.712 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 17:21:21.712 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 17:21:21.712 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 17:21:21.712 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 17:23:13.332 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 17:23:13.397 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14866
2025-05-15 17:23:13.399 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 17:23:13.420 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 17:23:13.420 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 17:23:13.421 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:23:13.421 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 17:23:13.425 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 17:23:13.426 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 17:23:13.426 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 17:23:13.427 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4691
2025-05-15 17:23:13.427 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 17:23:13.428 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 17:23:13.428 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 17:23:13.428 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:23:13.428 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 17:23:13.429 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 17:23:13.430 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 17:23:13.430 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:23:13.431 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9902
2025-05-15 17:23:13.431 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 17:23:13.431 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 17:23:13.432 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 17:23:13.432 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:23:13.433 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 17:23:13.434 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 17:23:13.434 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 17:23:13.434 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:23:13.436 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 17:23:13.439 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 17:23:15.454 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55969
2025-05-15 17:23:15.459 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4691
2025-05-15 17:23:15.460 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4691, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 17:23:15.461 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 17:23:15.461 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 17:23:15.461 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 17:23:15.461 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 17:23:15.462 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:23:15.462 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:23:15.462 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:23:15.463 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4691, deviceId=1
2025-05-15 17:23:15.463 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:23:15.463 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:23:15.491 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:23:15.494 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 17:23:15.494 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 17:23:15.494 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:23:15.495 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:55970
2025-05-15 17:23:15.495 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9902
2025-05-15 17:23:15.496 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9902, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 17:23:15.496 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:23:15.496 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 17:23:15.496 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 17:23:15.496 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 17:23:15.496 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 17:23:15.496 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 17:23:15.497 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4691, deviceId=1
2025-05-15 17:23:15.497 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:23:15.497 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 17:23:15.497 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:23:15.497 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 17:23:15.498 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9902, deviceId=1
2025-05-15 17:23:15.498 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 17:23:15.498 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 17:23:15.498 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 17:23:15.499 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 17:23:15.499 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 17:23:15.499 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 17:23:15.500 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 17:23:15.500 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 17:23:15.501 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 17:23:15.501 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 17:23:15.501 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=9902, deviceId=1
2025-05-15 17:23:15.501 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 17:23:15.502 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 17:23:15.504 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 17:23:15.515 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:23:15.536 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14866
2025-05-15 17:23:15.537 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 17:23:15.537 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 17:23:15.537 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 17:23:15.537 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 17:23:15.537 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 17:23:15.538 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 17:23:15.538 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 17:23:15.539 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 17:23:15.540 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14866
2025-05-15 17:23:15.540 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 17:23:15.541 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 17:23:15.541 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 17:23:15.541 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 17:23:15.541 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 18:00:43.050 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 18:00:43.114 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10185
2025-05-15 18:00:43.116 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 18:00:43.139 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 18:00:43.139 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 18:00:43.140 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:00:43.140 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 18:00:43.144 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 18:00:43.145 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 18:00:43.145 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 18:00:43.146 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 378
2025-05-15 18:00:43.146 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 18:00:43.147 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 18:00:43.147 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 18:00:43.147 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:00:43.147 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 18:00:43.149 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 18:00:43.149 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 18:00:43.149 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:00:43.150 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10049
2025-05-15 18:00:43.150 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 18:00:43.151 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 18:00:43.151 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 18:00:43.151 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:00:43.151 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 18:00:43.152 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 18:00:43.153 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 18:00:43.153 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:00:43.155 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 18:00:43.158 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 18:00:45.170 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56217
2025-05-15 18:00:45.175 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 378
2025-05-15 18:00:45.176 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=378, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:00:45.177 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 18:00:45.177 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 18:00:45.177 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 18:00:45.177 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 18:00:45.178 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:00:45.178 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:00:45.179 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:00:45.179 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=378, deviceId=1
2025-05-15 18:00:45.180 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:00:45.180 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:00:45.204 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:00:45.207 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 18:00:45.207 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 18:00:45.207 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:00:45.208 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56218
2025-05-15 18:00:45.208 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10049
2025-05-15 18:00:45.208 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10049, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:00:45.209 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 18:00:45.209 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:00:45.209 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 18:00:45.209 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 18:00:45.209 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 18:00:45.209 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 18:00:45.210 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=378, deviceId=1
2025-05-15 18:00:45.210 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:00:45.210 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:00:45.210 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:00:45.210 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:00:45.210 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10049, deviceId=1
2025-05-15 18:00:45.210 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 18:00:45.211 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:00:45.211 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:00:45.211 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:00:45.212 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 18:00:45.212 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 18:00:45.212 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 18:00:45.213 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:00:45.213 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:00:45.214 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 18:00:45.214 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10049, deviceId=1
2025-05-15 18:00:45.214 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:00:45.215 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 18:00:45.216 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 18:00:45.226 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:00:45.251 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10185
2025-05-15 18:00:45.251 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 18:00:45.251 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 18:00:45.252 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 18:00:45.252 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 18:00:45.252 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 18:00:45.252 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 18:00:45.253 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 18:00:45.253 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:00:45.255 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10185
2025-05-15 18:00:45.255 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 18:00:45.255 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 18:00:45.255 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 18:00:45.256 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 18:00:45.256 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 18:09:00.418 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 18:09:00.489 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8078
2025-05-15 18:09:00.491 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 18:09:00.517 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 18:09:00.518 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 18:09:00.518 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:09:00.518 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 18:09:00.524 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 18:09:00.524 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 18:09:00.525 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 18:09:00.526 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11705
2025-05-15 18:09:00.526 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 18:09:00.527 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 18:09:00.527 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 18:09:00.528 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:09:00.528 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 18:09:00.531 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 18:09:00.532 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 18:09:00.532 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:09:00.533 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13449
2025-05-15 18:09:00.533 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 18:09:00.534 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 18:09:00.534 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 18:09:00.535 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:09:00.535 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 18:09:00.536 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 18:09:00.536 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 18:09:00.537 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:09:00.539 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 18:09:00.542 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 18:09:02.554 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56290
2025-05-15 18:09:02.558 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11705
2025-05-15 18:09:02.559 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11705, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:09:02.559 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 18:09:02.559 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 18:09:02.560 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 18:09:02.560 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 18:09:02.560 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:09:02.560 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:09:02.561 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:09:02.562 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11705, deviceId=1
2025-05-15 18:09:02.562 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:09:02.562 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:09:02.590 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:09:02.593 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 18:09:02.593 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 18:09:02.593 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:09:02.594 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56291
2025-05-15 18:09:02.595 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13449
2025-05-15 18:09:02.595 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=13449, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:09:02.595 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:09:02.595 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 18:09:02.595 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 18:09:02.595 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 18:09:02.595 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 18:09:02.595 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11705, deviceId=1
2025-05-15 18:09:02.595 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 18:09:02.596 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:09:02.596 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:09:02.596 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:09:02.596 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:09:02.596 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 18:09:02.596 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=13449, deviceId=1
2025-05-15 18:09:02.597 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:09:02.597 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:09:02.597 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:09:02.598 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 18:09:02.598 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 18:09:02.598 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 18:09:02.599 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:09:02.600 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:09:02.600 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 18:09:02.601 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=13449, deviceId=1
2025-05-15 18:09:02.602 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:09:02.602 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 18:09:02.606 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 18:09:02.613 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:09:02.632 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8078
2025-05-15 18:09:02.633 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 18:09:02.633 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 18:09:02.633 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 18:09:02.634 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 18:09:02.634 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 18:09:02.634 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 18:09:02.634 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 18:09:02.635 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:09:02.636 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8078
2025-05-15 18:09:02.637 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 18:09:02.637 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 18:09:02.637 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 18:09:02.637 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 18:09:02.637 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 18:10:41.573 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 18:10:41.666 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10452
2025-05-15 18:10:41.668 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 18:10:41.690 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 18:10:41.691 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 18:10:41.691 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:10:41.691 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 18:10:41.695 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 18:10:41.696 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 18:10:41.696 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 18:10:41.697 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8489
2025-05-15 18:10:41.697 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 18:10:41.698 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 18:10:41.698 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 18:10:41.698 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:10:41.699 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 18:10:41.700 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 18:10:41.700 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 18:10:41.700 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:10:41.701 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 508
2025-05-15 18:10:41.701 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 18:10:41.701 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 18:10:41.702 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 18:10:41.702 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:10:41.702 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 18:10:41.703 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 18:10:41.703 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 18:10:41.703 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:10:41.705 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 18:10:41.709 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 18:10:43.726 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56298
2025-05-15 18:10:43.736 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8489
2025-05-15 18:10:43.737 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8489, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:10:43.737 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 18:10:43.737 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 18:10:43.738 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 18:10:43.738 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 18:10:43.738 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:10:43.739 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:10:43.739 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:10:43.740 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8489, deviceId=1
2025-05-15 18:10:43.740 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:10:43.740 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:10:43.765 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:10:43.768 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 18:10:43.768 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 18:10:43.769 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:10:43.769 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56299
2025-05-15 18:10:43.770 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 508
2025-05-15 18:10:43.770 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=508, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:10:43.770 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:10:43.770 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 18:10:43.771 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 18:10:43.771 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 18:10:43.771 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 18:10:43.771 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8489, deviceId=1
2025-05-15 18:10:43.771 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 18:10:43.771 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:10:43.771 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:10:43.771 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:10:43.772 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:10:43.772 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 18:10:43.772 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=508, deviceId=1
2025-05-15 18:10:43.772 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:10:43.772 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:10:43.773 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:10:43.773 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 18:10:43.773 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 18:10:43.774 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:10:43.774 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 18:10:43.775 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:10:43.775 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 18:10:43.775 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=508, deviceId=1
2025-05-15 18:10:43.776 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:10:43.776 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 18:10:43.778 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 18:10:43.786 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:10:43.813 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10452
2025-05-15 18:10:43.814 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 18:10:43.814 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 18:10:43.814 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 18:10:43.814 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 18:10:43.814 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 18:10:43.814 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 18:10:43.815 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 18:10:43.816 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:10:43.817 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10452
2025-05-15 18:10:43.817 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 18:10:43.818 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 18:10:43.818 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 18:10:43.818 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 18:10:43.818 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 18:12:09.769 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 18:12:09.836 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4886
2025-05-15 18:12:09.838 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 18:12:09.860 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 18:12:09.860 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 18:12:09.860 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:12:09.861 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 18:12:09.865 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 18:12:09.865 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 18:12:09.866 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 18:12:09.866 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9274
2025-05-15 18:12:09.866 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 18:12:09.867 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 18:12:09.867 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 18:12:09.868 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:12:09.868 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 18:12:09.869 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 18:12:09.870 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 18:12:09.870 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:12:09.870 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11375
2025-05-15 18:12:09.871 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 18:12:09.871 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 18:12:09.871 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 18:12:09.871 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:12:09.872 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 18:12:09.872 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 18:12:09.873 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 18:12:09.873 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:12:09.875 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 18:12:09.879 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 18:12:11.896 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56303
2025-05-15 18:12:11.903 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9274
2025-05-15 18:12:11.904 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9274, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:12:11.905 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 18:12:11.906 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 18:12:11.906 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 18:12:11.906 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 18:12:11.907 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:12:11.907 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:12:11.907 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:12:11.908 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9274, deviceId=1
2025-05-15 18:12:11.908 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:12:11.908 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:12:11.935 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:12:11.938 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from peer: alice
2025-05-15 18:12:11.938 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 18:12:11.939 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:12:11.940 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56304
2025-05-15 18:12:11.941 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11375
2025-05-15 18:12:11.941 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:12:11.941 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11375, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:12:11.941 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 18:12:11.941 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 18:12:11.941 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for peer: alice
2025-05-15 18:12:11.942 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 18:12:11.942 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=9274, deviceId=1
2025-05-15 18:12:11.942 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 18:12:11.943 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:12:11.943 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:12:11.943 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:12:11.943 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:12:11.944 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11375, deviceId=1
2025-05-15 18:12:11.943 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 18:12:11.944 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:12:11.945 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:12:11.946 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:12:11.947 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 18:12:11.947 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from peer: bob
2025-05-15 18:12:11.947 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 18:12:11.947 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:12:11.948 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:12:11.948 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for peer: bob
2025-05-15 18:12:11.949 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11375, deviceId=1
2025-05-15 18:12:11.949 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:12:11.949 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 18:12:11.950 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 18:12:11.961 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:12:11.985 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4886
2025-05-15 18:12:11.985 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 18:12:11.985 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 18:12:11.985 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 18:12:11.986 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 18:12:11.986 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 18:12:11.986 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with peer: alice
2025-05-15 18:12:11.986 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 18:12:11.987 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:12:11.988 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4886
2025-05-15 18:12:11.989 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 18:12:11.989 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 18:12:11.989 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 18:12:11.990 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 18:12:11.990 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with peer: bob
2025-05-15 18:54:21.105 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 18:54:21.171 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 427
2025-05-15 18:54:21.173 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 18:54:21.195 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 18:54:21.195 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 18:54:21.195 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:54:21.196 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 18:54:21.200 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 18:54:21.200 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 18:54:21.201 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 18:54:21.201 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9982
2025-05-15 18:54:21.202 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 18:54:21.202 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 18:54:21.203 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 18:54:21.203 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:54:21.203 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 18:54:21.204 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 18:54:21.205 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 18:54:21.205 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:54:21.205 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4075
2025-05-15 18:54:21.206 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 18:54:21.206 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 18:54:21.206 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 18:54:21.207 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:54:21.207 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 18:54:21.208 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 18:54:21.209 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 18:54:21.209 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:54:21.212 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 18:54:21.216 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 18:54:23.226 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56467
2025-05-15 18:54:23.232 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9982
2025-05-15 18:54:23.233 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9982, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 18:54:23.234 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 18:54:23.235 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 18:54:23.235 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 18:54:23.235 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 18:54:23.235 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:54:23.235 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:54:23.236 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:54:23.237 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9982, deviceId=1
2025-05-15 18:54:23.237 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:54:23.237 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:54:23.262 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:54:23.265 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 18:54:23.265 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 18:54:23.266 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:54:23.266 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56468
2025-05-15 18:54:23.266 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4075
2025-05-15 18:54:23.266 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4075, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 18:54:23.267 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 18:54:23.267 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 18:54:23.267 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:54:23.267 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 18:54:23.268 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 18:54:23.268 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 18:54:23.268 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:54:23.268 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=9982, deviceId=1
2025-05-15 18:54:23.268 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 18:54:23.268 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 18:54:23.268 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:54:23.268 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4075, deviceId=1
2025-05-15 18:54:23.269 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 18:54:23.269 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 18:54:23.269 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:54:23.269 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:54:23.270 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 18:54:23.270 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 18:54:23.270 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:54:23.271 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:54:23.271 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 18:54:23.271 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 18:54:23.271 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4075, deviceId=1
2025-05-15 18:54:23.272 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:54:23.272 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 18:54:23.275 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 18:54:23.285 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:54:23.304 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 427
2025-05-15 18:54:23.305 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 18:54:23.305 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 18:54:23.305 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 18:54:23.306 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 18:54:23.306 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 18:54:23.306 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 18:54:23.306 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 18:54:23.306 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 18:54:23.306 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 18:54:23.307 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 18:54:23.307 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:54:23.307 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 18:54:23.308 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 18:54:23.308 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 18:54:23.308 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 18:54:23.308 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 427
2025-05-15 18:54:23.308 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4075, deviceId=1
2025-05-15 18:54:23.309 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 18:54:23.309 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 18:54:23.309 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 18:54:23.309 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 18:54:23.309 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 18:54:23.309 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 18:54:23.309 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 18:54:23.310 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 18:54:23.310 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 18:54:23.310 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 18:54:23.310 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 18:54:23.312 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9982
2025-05-15 18:54:23.313 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 18:54:23.313 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 18:54:23.313 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 18:54:23.313 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 18:54:23.313 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 18:54:23.314 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 18:54:23.314 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting message for recipient bob:1
2025-05-15 18:54:23.314 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 18:54:23.325 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 18:54:23.326 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 18:54:23.326 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 18:54:23.326 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 18:54:23.326 INFO  [main] c.s.c.l.SignalProtocolManager - Message encrypted for recipient bob:1
2025-05-15 18:54:23.328 DEBUG [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 18:54:23.328 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 18:54:23.328 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 18:54:23.329 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 18:54:23.329 DEBUG [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Decrypting message from sender alice:1
2025-05-15 18:54:23.330 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt message from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:58)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:138)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 18:54:23.332 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - From alice: null
2025-05-15 19:00:38.172 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 19:00:38.237 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11136
2025-05-15 19:00:38.239 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 19:00:38.262 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 19:00:38.263 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 19:00:38.263 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:00:38.263 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 19:00:38.269 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 19:00:38.270 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 19:00:38.270 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 19:00:38.271 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8718
2025-05-15 19:00:38.271 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 19:00:38.272 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 19:00:38.272 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 19:00:38.272 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:00:38.273 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 19:00:38.274 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 19:00:38.275 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 19:00:38.275 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:00:38.276 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14839
2025-05-15 19:00:38.276 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 19:00:38.277 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 19:00:38.277 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 19:00:38.277 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:00:38.277 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 19:00:38.278 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 19:00:38.279 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 19:00:38.279 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:00:38.283 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 19:00:38.286 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 19:00:40.290 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56485
2025-05-15 19:00:40.295 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8718
2025-05-15 19:00:40.296 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8718, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:00:40.297 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 19:00:40.297 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 19:00:40.298 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 19:00:40.298 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 19:00:40.298 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:00:40.298 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:00:40.299 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:00:40.300 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8718, deviceId=1
2025-05-15 19:00:40.300 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:00:40.301 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:00:40.325 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:00:40.328 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 19:00:40.328 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 19:00:40.328 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:00:40.328 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56486
2025-05-15 19:00:40.329 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14839
2025-05-15 19:00:40.329 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=14839, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:00:40.329 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 19:00:40.329 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 19:00:40.329 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:00:40.330 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 19:00:40.330 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 19:00:40.330 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:00:40.330 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 19:00:40.331 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:00:40.331 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8718, deviceId=1
2025-05-15 19:00:40.332 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:00:40.332 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=14839, deviceId=1
2025-05-15 19:00:40.332 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:00:40.332 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:00:40.332 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:00:40.332 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 19:00:40.333 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:00:40.333 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 19:00:40.333 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 19:00:40.333 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:00:40.334 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:00:40.334 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 19:00:40.334 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=14839, deviceId=1
2025-05-15 19:00:40.334 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 19:00:40.335 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:00:40.335 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:00:40.338 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 19:00:40.348 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:00:40.371 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11136
2025-05-15 19:00:40.371 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 19:00:40.371 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 19:00:40.372 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 19:00:40.372 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 19:00:40.372 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:00:40.372 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 19:00:40.372 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 19:00:40.373 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:00:40.373 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 19:00:40.373 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:00:40.373 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:00:40.373 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:00:40.374 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 19:00:40.374 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:00:40.375 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11136
2025-05-15 19:00:40.375 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:00:40.375 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:00:40.375 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=14839, deviceId=1
2025-05-15 19:00:40.375 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:00:40.376 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:00:40.376 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:00:40.376 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:00:40.376 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:00:40.376 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:00:40.376 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 19:00:40.377 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 19:00:40.377 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:00:40.377 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:00:40.379 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8718
2025-05-15 19:00:40.379 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:00:40.379 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:00:40.380 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:00:40.380 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:00:40.380 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 19:00:40.381 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 19:00:40.381 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting message for recipient bob:1
2025-05-15 19:00:40.381 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:00:40.392 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 19:00:40.393 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:00:40.393 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 19:00:40.393 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:00:40.393 INFO  [main] c.s.c.l.SignalProtocolManager - Message encrypted for recipient bob:1
2025-05-15 19:00:40.395 DEBUG [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 19:00:40.395 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 19:00:40.395 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 19:00:40.396 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 19:00:40.396 DEBUG [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Decrypting message from sender alice:1
2025-05-15 19:00:40.398 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt message from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:58)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:138)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 19:00:40.399 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - From alice: null
2025-05-15 19:12:25.004 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 19:12:25.070 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2921
2025-05-15 19:12:25.071 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 19:12:25.092 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 19:12:25.093 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 19:12:25.093 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:12:25.093 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 19:12:25.097 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 19:12:25.098 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 19:12:25.098 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 19:12:25.099 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 5753
2025-05-15 19:12:25.099 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 19:12:25.100 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 19:12:25.100 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 19:12:25.100 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:12:25.100 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 19:12:25.102 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 19:12:25.102 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 19:12:25.102 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:12:25.103 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1102
2025-05-15 19:12:25.103 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 19:12:25.103 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 19:12:25.103 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 19:12:25.104 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:12:25.104 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 19:12:25.105 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 19:12:25.105 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 19:12:25.105 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:12:25.109 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 19:12:25.112 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 19:12:27.129 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56546
2025-05-15 19:12:27.137 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5753
2025-05-15 19:12:27.138 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=5753, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:12:27.139 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 19:12:27.140 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 19:12:27.140 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 19:12:27.140 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 19:12:27.141 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:12:27.141 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:12:27.142 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:12:27.143 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=5753, deviceId=1
2025-05-15 19:12:27.143 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:12:27.144 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:12:27.168 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:12:27.171 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 19:12:27.171 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 19:12:27.171 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:12:27.172 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56547
2025-05-15 19:12:27.172 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1102
2025-05-15 19:12:27.172 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1102, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:12:27.173 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 19:12:27.173 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 19:12:27.173 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:12:27.173 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 19:12:27.173 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 19:12:27.173 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:12:27.173 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 19:12:27.173 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:12:27.174 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=5753, deviceId=1
2025-05-15 19:12:27.174 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:12:27.174 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1102, deviceId=1
2025-05-15 19:12:27.174 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:12:27.174 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:12:27.174 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:12:27.175 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 19:12:27.175 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:12:27.175 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 19:12:27.175 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 19:12:27.176 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:12:27.176 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:12:27.176 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 19:12:27.177 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1102, deviceId=1
2025-05-15 19:12:27.177 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:12:27.177 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 19:12:27.177 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:12:27.180 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 19:12:27.190 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:12:27.213 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2921
2025-05-15 19:12:27.213 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 19:12:27.213 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 19:12:27.214 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 19:12:27.214 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 19:12:27.214 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:12:27.214 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 19:12:27.214 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 19:12:27.215 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 19:12:27.215 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:12:27.215 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:12:27.215 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:12:27.215 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:12:27.215 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 19:12:27.215 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:12:27.216 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:12:27.216 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1102, deviceId=1
2025-05-15 19:12:27.216 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:12:27.217 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:12:27.217 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2921
2025-05-15 19:12:27.217 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:12:27.217 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:12:27.217 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:12:27.218 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:12:27.218 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:12:27.218 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 19:12:27.218 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 19:12:27.218 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:12:27.219 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:12:27.220 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5753
2025-05-15 19:12:27.220 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:12:27.221 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:12:27.221 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:12:27.221 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:12:27.221 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 19:12:27.222 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 19:12:27.222 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting message for recipient bob:1
2025-05-15 19:12:27.222 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:12:27.234 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 19:12:27.234 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:12:27.234 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 19:12:27.234 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:12:27.234 INFO  [main] c.s.c.l.SignalProtocolManager - Message encrypted for recipient bob:1
2025-05-15 19:12:27.235 DEBUG [main] com.securechat.client.UserClient - Plaintext to send: 'Hello Bob! This message is encrypted.'
2025-05-15 19:12:27.235 DEBUG [main] com.securechat.client.UserClient - Ciphertext length: 180 bytes
2025-05-15 19:12:27.235 DEBUG [main] com.securechat.client.UserClient - Base64 encoded ciphertext length: 240
2025-05-15 19:12:27.237 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 19:12:27.237 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 19:12:27.237 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 19:12:27.238 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 19:12:27.238 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: b69d19d9-5bed-4b17-a93c-30660205feef from sender: alice
2025-05-15 19:12:27.238 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 19:12:27.238 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 19:12:27.239 DEBUG [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Decrypting message from sender alice:1
2025-05-15 19:12:27.240 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt message from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:58)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:158)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 19:12:27.242 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: b69d19d9-5bed-4b17-a93c-30660205feef
2025-05-15 19:19:03.357 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 19:19:03.423 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14768
2025-05-15 19:19:03.425 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 19:19:03.447 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 19:19:03.448 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 19:19:03.448 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:19:03.448 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 19:19:03.452 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 19:19:03.453 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 19:19:03.453 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 19:19:03.454 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13990
2025-05-15 19:19:03.454 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 19:19:03.455 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 19:19:03.455 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 19:19:03.456 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:19:03.456 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 19:19:03.457 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 19:19:03.457 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 19:19:03.458 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:19:03.458 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15434
2025-05-15 19:19:03.458 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 19:19:03.459 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 19:19:03.459 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 19:19:03.459 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:19:03.460 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 19:19:03.461 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 19:19:03.461 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 19:19:03.461 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:19:03.464 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 19:19:03.467 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 19:19:05.476 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56587
2025-05-15 19:19:05.482 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13990
2025-05-15 19:19:05.483 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=13990, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:19:05.484 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 19:19:05.484 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 19:19:05.485 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 19:19:05.486 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 19:19:05.487 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:19:05.487 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:19:05.488 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:19:05.488 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=13990, deviceId=1
2025-05-15 19:19:05.488 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:19:05.489 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:19:05.513 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:19:05.516 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 19:19:05.516 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 19:19:05.516 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:19:05.517 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56588
2025-05-15 19:19:05.517 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15434
2025-05-15 19:19:05.517 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15434, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:19:05.517 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 19:19:05.518 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 19:19:05.518 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:19:05.518 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 19:19:05.518 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 19:19:05.518 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 19:19:05.519 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:19:05.519 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=13990, deviceId=1
2025-05-15 19:19:05.519 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:19:05.519 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:19:05.519 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:19:05.520 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15434, deviceId=1
2025-05-15 19:19:05.520 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 19:19:05.520 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:19:05.520 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:19:05.521 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:19:05.521 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 19:19:05.521 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 19:19:05.522 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:19:05.522 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 19:19:05.522 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:19:05.523 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 19:19:05.523 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15434, deviceId=1
2025-05-15 19:19:05.523 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:19:05.524 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:19:05.526 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 19:19:05.536 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:19:05.555 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14768
2025-05-15 19:19:05.556 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 19:19:05.556 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 19:19:05.556 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 19:19:05.556 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 19:19:05.556 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:19:05.557 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 19:19:05.557 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 19:19:05.557 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:19:05.557 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 19:19:05.558 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:19:05.558 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:19:05.558 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:19:05.559 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 19:19:05.559 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:19:05.559 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:19:05.560 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15434, deviceId=1
2025-05-15 19:19:05.560 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:19:05.560 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14768
2025-05-15 19:19:05.560 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:19:05.560 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:19:05.561 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:19:05.561 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:19:05.561 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:19:05.561 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:19:05.561 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 19:19:05.561 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 19:19:05.562 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:19:05.562 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:19:05.564 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13990
2025-05-15 19:19:05.564 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:19:05.564 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:19:05.564 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:19:05.564 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:19:05.565 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 19:19:05.566 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 19:19:05.566 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting message for recipient bob:1
2025-05-15 19:19:05.566 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:19:05.577 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 19:19:05.578 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:19:05.578 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 19:19:05.578 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:19:05.578 INFO  [main] c.s.c.l.SignalProtocolManager - Message encrypted for recipient bob:1
2025-05-15 19:19:05.578 DEBUG [main] com.securechat.client.UserClient - Plaintext to send: 'Hello Bob! This message is encrypted.'
2025-05-15 19:19:05.579 DEBUG [main] com.securechat.client.UserClient - Ciphertext length: 180 bytes
2025-05-15 19:19:05.579 DEBUG [main] com.securechat.client.UserClient - Base64 encoded ciphertext length: 240
2025-05-15 19:19:05.580 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 19:19:05.581 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 19:19:05.581 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 19:19:05.581 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 19:19:05.581 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: cb1bb2c4-196e-4420-a3e8-25ef8bc0cbd6 from sender: alice
2025-05-15 19:19:05.582 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 19:19:05.582 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 19:19:05.582 DEBUG [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Attempting to decrypt message from sender alice:1: ciphertext length = 180 bytes
2025-05-15 19:19:05.584 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - InvalidMessageException while decrypting from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:58)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:158)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 19:19:05.586 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: cb1bb2c4-196e-4420-a3e8-25ef8bc0cbd6
2025-05-15 19:29:24.835 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 19:29:24.901 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 813
2025-05-15 19:29:24.903 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 19:29:24.924 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 19:29:24.925 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 19:29:24.925 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:29:24.925 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 19:29:24.929 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 19:29:24.930 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 19:29:24.930 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 19:29:24.931 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4279
2025-05-15 19:29:24.931 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 19:29:24.932 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 19:29:24.932 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 19:29:24.932 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:29:24.932 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 19:29:24.934 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 19:29:24.934 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 19:29:24.934 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:29:24.934 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11509
2025-05-15 19:29:24.935 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 19:29:24.935 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 19:29:24.935 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 19:29:24.935 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:29:24.936 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 19:29:24.937 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 19:29:24.937 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 19:29:24.937 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:29:24.942 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 19:29:24.945 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 19:29:26.961 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56625
2025-05-15 19:29:26.968 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4279
2025-05-15 19:29:26.971 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4279, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:29:26.972 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 19:29:26.972 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 19:29:26.972 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 19:29:26.973 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 19:29:26.973 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:29:26.973 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:29:26.974 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:29:26.975 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4279, deviceId=1
2025-05-15 19:29:26.975 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:29:26.976 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:29:27.002 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:29:27.005 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 19:29:27.005 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 19:29:27.005 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:29:27.006 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56626
2025-05-15 19:29:27.006 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11509
2025-05-15 19:29:27.006 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11509, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:29:27.006 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 19:29:27.007 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 19:29:27.007 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:29:27.007 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 19:29:27.007 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 19:29:27.007 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 19:29:27.007 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:29:27.008 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4279, deviceId=1
2025-05-15 19:29:27.008 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:29:27.008 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:29:27.008 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:29:27.008 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11509, deviceId=1
2025-05-15 19:29:27.008 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 19:29:27.009 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:29:27.010 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:29:27.011 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:29:27.011 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 19:29:27.011 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 19:29:27.012 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:29:27.012 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 19:29:27.012 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:29:27.013 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 19:29:27.013 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11509, deviceId=1
2025-05-15 19:29:27.013 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:29:27.013 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:29:27.016 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 19:29:27.026 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:29:27.046 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 813
2025-05-15 19:29:27.046 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 19:29:27.046 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 19:29:27.047 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 19:29:27.047 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 19:29:27.047 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:29:27.047 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 19:29:27.047 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 19:29:27.048 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:29:27.048 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 19:29:27.048 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:29:27.048 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:29:27.049 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:29:27.049 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 19:29:27.050 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:29:27.050 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 813
2025-05-15 19:29:27.050 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:29:27.050 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:29:27.050 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11509, deviceId=1
2025-05-15 19:29:27.050 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:29:27.051 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:29:27.051 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:29:27.051 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:29:27.051 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:29:27.051 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:29:27.051 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 19:29:27.051 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 19:29:27.052 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:29:27.052 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:29:27.054 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4279
2025-05-15 19:29:27.054 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:29:27.054 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:29:27.055 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:29:27.055 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:29:27.055 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 19:29:27.056 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 19:29:27.056 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:29:27.067 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 19:29:27.068 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:29:27.068 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 19:29:27.068 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:29:27.069 DEBUG [main] com.securechat.client.UserClient - Plaintext to send: 'Hello Bob! This message is encrypted.'
2025-05-15 19:29:27.069 DEBUG [main] com.securechat.client.UserClient - Ciphertext length: 180 bytes
2025-05-15 19:29:27.069 DEBUG [main] com.securechat.client.UserClient - Base64 encoded ciphertext length: 240
2025-05-15 19:29:27.072 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 19:29:27.072 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 19:29:27.072 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 19:29:27.072 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 19:29:27.073 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 5c7b555f-7d73-4f19-96ef-9fa8dc80c147 from sender: alice
2025-05-15 19:29:27.073 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 19:29:27.073 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 19:29:27.074 DEBUG [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Attempting to decrypt message from sender alice:1: ciphertext length = 180 bytes
2025-05-15 19:29:27.076 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - InvalidMessageException while decrypting from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:55)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:169)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 19:29:27.077 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 5c7b555f-7d73-4f19-96ef-9fa8dc80c147
2025-05-15 19:36:00.180 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 19:36:00.251 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11459
2025-05-15 19:36:00.253 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 19:36:00.280 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 19:36:00.280 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 19:36:00.280 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:36:00.280 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 19:36:00.285 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 19:36:00.285 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 19:36:00.286 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 19:36:00.287 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15241
2025-05-15 19:36:00.287 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 19:36:00.288 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 19:36:00.288 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 19:36:00.288 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:36:00.289 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 19:36:00.290 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 19:36:00.290 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 19:36:00.291 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:36:00.292 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3070
2025-05-15 19:36:00.292 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 19:36:00.293 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 19:36:00.294 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 19:36:00.294 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:36:00.294 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 19:36:00.295 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 19:36:00.295 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 19:36:00.296 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:36:00.300 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 19:36:00.303 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 19:36:02.317 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56679
2025-05-15 19:36:02.322 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15241
2025-05-15 19:36:02.323 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15241, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:36:02.324 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 19:36:02.324 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 19:36:02.325 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 19:36:02.325 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 19:36:02.326 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:36:02.326 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:36:02.327 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:36:02.328 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15241, deviceId=1
2025-05-15 19:36:02.328 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:36:02.329 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:36:02.356 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:36:02.359 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 19:36:02.359 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 19:36:02.360 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:36:02.360 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56680
2025-05-15 19:36:02.361 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3070
2025-05-15 19:36:02.361 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=3070, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:36:02.361 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 19:36:02.361 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:36:02.361 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 19:36:02.362 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 19:36:02.362 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 19:36:02.362 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 19:36:02.362 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15241, deviceId=1
2025-05-15 19:36:02.362 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:36:02.363 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:36:02.363 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:36:02.364 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:36:02.364 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 19:36:02.364 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=3070, deviceId=1
2025-05-15 19:36:02.364 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:36:02.365 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:36:02.365 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:36:02.366 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 19:36:02.366 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 19:36:02.366 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 19:36:02.366 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:36:02.367 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:36:02.367 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 19:36:02.367 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=3070, deviceId=1
2025-05-15 19:36:02.367 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:36:02.367 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:36:02.373 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 19:36:02.378 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:36:02.398 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11459
2025-05-15 19:36:02.399 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 19:36:02.399 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 19:36:02.399 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 19:36:02.399 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 19:36:02.399 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:36:02.400 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 19:36:02.400 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 19:36:02.400 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:36:02.400 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 19:36:02.400 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:36:02.401 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:36:02.401 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:36:02.402 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 19:36:02.402 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:36:02.402 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:36:02.403 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=3070, deviceId=1
2025-05-15 19:36:02.403 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11459
2025-05-15 19:36:02.403 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:36:02.403 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:36:02.403 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:36:02.403 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:36:02.404 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:36:02.404 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:36:02.404 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:36:02.404 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 19:36:02.404 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 19:36:02.404 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:36:02.405 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:36:02.406 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15241
2025-05-15 19:36:02.407 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:36:02.407 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:36:02.407 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:36:02.407 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:36:02.407 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 19:36:02.408 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 19:36:02.408 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:36:02.420 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 19:36:02.421 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:36:02.421 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 19:36:02.421 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:36:02.422 DEBUG [main] com.securechat.client.UserClient - Plaintext to send: 'Hello Bob! This message is encrypted.'
2025-05-15 19:36:02.422 DEBUG [main] com.securechat.client.UserClient - Ciphertext length: 180 bytes
2025-05-15 19:36:02.422 DEBUG [main] com.securechat.client.UserClient - Base64 encoded ciphertext length: 240
2025-05-15 19:36:02.424 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 19:36:02.424 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 19:36:02.424 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 19:36:02.425 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 19:36:02.425 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: bf66dc38-d92b-44a9-88bd-70c4713f6c54 from sender: alice
2025-05-15 19:36:02.425 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 19:36:02.425 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 19:36:02.425 DEBUG [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Attempting to decrypt message from sender alice:1: ciphertext length = 180 bytes
2025-05-15 19:36:02.427 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - InvalidMessageException while decrypting from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:55)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:168)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 19:36:02.429 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: bf66dc38-d92b-44a9-88bd-70c4713f6c54
2025-05-15 19:40:31.394 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 19:40:31.460 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 5698
2025-05-15 19:40:31.463 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 19:40:31.488 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 19:40:31.489 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 19:40:31.489 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:40:31.489 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 19:40:31.494 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 19:40:31.494 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 19:40:31.494 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 19:40:31.495 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12829
2025-05-15 19:40:31.495 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 19:40:31.496 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 19:40:31.496 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 19:40:31.496 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:40:31.496 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 19:40:31.497 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 19:40:31.498 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 19:40:31.498 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:40:31.499 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8435
2025-05-15 19:40:31.499 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 19:40:31.499 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 19:40:31.500 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 19:40:31.500 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:40:31.500 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 19:40:31.501 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 19:40:31.501 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 19:40:31.501 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:40:31.506 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 19:40:31.509 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 19:40:33.535 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56703
2025-05-15 19:40:33.540 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12829
2025-05-15 19:40:33.541 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12829, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:40:33.542 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 19:40:33.542 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 19:40:33.542 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 19:40:33.542 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 19:40:33.543 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:40:33.543 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:40:33.543 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:40:33.544 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12829, deviceId=1
2025-05-15 19:40:33.545 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:40:33.545 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:40:33.572 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:40:33.575 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 19:40:33.575 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 19:40:33.575 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:40:33.576 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:56704
2025-05-15 19:40:33.576 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8435
2025-05-15 19:40:33.576 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8435, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:40:33.577 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 19:40:33.577 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 19:40:33.577 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 19:40:33.577 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:40:33.577 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 19:40:33.577 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:40:33.577 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:40:33.578 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 19:40:33.578 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:40:33.578 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12829, deviceId=1
2025-05-15 19:40:33.578 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8435, deviceId=1
2025-05-15 19:40:33.578 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:40:33.578 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:40:33.578 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:40:33.579 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 19:40:33.579 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:40:33.579 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 19:40:33.579 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 19:40:33.580 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:40:33.580 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:40:33.580 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 19:40:33.581 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8435, deviceId=1
2025-05-15 19:40:33.581 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:40:33.581 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 19:40:33.581 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:40:33.584 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 19:40:33.594 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:40:33.615 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5698
2025-05-15 19:40:33.616 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 19:40:33.616 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 19:40:33.616 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 19:40:33.616 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 19:40:33.616 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:40:33.617 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 19:40:33.617 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 19:40:33.617 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:40:33.617 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 19:40:33.617 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:40:33.618 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:40:33.618 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:40:33.618 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 19:40:33.618 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:40:33.619 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:40:33.619 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5698
2025-05-15 19:40:33.619 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8435, deviceId=1
2025-05-15 19:40:33.619 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:40:33.620 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:40:33.620 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:40:33.620 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:40:33.620 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:40:33.620 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:40:33.620 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:40:33.621 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 19:40:33.621 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 19:40:33.621 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:40:33.622 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:40:33.623 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12829
2025-05-15 19:40:33.624 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:40:33.624 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:40:33.624 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:40:33.624 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:40:33.624 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 19:40:33.625 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 19:40:33.625 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:40:33.637 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 19:40:33.637 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:40:33.637 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 19:40:33.637 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:40:33.639 DEBUG [main] com.securechat.client.UserClient - Plaintext to send: 'Hello Bob! This message is encrypted.'
2025-05-15 19:40:33.639 DEBUG [main] com.securechat.client.UserClient - Ciphertext length: 180 bytes
2025-05-15 19:40:33.640 DEBUG [main] com.securechat.client.UserClient - Base64 encoded ciphertext length: 240
2025-05-15 19:40:33.641 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 19:40:33.641 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 19:40:33.642 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 19:40:33.642 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 19:40:33.642 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: a974c926-4a96-4fdf-9197-71b5ae4ebebc from sender: alice
2025-05-15 19:40:33.643 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 19:40:33.643 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 19:40:33.645 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:168)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 19:40:33.646 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: a974c926-4a96-4fdf-9197-71b5ae4ebebc
2025-05-15 19:46:27.658 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 19:46:27.725 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8458
2025-05-15 19:46:27.727 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 19:46:27.748 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 19:46:27.749 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 19:46:27.749 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:46:27.749 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 19:46:27.753 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 19:46:27.754 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 19:46:27.754 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 19:46:27.755 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2051
2025-05-15 19:46:27.755 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 19:46:27.756 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 19:46:27.756 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 19:46:27.756 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:46:27.757 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 19:46:27.758 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 19:46:27.758 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 19:46:27.758 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:46:27.759 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6706
2025-05-15 19:46:27.759 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 19:46:27.760 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 19:46:27.760 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 19:46:27.760 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:46:27.760 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 19:46:27.761 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 19:46:27.762 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 19:46:27.762 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:46:27.766 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 19:46:27.769 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 19:46:29.772 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53710
2025-05-15 19:46:29.777 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2051
2025-05-15 19:46:29.779 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=2051, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 19:46:29.779 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 19:46:29.779 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 19:46:29.779 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 19:46:29.780 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 19:46:29.780 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:46:29.780 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:46:29.780 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:46:29.781 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=2051, deviceId=1
2025-05-15 19:46:29.781 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:46:29.782 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:46:29.811 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:46:29.815 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 19:46:29.815 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 19:46:29.815 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:46:29.816 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53711
2025-05-15 19:46:29.816 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6706
2025-05-15 19:46:29.816 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6706, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 19:46:29.816 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 19:46:29.817 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 19:46:29.817 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:46:29.817 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 19:46:29.817 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 19:46:29.817 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:46:29.818 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 19:46:29.818 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 19:46:29.818 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=2051, deviceId=1
2025-05-15 19:46:29.818 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 19:46:29.818 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6706, deviceId=1
2025-05-15 19:46:29.818 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:46:29.818 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 19:46:29.819 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:46:29.819 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 19:46:29.819 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:46:29.820 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 19:46:29.820 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 19:46:29.820 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:46:29.821 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:46:29.822 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 19:46:29.822 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6706, deviceId=1
2025-05-15 19:46:29.822 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 19:46:29.822 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:46:29.823 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:46:29.826 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 19:46:29.837 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:46:29.865 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8458
2025-05-15 19:46:29.866 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 19:46:29.866 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 19:46:29.866 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 19:46:29.867 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 19:46:29.867 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:46:29.867 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 19:46:29.867 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 19:46:29.867 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:46:29.868 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 19:46:29.868 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 19:46:29.868 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:46:29.869 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 19:46:29.869 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 19:46:29.869 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 19:46:29.870 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 19:46:29.870 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8458
2025-05-15 19:46:29.870 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6706, deviceId=1
2025-05-15 19:46:29.871 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:46:29.871 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 19:46:29.871 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:46:29.871 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 19:46:29.871 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:46:29.871 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:46:29.871 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 19:46:29.872 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 19:46:29.872 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 19:46:29.872 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:46:29.873 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 19:46:29.875 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2051
2025-05-15 19:46:29.875 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:46:29.875 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 19:46:29.876 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:46:29.876 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 19:46:29.876 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 19:46:29.877 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 19:46:29.877 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 19:46:29.889 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 19:46:29.890 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 19:46:29.890 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 19:46:29.890 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 19:46:29.891 DEBUG [main] com.securechat.client.UserClient - Plaintext to send: 'Hello Bob! This message is encrypted.'
2025-05-15 19:46:29.891 DEBUG [main] com.securechat.client.UserClient - Ciphertext length: 180 bytes
2025-05-15 19:46:29.891 DEBUG [main] com.securechat.client.UserClient - Base64 encoded ciphertext length: 240
2025-05-15 19:46:29.893 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 19:46:29.893 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 19:46:29.893 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 19:46:29.894 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 19:46:29.894 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 4bb51259-d730-42d1-ac78-20c8a92ca6d0 from sender: alice
2025-05-15 19:46:29.894 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 19:46:29.894 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 19:46:29.895 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 19:46:29.897 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:172)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 19:46:29.899 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 4bb51259-d730-42d1-ac78-20c8a92ca6d0
2025-05-15 20:00:57.292 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 20:00:57.361 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15787
2025-05-15 20:00:57.364 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 20:00:57.389 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 20:00:57.390 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 20:00:57.390 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:00:57.390 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 20:00:57.396 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 20:00:57.397 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 20:00:57.397 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 20:00:57.398 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2039
2025-05-15 20:00:57.398 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 20:00:57.399 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 20:00:57.400 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 20:00:57.400 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:00:57.400 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 20:00:57.402 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 20:00:57.402 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 20:00:57.403 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:00:57.403 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8123
2025-05-15 20:00:57.403 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 20:00:57.404 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 20:00:57.404 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 20:00:57.405 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:00:57.405 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 20:00:57.406 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 20:00:57.406 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 20:00:57.406 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:00:57.409 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 20:00:57.412 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 20:00:59.422 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53761
2025-05-15 20:00:59.427 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2039
2025-05-15 20:00:59.429 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=2039, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:00:59.429 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 20:00:59.430 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 20:00:59.430 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 20:00:59.430 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 20:00:59.431 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:00:59.431 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:00:59.431 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:00:59.432 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=2039, deviceId=1
2025-05-15 20:00:59.432 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:00:59.432 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:00:59.456 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:00:59.458 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 20:00:59.459 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 20:00:59.459 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:00:59.460 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53762
2025-05-15 20:00:59.460 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8123
2025-05-15 20:00:59.461 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8123, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:00:59.461 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:00:59.461 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:00:59.462 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 20:00:59.462 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 20:00:59.462 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:00:59.462 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=2039, deviceId=1
2025-05-15 20:00:59.462 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 20:00:59.463 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:00:59.463 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:00:59.463 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:00:59.463 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 20:00:59.464 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:00:59.464 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8123, deviceId=1
2025-05-15 20:00:59.464 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:00:59.465 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:00:59.466 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:00:59.467 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 20:00:59.467 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 20:00:59.468 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:00:59.468 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:00:59.469 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:00:59.469 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 20:00:59.469 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8123, deviceId=1
2025-05-15 20:00:59.470 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:00:59.470 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:00:59.471 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:00:59.481 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:00:59.502 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15787
2025-05-15 20:00:59.503 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:00:59.503 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:00:59.503 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:00:59.503 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 20:00:59.503 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:00:59.503 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 20:00:59.504 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 20:00:59.504 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:00:59.504 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 20:00:59.504 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:00:59.504 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:00:59.505 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:00:59.506 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 20:00:59.506 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:00:59.506 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15787
2025-05-15 20:00:59.506 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:00:59.507 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:00:59.507 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8123, deviceId=1
2025-05-15 20:00:59.507 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:00:59.507 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:00:59.507 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:00:59.507 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:00:59.507 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:00:59.507 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:00:59.508 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 20:00:59.508 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 20:00:59.508 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:00:59.508 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:00:59.510 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2039
2025-05-15 20:00:59.510 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:00:59.510 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:00:59.511 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:00:59.511 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:00:59.511 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 20:00:59.511 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:00:59.512 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:00:59.523 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 20:00:59.524 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:00:59.524 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 20:00:59.524 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:00:59.525 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='Hello Bob! This message is encrypted.', ciphertext length=180 bytes, base64 length=240
2025-05-15 20:00:59.526 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 20:00:59.527 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 20:00:59.527 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 20:00:59.527 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 20:00:59.527 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 8ee2334e-3a64-4ac7-8ed7-9320f34a7529 from sender: alice
2025-05-15 20:00:59.528 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 20:00:59.528 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 20:00:59.528 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 20:00:59.530 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:178)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 20:00:59.532 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 8ee2334e-3a64-4ac7-8ed7-9320f34a7529
2025-05-15 20:03:37.876 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 20:03:37.944 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8346
2025-05-15 20:03:37.946 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 20:03:37.970 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 20:03:37.970 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 20:03:37.970 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:03:37.971 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 20:03:37.975 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 20:03:37.976 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 20:03:37.976 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 20:03:37.977 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3121
2025-05-15 20:03:37.977 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 20:03:37.978 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 20:03:37.978 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 20:03:37.978 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:03:37.978 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 20:03:37.979 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 20:03:37.980 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 20:03:37.980 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:03:37.981 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1217
2025-05-15 20:03:37.981 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 20:03:37.981 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 20:03:37.982 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 20:03:37.982 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:03:37.982 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 20:03:37.983 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 20:03:37.983 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 20:03:37.984 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:03:37.989 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 20:03:37.992 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 20:03:40.002 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53771
2025-05-15 20:03:40.008 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3121
2025-05-15 20:03:40.011 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=3121, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:03:40.011 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 20:03:40.011 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 20:03:40.012 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 20:03:40.013 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 20:03:40.014 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:03:40.014 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:03:40.015 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:03:40.016 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=3121, deviceId=1
2025-05-15 20:03:40.016 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:03:40.017 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:03:40.041 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:03:40.044 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 20:03:40.044 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 20:03:40.045 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:03:40.045 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53772
2025-05-15 20:03:40.045 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1217
2025-05-15 20:03:40.046 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1217, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:03:40.046 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:03:40.046 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 20:03:40.046 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:03:40.046 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:03:40.046 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 20:03:40.047 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:03:40.047 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:03:40.047 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 20:03:40.047 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:03:40.047 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=3121, deviceId=1
2025-05-15 20:03:40.047 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1217, deviceId=1
2025-05-15 20:03:40.047 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:03:40.048 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:03:40.048 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:03:40.048 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:03:40.048 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 20:03:40.049 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 20:03:40.049 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 20:03:40.049 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:03:40.050 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:03:40.050 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 20:03:40.050 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1217, deviceId=1
2025-05-15 20:03:40.050 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:03:40.050 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:03:40.050 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:03:40.053 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:03:40.063 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:03:40.087 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8346
2025-05-15 20:03:40.088 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:03:40.088 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:03:40.088 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:03:40.088 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 20:03:40.088 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:03:40.089 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 20:03:40.089 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 20:03:40.089 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:03:40.089 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 20:03:40.090 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:03:40.090 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:03:40.090 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:03:40.091 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 20:03:40.091 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:03:40.091 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:03:40.091 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8346
2025-05-15 20:03:40.092 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1217, deviceId=1
2025-05-15 20:03:40.092 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:03:40.092 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:03:40.092 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:03:40.092 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:03:40.092 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:03:40.093 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:03:40.093 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:03:40.093 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 20:03:40.093 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 20:03:40.093 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:03:40.094 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:03:40.095 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3121
2025-05-15 20:03:40.095 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:03:40.096 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:03:40.096 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:03:40.096 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:03:40.096 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 20:03:40.097 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:03:40.098 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:03:40.098 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:03:40.110 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 20:03:40.110 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:03:40.110 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 20:03:40.110 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:03:40.111 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='Hello Bob! This message is encrypted.', ciphertext length=180 bytes, base64 length=240
2025-05-15 20:03:40.112 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 20:03:40.113 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 20:03:40.113 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 20:03:40.113 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 20:03:40.113 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: dbcab1ef-d453-4ecc-92ae-6910502ff6e6 from sender: alice
2025-05-15 20:03:40.114 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 20:03:40.114 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 20:03:40.114 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 20:03:40.116 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:181)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 20:03:40.118 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: dbcab1ef-d453-4ecc-92ae-6910502ff6e6
2025-05-15 20:12:12.788 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 20:12:12.857 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2164
2025-05-15 20:12:12.859 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 20:12:12.881 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 20:12:12.882 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 20:12:12.882 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:12:12.882 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 20:12:12.887 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 20:12:12.888 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 20:12:12.888 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 20:12:12.889 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11898
2025-05-15 20:12:12.889 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 20:12:12.890 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 20:12:12.891 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 20:12:12.891 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:12:12.891 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 20:12:12.892 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 20:12:12.893 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 20:12:12.893 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:12:12.894 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3543
2025-05-15 20:12:12.894 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 20:12:12.895 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 20:12:12.895 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 20:12:12.895 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:12:12.895 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 20:12:12.897 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 20:12:12.898 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 20:12:12.898 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:12:12.902 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 20:12:12.906 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 20:12:14.916 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53900
2025-05-15 20:12:14.921 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11898
2025-05-15 20:12:14.923 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11898, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:12:14.923 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 20:12:14.924 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 20:12:14.924 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 20:12:14.924 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 20:12:14.925 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:12:14.925 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:12:14.926 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:12:14.926 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11898, deviceId=1
2025-05-15 20:12:14.927 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:12:14.927 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:12:14.952 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:12:14.955 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 20:12:14.955 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 20:12:14.955 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:12:14.956 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53901
2025-05-15 20:12:14.956 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3543
2025-05-15 20:12:14.956 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=3543, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:12:14.956 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:12:14.957 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 20:12:14.957 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:12:14.957 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:12:14.957 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 20:12:14.957 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:12:14.957 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 20:12:14.957 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:12:14.958 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11898, deviceId=1
2025-05-15 20:12:14.958 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:12:14.958 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:12:14.958 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=3543, deviceId=1
2025-05-15 20:12:14.959 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:12:14.959 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 20:12:14.959 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:12:14.960 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:12:14.961 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 20:12:14.962 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 20:12:14.962 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:12:14.962 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:12:14.962 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:12:14.963 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 20:12:14.963 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=3543, deviceId=1
2025-05-15 20:12:14.963 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:12:14.964 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:12:14.965 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:12:14.975 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:12:14.998 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2164
2025-05-15 20:12:14.998 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:12:14.999 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:12:14.999 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:12:14.999 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 20:12:14.999 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:12:14.999 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 20:12:15.000 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 20:12:15.000 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:12:15.000 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 20:12:15.001 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:12:15.001 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:12:15.001 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:12:15.002 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:12:15.002 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 20:12:15.002 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:12:15.003 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=3543, deviceId=1
2025-05-15 20:12:15.003 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2164
2025-05-15 20:12:15.003 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:12:15.003 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:12:15.003 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:12:15.003 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:12:15.004 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:12:15.004 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:12:15.004 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:12:15.004 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 20:12:15.004 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 20:12:15.004 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:12:15.005 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:12:15.007 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11898
2025-05-15 20:12:15.007 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:12:15.007 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:12:15.008 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:12:15.008 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:12:15.008 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 20:12:15.009 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:12:15.009 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:12:15.009 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:12:15.021 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 20:12:15.021 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:12:15.021 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 20:12:15.022 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:12:15.023 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='Hello Bob! This message is encrypted.', ciphertext length=180 bytes, base64 length=240
2025-05-15 20:12:15.026 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 20:12:15.026 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 20:12:15.026 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 20:12:15.027 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 20:12:15.027 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 56d4be62-67d4-4172-a058-a7d6fa339f92 from sender: alice
2025-05-15 20:12:15.027 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 20:12:15.027 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 240
2025-05-15 20:12:15.028 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 180 bytes
2025-05-15 20:12:15.029 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:179)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 20:12:15.031 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 56d4be62-67d4-4172-a058-a7d6fa339f92
2025-05-15 20:15:54.171 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 20:15:54.235 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4505
2025-05-15 20:15:54.237 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 20:15:54.259 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 20:15:54.260 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 20:15:54.260 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:15:54.260 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 20:15:54.264 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 20:15:54.265 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 20:15:54.265 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 20:15:54.266 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2202
2025-05-15 20:15:54.266 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 20:15:54.267 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 20:15:54.267 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 20:15:54.267 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:15:54.268 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 20:15:54.269 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 20:15:54.269 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 20:15:54.269 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:15:54.270 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6338
2025-05-15 20:15:54.270 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 20:15:54.270 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 20:15:54.270 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 20:15:54.271 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:15:54.271 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 20:15:54.272 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 20:15:54.272 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 20:15:54.272 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:15:54.275 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 20:15:54.278 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 20:15:56.295 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53929
2025-05-15 20:15:56.299 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2202
2025-05-15 20:15:56.300 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=2202, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:15:56.300 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 20:15:56.300 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 20:15:56.301 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 20:15:56.301 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 20:15:56.301 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:15:56.301 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:15:56.302 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:15:56.302 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=2202, deviceId=1
2025-05-15 20:15:56.303 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:15:56.303 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:15:56.330 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:15:56.333 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 20:15:56.333 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 20:15:56.333 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:15:56.334 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53930
2025-05-15 20:15:56.334 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6338
2025-05-15 20:15:56.334 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6338, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:15:56.334 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:15:56.334 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 20:15:56.334 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:15:56.335 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:15:56.335 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 20:15:56.335 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:15:56.335 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:15:56.335 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 20:15:56.335 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:15:56.335 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=2202, deviceId=1
2025-05-15 20:15:56.336 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6338, deviceId=1
2025-05-15 20:15:56.336 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:15:56.336 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:15:56.336 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:15:56.337 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 20:15:56.337 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:15:56.338 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 20:15:56.338 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 20:15:56.338 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:15:56.339 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:15:56.339 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 20:15:56.339 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6338, deviceId=1
2025-05-15 20:15:56.339 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:15:56.339 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:15:56.339 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:15:56.342 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:15:56.352 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:15:56.376 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4505
2025-05-15 20:15:56.376 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:15:56.376 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:15:56.377 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:15:56.377 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 20:15:56.377 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:15:56.377 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 20:15:56.377 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 20:15:56.378 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:15:56.378 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 20:15:56.378 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:15:56.378 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:15:56.378 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:15:56.379 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 20:15:56.379 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:15:56.379 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:15:56.380 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6338, deviceId=1
2025-05-15 20:15:56.380 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4505
2025-05-15 20:15:56.380 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:15:56.380 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:15:56.380 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:15:56.380 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:15:56.381 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:15:56.381 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:15:56.381 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:15:56.381 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 20:15:56.381 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 20:15:56.381 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:15:56.382 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:15:56.384 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2202
2025-05-15 20:15:56.384 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:15:56.384 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:15:56.384 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:15:56.384 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:15:56.385 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 20:15:56.385 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:15:56.386 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:15:56.386 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:15:56.397 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 20:15:56.398 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:15:56.398 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 20:15:56.398 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:15:56.399 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 20:15:56.400 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 20:15:56.400 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 20:15:56.401 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 20:15:56.401 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 20:15:56.401 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: fa25b558-2beb-4a8d-a11d-b7199d6241bb from sender: alice
2025-05-15 20:15:56.401 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 20:15:56.402 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 20:15:56.402 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 20:15:56.404 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:179)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 20:15:56.405 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: fa25b558-2beb-4a8d-a11d-b7199d6241bb
2025-05-15 20:18:30.536 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 20:18:30.602 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10969
2025-05-15 20:18:30.604 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 20:18:30.627 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 20:18:30.627 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 20:18:30.627 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:30.628 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 20:18:30.632 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 20:18:30.633 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 20:18:30.633 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 20:18:30.634 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13942
2025-05-15 20:18:30.634 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 20:18:30.635 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 20:18:30.635 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 20:18:30.635 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:30.635 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 20:18:30.636 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 20:18:30.637 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 20:18:30.637 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:18:30.637 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12599
2025-05-15 20:18:30.637 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 20:18:30.638 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 20:18:30.638 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 20:18:30.639 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:30.639 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 20:18:30.640 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 20:18:30.640 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 20:18:30.640 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:18:30.643 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 20:18:30.646 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 20:18:32.659 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53937
2025-05-15 20:18:32.664 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13942
2025-05-15 20:18:32.665 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=13942, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:18:32.666 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 20:18:32.667 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 20:18:32.667 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 20:18:32.667 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 20:18:32.667 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:32.668 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:18:32.669 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:18:32.669 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=13942, deviceId=1
2025-05-15 20:18:32.670 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:18:32.670 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:18:32.694 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:18:32.698 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 20:18:32.698 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 20:18:32.699 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:18:32.699 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53938
2025-05-15 20:18:32.699 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12599
2025-05-15 20:18:32.699 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12599, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:18:32.700 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:18:32.700 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 20:18:32.700 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:18:32.700 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:18:32.700 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 20:18:32.700 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:32.700 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:18:32.701 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 20:18:32.701 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:18:32.701 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=13942, deviceId=1
2025-05-15 20:18:32.701 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12599, deviceId=1
2025-05-15 20:18:32.701 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:18:32.701 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:18:32.701 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:18:32.702 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 20:18:32.702 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:18:32.703 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 20:18:32.703 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 20:18:32.704 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:18:32.704 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:18:32.705 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 20:18:32.705 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12599, deviceId=1
2025-05-15 20:18:32.705 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:18:32.705 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:18:32.705 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:18:32.708 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:18:32.719 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:32.740 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10969
2025-05-15 20:18:32.740 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:18:32.740 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:18:32.740 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:18:32.741 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 20:18:32.741 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:18:32.741 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 20:18:32.741 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 20:18:32.742 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:18:32.742 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 20:18:32.742 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:18:32.743 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:18:32.743 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:32.743 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 20:18:32.743 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:18:32.744 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:18:32.744 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12599, deviceId=1
2025-05-15 20:18:32.744 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:18:32.744 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:18:32.744 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10969
2025-05-15 20:18:32.745 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:18:32.745 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:18:32.745 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:18:32.745 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:18:32.745 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:18:32.746 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 20:18:32.746 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 20:18:32.746 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:18:32.746 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:32.748 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13942
2025-05-15 20:18:32.749 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:18:32.749 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:18:32.749 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:18:32.749 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:18:32.749 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 20:18:32.750 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:18:32.750 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:18:32.751 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:18:32.762 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 20:18:32.763 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:18:32.763 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 20:18:32.763 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:18:32.764 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=PREKEY, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 20:18:32.765 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 20:18:32.765 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 20:18:32.766 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 20:18:32.766 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 20:18:32.766 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 945ff2fa-b1c2-46a5-a7a5-257f7271db4c from sender: alice
2025-05-15 20:18:32.767 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: PREKEY
2025-05-15 20:18:32.767 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 20:18:32.767 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 20:18:32.770 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:18:32.770 WARN  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:18:32.770 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:18:32.771 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:18:32.771 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:18:32.772 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12599
2025-05-15 20:18:32.772 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:18:32.773 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:18:32.774 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:18:32.775 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 2001
2025-05-15 20:18:32.775 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - From alice: testmsg
2025-05-15 20:28:14.588 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 20:28:14.660 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 795
2025-05-15 20:28:14.662 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 20:28:14.685 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 20:28:14.686 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 20:28:14.686 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:28:14.686 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 20:28:14.691 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 20:28:14.691 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 20:28:14.692 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 20:28:14.693 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4526
2025-05-15 20:28:14.693 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 20:28:14.694 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 20:28:14.694 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 20:28:14.694 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:28:14.694 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 20:28:14.695 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 20:28:14.696 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 20:28:14.696 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:28:14.697 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10850
2025-05-15 20:28:14.697 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 20:28:14.697 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 20:28:14.697 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 20:28:14.698 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:28:14.698 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 20:28:14.700 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 20:28:14.700 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 20:28:14.700 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:28:14.703 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 20:28:14.706 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 20:28:16.714 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53977
2025-05-15 20:28:16.719 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4526
2025-05-15 20:28:16.721 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4526, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:28:16.722 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 20:28:16.722 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 20:28:16.722 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 20:28:16.723 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 20:28:16.723 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:28:16.723 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:28:16.725 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:28:16.726 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4526, deviceId=1
2025-05-15 20:28:16.727 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:28:16.727 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:28:16.754 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:28:16.757 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 20:28:16.758 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 20:28:16.758 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:28:16.758 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53978
2025-05-15 20:28:16.759 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10850
2025-05-15 20:28:16.759 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10850, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:28:16.759 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:28:16.759 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 20:28:16.759 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:28:16.759 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:28:16.760 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 20:28:16.760 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:28:16.760 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 20:28:16.760 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:28:16.760 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4526, deviceId=1
2025-05-15 20:28:16.760 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:28:16.761 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10850, deviceId=1
2025-05-15 20:28:16.761 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:28:16.761 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:28:16.761 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:28:16.761 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 20:28:16.762 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:28:16.762 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 20:28:16.763 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 20:28:16.764 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:28:16.765 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:28:16.765 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:28:16.765 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 20:28:16.765 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10850, deviceId=1
2025-05-15 20:28:16.766 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:28:16.766 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:28:16.772 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:28:16.780 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:28:16.806 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 795
2025-05-15 20:28:16.807 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:28:16.807 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:28:16.807 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:28:16.807 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:28:16.807 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 20:28:16.808 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 20:28:16.808 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:28:16.808 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 20:28:16.809 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 20:28:16.809 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:28:16.809 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:28:16.810 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:28:16.811 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 20:28:16.811 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:28:16.812 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 795
2025-05-15 20:28:16.812 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:28:16.812 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:28:16.812 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10850, deviceId=1
2025-05-15 20:28:16.812 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:28:16.812 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:28:16.812 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:28:16.813 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:28:16.813 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:28:16.813 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:28:16.813 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 20:28:16.813 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 20:28:16.813 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:28:16.814 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:28:16.816 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4526
2025-05-15 20:28:16.817 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:28:16.817 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:28:16.817 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:28:16.817 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:28:16.818 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 20:28:16.818 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:28:16.818 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:28:16.818 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:28:16.830 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 20:28:16.831 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:28:16.831 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 20:28:16.831 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:28:16.832 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 20:28:16.834 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 20:28:16.834 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 20:28:16.835 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 20:28:16.835 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 20:28:16.835 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 0597df60-7677-4d52-b4ee-92873e355eb3 from sender: alice
2025-05-15 20:28:16.836 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 20:28:16.836 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 20:28:16.836 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 20:28:16.838 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:179)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 20:28:16.840 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 0597df60-7677-4d52-b4ee-92873e355eb3
2025-05-15 20:39:45.649 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 20:39:45.715 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 961
2025-05-15 20:39:45.717 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 20:39:45.744 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 20:39:45.745 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 20:39:45.745 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:39:45.745 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 20:39:45.750 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 20:39:45.750 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 20:39:45.750 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 20:39:45.751 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4260
2025-05-15 20:39:45.751 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 20:39:45.752 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 20:39:45.752 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 20:39:45.752 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:39:45.752 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 20:39:45.754 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 20:39:45.754 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 20:39:45.754 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:39:45.755 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4678
2025-05-15 20:39:45.755 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 20:39:45.756 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 20:39:45.756 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 20:39:45.756 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:39:45.756 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 20:39:45.757 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 20:39:45.757 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 20:39:45.758 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:39:45.760 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 20:39:45.763 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 20:39:47.778 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54016
2025-05-15 20:39:47.784 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4260
2025-05-15 20:39:47.786 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4260, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:39:47.786 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 20:39:47.787 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 20:39:47.787 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 20:39:47.787 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 20:39:47.787 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:39:47.788 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:39:47.788 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:39:47.788 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4260, deviceId=1
2025-05-15 20:39:47.789 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:39:47.789 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:39:47.814 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:39:47.816 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 20:39:47.816 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 20:39:47.817 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:39:47.818 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54017
2025-05-15 20:39:47.818 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4678
2025-05-15 20:39:47.819 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4678, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:39:47.819 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:39:47.819 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:39:47.819 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 20:39:47.820 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:39:47.820 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 20:39:47.820 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 20:39:47.820 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4260, deviceId=1
2025-05-15 20:39:47.820 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:39:47.821 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:39:47.821 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:39:47.821 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:39:47.821 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4678, deviceId=1
2025-05-15 20:39:47.821 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 20:39:47.822 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:39:47.822 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:39:47.823 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:39:47.823 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 20:39:47.823 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 20:39:47.824 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:39:47.824 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:39:47.826 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:39:47.826 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 20:39:47.827 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4678, deviceId=1
2025-05-15 20:39:47.827 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:39:47.827 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:39:47.828 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:39:47.838 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:39:47.859 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 961
2025-05-15 20:39:47.859 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:39:47.860 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:39:47.860 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:39:47.860 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 20:39:47.860 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:39:47.860 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 20:39:47.860 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 20:39:47.860 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:39:47.861 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 20:39:47.861 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:39:47.861 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:39:47.861 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:39:47.862 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 20:39:47.862 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:39:47.863 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 961
2025-05-15 20:39:47.863 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:39:47.863 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:39:47.863 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4678, deviceId=1
2025-05-15 20:39:47.864 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:39:47.864 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:39:47.864 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:39:47.864 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:39:47.864 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:39:47.864 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:39:47.865 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 20:39:47.865 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 20:39:47.865 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:39:47.865 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:39:47.867 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4260
2025-05-15 20:39:47.867 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:39:47.867 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:39:47.867 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:39:47.868 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:39:47.868 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 20:39:47.868 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 20:39:47.868 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 20:39:47.868 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:39:47.869 DEBUG [main] com.securechat.client.UserClient - hasSession: true
2025-05-15 20:39:47.869 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:39:47.869 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:39:47.881 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 20:39:47.881 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:39:47.881 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 20:39:47.881 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:39:47.882 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 20:39:47.884 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 20:39:47.884 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 20:39:47.884 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 20:39:47.885 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 20:39:47.885 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 7163ce0f-fd0e-499c-8ef9-499ebb26f54a from sender: alice
2025-05-15 20:39:47.885 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 20:39:47.886 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 20:39:47.886 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 20:39:47.888 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:184)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 20:39:47.889 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 7163ce0f-fd0e-499c-8ef9-499ebb26f54a
2025-05-15 20:55:20.611 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 20:55:20.676 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 565
2025-05-15 20:55:20.678 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 20:55:20.702 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 20:55:20.703 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 20:55:20.703 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:55:20.703 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 20:55:20.708 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 20:55:20.708 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 20:55:20.708 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 20:55:20.709 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13150
2025-05-15 20:55:20.709 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 20:55:20.710 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 20:55:20.710 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 20:55:20.710 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:55:20.710 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 20:55:20.712 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 20:55:20.713 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 20:55:20.713 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:55:20.714 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1984
2025-05-15 20:55:20.714 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 20:55:20.715 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 20:55:20.715 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 20:55:20.715 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:55:20.715 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 20:55:20.716 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 20:55:20.717 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 20:55:20.717 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:55:20.720 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 20:55:20.723 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 20:55:22.738 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54070
2025-05-15 20:55:22.741 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13150
2025-05-15 20:55:22.742 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=13150, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 20:55:22.743 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 20:55:22.743 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 20:55:22.743 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 20:55:22.744 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 20:55:22.744 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:55:22.745 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:55:22.745 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:55:22.746 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=13150, deviceId=1
2025-05-15 20:55:22.746 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:55:22.746 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:55:22.771 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:55:22.774 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 20:55:22.774 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 20:55:22.774 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:55:22.774 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54071
2025-05-15 20:55:22.775 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1984
2025-05-15 20:55:22.775 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1984, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 20:55:22.775 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 20:55:22.775 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:55:22.775 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 20:55:22.776 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 20:55:22.776 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 20:55:22.776 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 20:55:22.776 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=13150, deviceId=1
2025-05-15 20:55:22.776 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:55:22.777 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 20:55:22.777 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:55:22.777 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 20:55:22.777 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1984, deviceId=1
2025-05-15 20:55:22.777 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 20:55:22.777 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 20:55:22.778 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:55:22.778 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:55:22.779 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 20:55:22.779 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 20:55:22.779 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:55:22.780 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:55:22.780 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 20:55:22.780 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 20:55:22.783 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1984, deviceId=1
2025-05-15 20:55:22.784 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:55:22.784 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:55:22.786 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 20:55:22.792 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:55:22.816 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 565
2025-05-15 20:55:22.817 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 20:55:22.817 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 20:55:22.817 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 20:55:22.817 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 20:55:22.817 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:55:22.817 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 20:55:22.818 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 20:55:22.818 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:55:22.818 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 20:55:22.818 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 20:55:22.819 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:55:22.819 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 20:55:22.819 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 20:55:22.819 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 20:55:22.820 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 20:55:22.820 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1984, deviceId=1
2025-05-15 20:55:22.820 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 20:55:22.820 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 565
2025-05-15 20:55:22.821 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 20:55:22.821 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:55:22.821 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:55:22.822 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:55:22.822 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:55:22.822 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 20:55:22.822 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 20:55:22.822 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 20:55:22.823 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:55:22.823 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 20:55:22.825 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13150
2025-05-15 20:55:22.825 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:55:22.825 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 20:55:22.825 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:55:22.825 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 20:55:22.826 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 20:55:22.826 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 20:55:22.826 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 20:55:22.826 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:55:22.827 DEBUG [main] com.securechat.client.UserClient - hasSession: true
2025-05-15 20:55:22.827 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 20:55:22.827 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 20:55:22.839 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 20:55:22.839 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 20:55:22.840 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 20:55:22.840 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 20:55:22.841 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 20:55:22.841 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 20:55:22.843 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 20:55:22.843 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 20:55:22.843 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 20:55:22.843 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 20:55:22.844 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 943ba553-16b1-4a93-950b-834b92082cd1 from sender: alice
2025-05-15 20:55:22.844 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 20:55:22.844 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 20:55:22.844 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 20:55:22.846 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:184)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 20:55:22.848 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 943ba553-16b1-4a93-950b-834b92082cd1
2025-05-15 21:02:17.264 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:02:17.330 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14356
2025-05-15 21:02:17.331 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:02:17.355 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:02:17.355 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:02:17.355 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:17.355 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:02:17.359 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:02:17.359 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:02:17.359 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:02:17.360 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12728
2025-05-15 21:02:17.361 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:02:17.361 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:02:17.361 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:02:17.362 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:17.362 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:02:17.363 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:02:17.363 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:02:17.364 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:02:17.364 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12605
2025-05-15 21:02:17.364 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:02:17.365 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:02:17.365 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:02:17.365 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:17.365 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:02:17.366 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:02:17.366 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:02:17.367 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:02:17.370 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:02:17.373 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:02:19.384 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54087
2025-05-15 21:02:19.393 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12728
2025-05-15 21:02:19.395 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12728, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:02:19.395 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:02:19.395 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:02:19.396 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:02:19.396 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:02:19.396 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:19.396 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:02:19.397 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:02:19.397 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12728, deviceId=1
2025-05-15 21:02:19.398 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:02:19.398 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:02:19.428 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:02:19.431 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:02:19.431 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:02:19.431 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:02:19.432 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54088
2025-05-15 21:02:19.432 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12605
2025-05-15 21:02:19.433 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12605, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:02:19.433 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:02:19.433 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:02:19.433 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:02:19.433 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:02:19.433 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:02:19.433 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12728, deviceId=1
2025-05-15 21:02:19.434 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:02:19.434 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:19.434 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:02:19.434 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:02:19.434 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:02:19.434 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:02:19.434 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12605, deviceId=1
2025-05-15 21:02:19.435 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:02:19.435 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:02:19.435 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:02:19.436 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:02:19.436 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:02:19.436 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:02:19.436 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:02:19.437 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:02:19.438 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:02:19.438 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12605, deviceId=1
2025-05-15 21:02:19.439 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:02:19.439 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:02:19.445 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:02:19.453 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:19.472 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14356
2025-05-15 21:02:19.472 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:02:19.472 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:02:19.473 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:02:19.473 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:02:19.473 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:02:19.473 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:02:19.473 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:02:19.474 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:02:19.474 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:02:19.474 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:02:19.474 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:02:19.474 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:19.475 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:02:19.475 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:02:19.475 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:02:19.475 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12605, deviceId=1
2025-05-15 21:02:19.476 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:02:19.476 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14356
2025-05-15 21:02:19.476 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:02:19.476 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:02:19.476 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:02:19.477 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:02:19.477 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:02:19.477 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:02:19.477 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:02:19.478 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:02:19.478 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:02:19.478 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:19.480 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12728
2025-05-15 21:02:19.480 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:02:19.480 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:02:19.481 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:02:19.481 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:02:19.481 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 21:02:19.481 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:02:19.481 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 21:02:19.482 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:02:19.482 DEBUG [main] com.securechat.client.UserClient - hasSession: true
2025-05-15 21:02:19.482 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:02:19.482 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:02:19.494 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:02:19.494 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:02:19.494 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 21:02:19.494 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:02:19.495 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 21:02:19.495 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=PREKEY, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 21:02:19.497 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 21:02:19.497 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 21:02:19.497 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 21:02:19.498 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 21:02:19.498 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: a437943b-5522-44f5-9ab2-6a0e0b6377d8 from sender: alice
2025-05-15 21:02:19.498 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: PREKEY
2025-05-15 21:02:19.498 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 21:02:19.499 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 21:02:19.501 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:02:19.502 WARN  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:02:19.502 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:02:19.503 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:02:19.503 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:02:19.504 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12605
2025-05-15 21:02:19.504 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:02:19.504 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:02:19.506 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:02:19.506 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 2001
2025-05-15 21:02:19.506 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - From alice: testmsg
2025-05-15 21:04:51.983 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:04:52.048 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8621
2025-05-15 21:04:52.051 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:04:52.072 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:04:52.073 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:04:52.073 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:52.073 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:04:52.077 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:04:52.078 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:04:52.078 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:04:52.079 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6588
2025-05-15 21:04:52.079 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:04:52.080 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:04:52.080 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:04:52.080 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:52.080 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:04:52.082 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:04:52.082 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:04:52.082 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:04:52.083 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 5337
2025-05-15 21:04:52.083 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:04:52.084 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:04:52.084 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:04:52.084 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:52.084 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:04:52.085 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:04:52.085 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:04:52.085 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:04:52.088 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:04:52.092 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:04:54.099 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54098
2025-05-15 21:04:54.105 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6588
2025-05-15 21:04:54.106 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6588, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:04:54.107 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:04:54.108 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:04:54.108 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:04:54.109 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:04:54.109 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:54.109 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:04:54.110 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:04:54.111 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6588, deviceId=1
2025-05-15 21:04:54.112 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:04:54.112 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:04:54.139 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:04:54.143 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:04:54.143 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:04:54.143 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:04:54.144 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54099
2025-05-15 21:04:54.144 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5337
2025-05-15 21:04:54.144 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=5337, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:04:54.144 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:04:54.144 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:04:54.145 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:04:54.145 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:04:54.145 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:04:54.145 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:04:54.145 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6588, deviceId=1
2025-05-15 21:04:54.145 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:54.146 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:04:54.146 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:04:54.146 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:04:54.147 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=5337, deviceId=1
2025-05-15 21:04:54.147 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:04:54.147 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:04:54.147 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:04:54.148 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:04:54.148 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:04:54.149 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:04:54.149 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:04:54.150 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:04:54.150 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:04:54.150 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:04:54.151 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=5337, deviceId=1
2025-05-15 21:04:54.151 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:04:54.151 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:04:54.158 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:04:54.163 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:54.185 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8621
2025-05-15 21:04:54.186 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:04:54.186 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:04:54.186 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:04:54.187 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:04:54.187 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:04:54.187 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:04:54.187 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:04:54.187 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:04:54.187 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:04:54.188 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:04:54.188 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:54.188 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:04:54.189 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:04:54.189 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:04:54.189 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:04:54.189 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8621
2025-05-15 21:04:54.189 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=5337, deviceId=1
2025-05-15 21:04:54.190 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:04:54.190 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:04:54.190 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:04:54.190 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:04:54.190 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:04:54.190 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:04:54.190 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:04:54.191 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:04:54.191 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:04:54.191 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:04:54.192 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:54.194 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6588
2025-05-15 21:04:54.194 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:04:54.194 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:04:54.194 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:04:54.194 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:04:54.194 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 21:04:54.195 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:04:54.195 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:04:54.195 DEBUG [main] com.securechat.client.UserClient - Session exists: true
2025-05-15 21:04:54.195 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:04:54.195 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:04:54.207 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:04:54.207 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:04:54.207 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 21:04:54.208 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:04:54.208 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 21:04:54.209 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=PREKEY, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 21:04:54.210 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 21:04:54.210 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 21:04:54.210 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 21:04:54.211 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 21:04:54.212 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 3c566d3c-0cb5-41af-a5b5-35f73fe2ec97 from sender: alice
2025-05-15 21:04:54.212 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: PREKEY
2025-05-15 21:04:54.212 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 21:04:54.213 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 21:04:54.215 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:04:54.216 WARN  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:04:54.216 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:04:54.216 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:04:54.217 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:04:54.218 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5337
2025-05-15 21:04:54.218 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:04:54.218 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:04:54.220 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:04:54.220 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 2001
2025-05-15 21:04:54.220 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - From alice: testmsg
2025-05-15 21:10:04.083 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:10:04.149 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8090
2025-05-15 21:10:04.151 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:10:04.174 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:10:04.174 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:10:04.174 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:04.174 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:10:04.179 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:10:04.180 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:10:04.180 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:10:04.181 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11039
2025-05-15 21:10:04.181 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:10:04.182 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:10:04.182 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:10:04.183 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:04.183 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:10:04.184 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:10:04.184 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:10:04.184 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:10:04.185 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4165
2025-05-15 21:10:04.185 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:10:04.186 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:10:04.186 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:10:04.186 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:04.186 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:10:04.187 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:10:04.187 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:10:04.188 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:10:04.191 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:10:04.194 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:10:06.203 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54145
2025-05-15 21:10:06.210 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11039
2025-05-15 21:10:06.212 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11039, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:10:06.212 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:10:06.213 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:10:06.213 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:10:06.214 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:10:06.214 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:06.215 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:10:06.216 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:10:06.216 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11039, deviceId=1
2025-05-15 21:10:06.217 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:10:06.217 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:10:06.244 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:10:06.247 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:10:06.247 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:10:06.248 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:10:06.248 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54146
2025-05-15 21:10:06.248 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4165
2025-05-15 21:10:06.248 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4165, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:10:06.249 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:10:06.249 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:10:06.249 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:10:06.249 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:10:06.249 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:10:06.249 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:06.249 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:10:06.250 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:10:06.250 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:10:06.250 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11039, deviceId=1
2025-05-15 21:10:06.250 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4165, deviceId=1
2025-05-15 21:10:06.250 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:10:06.250 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:10:06.250 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:10:06.251 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:10:06.251 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:10:06.251 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:10:06.251 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:10:06.252 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:10:06.253 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:10:06.253 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:10:06.253 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4165, deviceId=1
2025-05-15 21:10:06.254 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:10:06.254 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:10:06.254 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:10:06.257 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:10:06.268 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:06.293 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8090
2025-05-15 21:10:06.293 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:10:06.293 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:10:06.293 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:10:06.294 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:10:06.294 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:10:06.294 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:10:06.294 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:10:06.294 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:10:06.294 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:10:06.294 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:10:06.294 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:10:06.295 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:06.295 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:10:06.295 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:10:06.295 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:10:06.296 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4165, deviceId=1
2025-05-15 21:10:06.296 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:10:06.296 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8090
2025-05-15 21:10:06.296 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:10:06.296 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:10:06.297 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:10:06.297 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:10:06.297 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:10:06.297 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:10:06.297 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:10:06.298 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:10:06.298 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:10:06.298 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:06.300 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11039
2025-05-15 21:10:06.301 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:10:06.301 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:10:06.301 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:10:06.301 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:10:06.301 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 21:10:06.302 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:10:06.302 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:10:06.302 DEBUG [main] com.securechat.client.UserClient - Session exists: true
2025-05-15 21:10:06.302 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:10:06.318 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:10:06.318 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:10:06.319 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 21:10:06.319 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:10:06.320 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 21:10:06.320 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 21:10:06.321 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 21:10:06.322 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 21:10:06.322 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 21:10:06.322 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 21:10:06.323 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 203716f4-e215-432a-bc49-9b0492f97b66 from sender: alice
2025-05-15 21:10:06.323 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 21:10:06.323 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 21:10:06.324 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 21:10:06.326 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:52)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:184)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 21:10:06.328 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 203716f4-e215-432a-bc49-9b0492f97b66
2025-05-15 21:10:42.038 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:10:42.107 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 16359
2025-05-15 21:10:42.109 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:10:42.132 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:10:42.132 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:10:42.132 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:42.132 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:10:42.137 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:10:42.137 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:10:42.137 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:10:42.138 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3089
2025-05-15 21:10:42.138 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:10:42.139 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:10:42.139 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:10:42.139 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:42.140 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:10:42.141 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:10:42.142 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:10:42.142 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:10:42.143 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4954
2025-05-15 21:10:42.143 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:10:42.143 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:10:42.143 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:10:42.144 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:42.144 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:10:42.144 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:10:42.145 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:10:42.145 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:10:42.147 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:10:42.151 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:10:44.156 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54151
2025-05-15 21:10:44.163 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3089
2025-05-15 21:10:44.164 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=3089, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:10:44.164 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:10:44.165 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:10:44.165 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:10:44.166 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:10:44.167 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:44.168 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:10:44.169 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:10:44.170 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=3089, deviceId=1
2025-05-15 21:10:44.170 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:10:44.171 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:10:44.193 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:10:44.196 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:10:44.196 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:10:44.196 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:10:44.196 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54152
2025-05-15 21:10:44.197 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4954
2025-05-15 21:10:44.197 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4954, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:10:44.197 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:10:44.197 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:10:44.198 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:10:44.198 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:10:44.198 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:10:44.198 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:10:44.198 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:44.199 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=3089, deviceId=1
2025-05-15 21:10:44.199 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:10:44.199 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:10:44.200 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:10:44.200 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4954, deviceId=1
2025-05-15 21:10:44.200 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:10:44.200 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:10:44.200 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:10:44.201 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:10:44.202 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:10:44.202 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:10:44.202 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:10:44.207 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:10:44.207 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:10:44.208 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4954, deviceId=1
2025-05-15 21:10:44.208 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:10:44.208 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:10:44.209 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:10:44.211 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:10:44.218 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:44.240 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16359
2025-05-15 21:10:44.240 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:10:44.241 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:10:44.241 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:10:44.241 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:10:44.241 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:10:44.241 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:10:44.242 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:10:44.242 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:10:44.242 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:10:44.242 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:44.242 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:10:44.243 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:10:44.243 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:10:44.243 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:10:44.244 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16359
2025-05-15 21:10:44.244 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:10:44.244 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:10:44.245 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:10:44.245 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=4954, deviceId=1
2025-05-15 21:10:44.245 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:10:44.245 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:10:44.245 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:10:44.245 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:10:44.246 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:10:44.246 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:10:44.246 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:10:44.246 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:10:44.247 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:44.248 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3089
2025-05-15 21:10:44.249 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:10:44.249 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:10:44.249 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:10:44.249 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:10:44.249 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 21:10:44.250 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:10:44.250 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:10:44.250 DEBUG [main] com.securechat.client.UserClient - Session exists: true
2025-05-15 21:10:44.250 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:10:44.262 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:10:44.262 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:10:44.262 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 21:10:44.262 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:10:44.263 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 21:10:44.263 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=PREKEY, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 21:10:44.265 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 21:10:44.265 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 21:10:44.265 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 21:10:44.266 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 21:10:44.266 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 4bcd998b-6005-4ee1-bf60-e0e94a491d35 from sender: alice
2025-05-15 21:10:44.266 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: PREKEY
2025-05-15 21:10:44.266 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 21:10:44.267 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 21:10:44.269 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:10:44.269 WARN  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:10:44.270 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:10:44.270 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:10:44.270 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:10:44.271 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4954
2025-05-15 21:10:44.272 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:10:44.272 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:10:44.273 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:10:44.273 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 2001
2025-05-15 21:10:44.273 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - From alice: testmsg
2025-05-15 21:13:36.511 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:13:36.578 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2755
2025-05-15 21:13:36.580 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:13:36.602 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:13:36.603 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:13:36.603 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:13:36.603 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:13:36.608 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:13:36.608 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:13:36.608 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:13:36.609 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15500
2025-05-15 21:13:36.610 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:13:36.611 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:13:36.611 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:13:36.611 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:13:36.612 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:13:36.613 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:13:36.614 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:13:36.614 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:13:36.615 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10276
2025-05-15 21:13:36.615 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:13:36.616 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:13:36.617 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:13:36.618 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:13:36.618 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:13:36.619 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:13:36.620 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:13:36.620 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:13:36.622 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:13:36.626 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:13:38.636 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54162
2025-05-15 21:13:38.642 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15500
2025-05-15 21:13:38.644 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15500, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:13:38.645 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:13:38.645 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:13:38.645 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:13:38.645 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:13:38.646 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:13:38.646 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:13:38.646 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:13:38.647 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15500, deviceId=1
2025-05-15 21:13:38.648 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:13:38.649 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:13:38.672 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:13:38.675 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:13:38.675 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:13:38.676 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:13:38.676 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54163
2025-05-15 21:13:38.676 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10276
2025-05-15 21:13:38.677 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10276, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:13:38.677 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:13:38.677 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:13:38.677 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:13:38.677 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:13:38.677 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:13:38.678 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:13:38.678 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:13:38.678 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:13:38.678 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15500, deviceId=1
2025-05-15 21:13:38.678 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:13:38.678 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10276, deviceId=1
2025-05-15 21:13:38.678 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:13:38.679 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:13:38.679 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:13:38.679 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:13:38.679 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:13:38.680 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:13:38.680 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:13:38.680 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:13:38.681 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:13:38.681 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:13:38.682 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:13:38.682 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10276, deviceId=1
2025-05-15 21:13:38.682 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:13:38.682 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:13:38.688 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:13:38.694 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:13:38.714 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2755
2025-05-15 21:13:38.714 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:13:38.715 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:13:38.715 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:13:38.715 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:13:38.715 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:13:38.716 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:13:38.716 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:13:38.716 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:13:38.717 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:13:38.717 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:13:38.717 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:13:38.717 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:13:38.718 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:13:38.718 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:13:38.718 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2755
2025-05-15 21:13:38.719 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:13:38.719 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:13:38.719 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10276, deviceId=1
2025-05-15 21:13:38.720 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:13:38.720 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:13:38.720 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:13:38.720 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:13:38.720 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:13:38.720 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:13:38.721 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:13:38.721 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:13:38.721 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:13:38.721 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:13:38.723 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15500
2025-05-15 21:13:38.723 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:13:38.723 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:13:38.724 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:13:38.724 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:13:38.724 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 21:13:38.724 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:13:38.724 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:13:38.725 DEBUG [main] com.securechat.client.UserClient - Session exists: true
2025-05-15 21:13:38.725 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:13:38.737 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:13:38.737 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:13:38.737 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 21:13:38.737 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:13:38.738 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 21:13:38.738 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 21:13:38.740 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 21:13:38.740 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 21:13:38.740 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 21:13:38.741 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 21:13:38.741 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: bbcb3944-7883-409e-9761-bdbaa7b17bb8 from sender: alice
2025-05-15 21:13:38.741 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 21:13:38.741 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 21:13:38.741 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 21:13:38.743 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:51)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:184)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 21:13:38.745 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: bbcb3944-7883-409e-9761-bdbaa7b17bb8
2025-05-15 21:16:25.642 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:16:25.717 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4214
2025-05-15 21:16:25.719 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:16:25.740 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:16:25.741 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:16:25.741 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:25.741 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:16:25.746 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:16:25.746 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:16:25.747 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:16:25.747 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12162
2025-05-15 21:16:25.747 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:16:25.748 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:16:25.748 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:16:25.749 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:25.749 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:16:25.750 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:16:25.751 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:16:25.752 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:16:25.753 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12557
2025-05-15 21:16:25.753 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:16:25.753 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:16:25.753 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:16:25.754 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:25.754 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:16:25.755 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:16:25.755 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:16:25.756 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:16:25.758 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:16:25.761 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:16:27.772 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54187
2025-05-15 21:16:27.777 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12162
2025-05-15 21:16:27.778 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12162, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:16:27.778 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:16:27.779 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:16:27.779 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:16:27.779 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:16:27.779 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:27.780 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:16:27.780 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:16:27.781 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12162, deviceId=1
2025-05-15 21:16:27.782 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:16:27.782 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:16:27.805 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:16:27.808 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:16:27.808 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:16:27.808 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:16:27.809 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54188
2025-05-15 21:16:27.809 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12557
2025-05-15 21:16:27.810 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12557, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:16:27.810 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:16:27.810 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:16:27.810 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:16:27.811 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:16:27.811 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:16:27.811 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12162, deviceId=1
2025-05-15 21:16:27.811 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:16:27.811 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:27.811 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:16:27.811 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:16:27.812 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:16:27.812 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:16:27.812 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12557, deviceId=1
2025-05-15 21:16:27.812 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:16:27.812 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:16:27.813 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:16:27.814 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:16:27.814 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:16:27.814 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:16:27.815 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:16:27.816 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:16:27.817 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54189
2025-05-15 21:16:27.817 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:16:27.817 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12162
2025-05-15 21:16:27.817 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12557, deviceId=1
2025-05-15 21:16:27.818 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12162, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:16:27.818 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:16:27.822 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:16:27.822 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:16:27.823 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:16:27.823 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:16:27.823 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:16:27.824 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:16:27.824 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:27.824 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:16:27.824 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:16:27.824 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12162, deviceId=1
2025-05-15 21:16:27.825 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:16:27.825 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:16:27.825 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:16:27.825 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:16:27.826 DEBUG [pool-1-thread-3] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:16:27.826 DEBUG [pool-1-thread-3] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:16:27.826 INFO  [pool-1-thread-3] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:16:27.826 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54190
2025-05-15 21:16:27.827 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:16:27.827 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12557
2025-05-15 21:16:27.827 DEBUG [pool-1-thread-3] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12162, deviceId=1
2025-05-15 21:16:27.827 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12557, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:16:27.827 INFO  [pool-1-thread-3] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:16:27.828 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:16:27.828 DEBUG [pool-1-thread-3] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:16:27.828 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:16:27.828 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:16:27.828 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:16:27.829 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:27.829 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:16:27.829 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:16:27.829 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12557, deviceId=1
2025-05-15 21:16:27.829 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:16:27.830 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:16:27.830 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:16:27.830 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:16:27.830 DEBUG [pool-1-thread-4] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:16:27.830 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:27.831 DEBUG [pool-1-thread-4] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:16:27.831 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-15 21:16:27.831 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current sessions stored: []
2025-05-15 21:16:27.831 INFO  [pool-1-thread-4] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:16:27.831 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:16:27.831 INFO  [pool-1-thread-4] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:16:27.832 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 21:16:27.832 DEBUG [pool-1-thread-4] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12557, deviceId=1
2025-05-15 21:16:27.832 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting pre-key message for recipient bob:1
2025-05-15 21:16:27.832 INFO  [pool-1-thread-4] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:16:27.832 DEBUG [pool-1-thread-4] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:16:27.852 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4214
2025-05-15 21:16:27.852 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:16:27.853 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:16:27.853 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:16:27.853 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:16:27.853 WARN  [pool-1-thread-4] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:16:27.853 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:16:27.854 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:16:27.854 DEBUG [pool-1-thread-4] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:16:27.855 DEBUG [pool-1-thread-4] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:27.854 ERROR [pool-1-thread-1] com.securechat.server.Server - Error handling client '/127.0.0.1:54187': null
java.io.EOFException: null
	at java.base/java.io.ObjectInputStream$BlockDataInputStream.peekByte(ObjectInputStream.java:3225)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1695)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.server.Server.handleClient(Server.java:78)
	at com.securechat.server.Server.lambda$start$0(Server.java:45)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-05-15 21:16:27.856 DEBUG [pool-1-thread-4] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4214
2025-05-15 21:16:27.856 DEBUG [pool-1-thread-4] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:16:27.856 INFO  [pool-1-thread-4] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:16:27.857 INFO  [pool-1-thread-4] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:16:27.857 INFO  [pool-1-thread-4] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:16:27.857 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:16:27.857 INFO  [pool-1-thread-4] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:16:27.857 INFO  [pool-1-thread-4] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:16:27.857 DEBUG [pool-1-thread-3] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for alice:1: true
2025-05-15 21:16:27.857 ERROR [main] com.securechat.client.UserClient - Error sending message from alice to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptPreKeyMessage(SignalProtocolManager.java:65)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:115)
	at com.securechat.Launcher.main(Launcher.java:67)
2025-05-15 21:16:27.858 DEBUG [pool-1-thread-3] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:16:27.858 INFO  [main] com.securechat.Launcher - Alice sent a prekey message to Bob
2025-05-15 21:16:27.858 DEBUG [pool-1-thread-3] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:27.861 DEBUG [pool-1-thread-3] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4214
2025-05-15 21:16:27.866 DEBUG [pool-1-thread-3] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:16:27.866 DEBUG [pool-1-thread-3] c.s.crypto.libsignal.SignalKeyStore - Identity for address alice:1 is unchanged
2025-05-15 21:16:27.866 INFO  [pool-1-thread-3] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:16:27.867 INFO  [pool-1-thread-3] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:16:27.867 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:16:27.867 INFO  [pool-1-thread-3] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:16:27.867 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:16:27.868 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:16:27.869 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:16:27.871 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4214
2025-05-15 21:16:27.872 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:16:27.873 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 21:16:27.873 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:16:27.873 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:16:27.873 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:16:27.874 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:17:44.531 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:17:44.595 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14766
2025-05-15 21:17:44.598 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:17:44.620 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:17:44.621 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:17:44.621 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:17:44.621 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:17:44.626 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:17:44.627 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:17:44.627 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:17:44.627 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12022
2025-05-15 21:17:44.628 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:17:44.628 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:17:44.628 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:17:44.629 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:17:44.629 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:17:44.631 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:17:44.631 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:17:44.631 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:17:44.632 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 727
2025-05-15 21:17:44.632 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:17:44.632 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:17:44.633 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:17:44.633 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:17:44.633 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:17:44.634 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:17:44.634 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:17:44.634 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:17:44.637 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:17:44.640 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:17:46.652 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54195
2025-05-15 21:17:46.661 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12022
2025-05-15 21:17:46.662 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12022, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:17:46.663 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:17:46.663 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:17:46.664 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:17:46.664 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:17:46.664 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:17:46.664 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:17:46.665 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:17:46.665 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12022, deviceId=1
2025-05-15 21:17:46.666 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:17:46.666 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:17:46.691 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:17:46.693 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:17:46.693 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:17:46.694 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:17:46.695 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54196
2025-05-15 21:17:46.695 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 727
2025-05-15 21:17:46.695 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:17:46.695 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=727, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:17:46.696 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:17:46.696 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:17:46.696 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:17:46.696 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12022, deviceId=1
2025-05-15 21:17:46.696 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:17:46.696 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:17:46.696 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:17:46.696 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:17:46.697 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:17:46.697 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:17:46.697 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:17:46.697 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=727, deviceId=1
2025-05-15 21:17:46.697 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:17:46.698 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:17:46.698 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:17:46.698 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:17:46.698 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:17:46.699 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-15 21:17:46.699 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:17:46.703 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current sessions stored: []
2025-05-15 21:17:46.703 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:17:46.703 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:17:46.703 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:17:46.703 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:17:46.704 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 21:17:46.704 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=727, deviceId=1
2025-05-15 21:17:46.704 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting pre-key message for recipient bob:1
2025-05-15 21:17:46.704 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:17:46.704 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:17:46.706 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:17:46.712 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:17:46.732 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14766
2025-05-15 21:17:46.733 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:17:46.733 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:17:46.733 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:17:46.734 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:17:46.734 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:17:46.734 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:17:46.734 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:17:46.734 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:17:46.735 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:17:46.736 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14766
2025-05-15 21:17:46.737 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:17:46.737 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:17:46.737 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:17:46.737 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:17:46.737 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:17:46.737 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:17:46.737 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:17:46.737 ERROR [main] com.securechat.client.UserClient - Error sending message from alice to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptPreKeyMessage(SignalProtocolManager.java:65)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:115)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-15 21:17:46.739 INFO  [main] com.securechat.Launcher - Alice sent a prekey message to Bob
2025-05-15 21:17:46.740 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:17:46.740 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:17:46.740 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:17:46.741 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:17:46.741 WARN  [UserClient-Listener-alice] com.securechat.client.UserClient - Received unknown object: class java.lang.String
2025-05-15 21:19:40.539 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:19:40.605 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12118
2025-05-15 21:19:40.607 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:19:40.629 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:19:40.629 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:19:40.630 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:19:40.630 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:19:40.634 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:19:40.634 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:19:40.635 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:19:40.635 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1503
2025-05-15 21:19:40.636 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:19:40.636 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:19:40.637 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:19:40.637 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:19:40.637 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:19:40.638 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:19:40.639 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:19:40.639 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:19:40.639 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15602
2025-05-15 21:19:40.640 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:19:40.640 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:19:40.640 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:19:40.640 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:19:40.640 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:19:40.641 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:19:40.641 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:19:40.642 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:19:40.646 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:19:40.649 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:19:42.655 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54204
2025-05-15 21:19:42.662 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1503
2025-05-15 21:19:42.664 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1503, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:19:42.665 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:19:42.666 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:19:42.666 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:19:42.666 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:19:42.667 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:19:42.667 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:19:42.669 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:19:42.670 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1503, deviceId=1
2025-05-15 21:19:42.671 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:19:42.671 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:19:42.694 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:19:42.697 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:19:42.697 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:19:42.697 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:19:42.698 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54205
2025-05-15 21:19:42.699 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15602
2025-05-15 21:19:42.699 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:19:42.699 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15602, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:19:42.699 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:19:42.699 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:19:42.699 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:19:42.700 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1503, deviceId=1
2025-05-15 21:19:42.700 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:19:42.700 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:19:42.700 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:19:42.701 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:19:42.701 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:19:42.701 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:19:42.701 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:19:42.702 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15602, deviceId=1
2025-05-15 21:19:42.702 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:19:42.702 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:19:42.703 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:19:42.703 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:19:42.704 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:19:42.704 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:19:42.704 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-15 21:19:42.704 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:19:42.708 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current sessions stored: []
2025-05-15 21:19:42.709 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:19:42.709 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:19:42.709 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 21:19:42.710 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:19:42.710 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting pre-key message for recipient bob:1
2025-05-15 21:19:42.711 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15602, deviceId=1
2025-05-15 21:19:42.711 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:19:42.711 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:19:42.711 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:19:42.717 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:19:42.740 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12118
2025-05-15 21:19:42.741 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:19:42.741 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:19:42.741 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:19:42.741 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:19:42.741 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:19:42.742 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:19:42.742 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:19:42.742 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:19:42.743 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:19:42.744 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12118
2025-05-15 21:19:42.744 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:19:42.744 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:19:42.745 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:19:42.745 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:19:42.745 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:19:42.745 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:19:42.745 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:19:42.745 ERROR [main] com.securechat.client.UserClient - Error sending message from alice to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptPreKeyMessage(SignalProtocolManager.java:65)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:115)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-15 21:19:42.747 INFO  [main] com.securechat.Launcher - Alice sent a prekey message to Bob
2025-05-15 21:22:43.348 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:22:43.412 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 7452
2025-05-15 21:22:43.415 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:22:43.437 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:22:43.438 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:22:43.438 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:22:43.438 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:22:43.442 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:22:43.443 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:22:43.443 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:22:43.444 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15380
2025-05-15 21:22:43.444 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:22:43.444 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:22:43.445 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:22:43.445 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:22:43.445 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:22:43.447 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:22:43.447 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:22:43.447 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:22:43.448 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14498
2025-05-15 21:22:43.448 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:22:43.449 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:22:43.449 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:22:43.449 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:22:43.449 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:22:43.450 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:22:43.450 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:22:43.451 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:22:43.453 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:22:43.456 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:22:45.462 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54216
2025-05-15 21:22:45.466 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15380
2025-05-15 21:22:45.467 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15380, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:22:45.468 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:22:45.468 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:22:45.468 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:22:45.469 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:22:45.469 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:22:45.469 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:22:45.470 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:22:45.471 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15380, deviceId=1
2025-05-15 21:22:45.471 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:22:45.472 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:22:45.496 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:22:45.499 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:22:45.499 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:22:45.499 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:22:45.500 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54217
2025-05-15 21:22:45.500 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14498
2025-05-15 21:22:45.500 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=14498, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:22:45.500 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:22:45.501 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:22:45.501 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:22:45.501 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:22:45.501 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:22:45.501 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:22:45.501 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:22:45.502 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15380, deviceId=1
2025-05-15 21:22:45.502 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:22:45.502 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:22:45.502 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:22:45.502 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=14498, deviceId=1
2025-05-15 21:22:45.502 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:22:45.503 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:22:45.503 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:22:45.504 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:22:45.505 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:22:45.505 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:22:45.506 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:22:45.506 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:22:45.507 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:22:45.507 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:22:45.507 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=14498, deviceId=1
2025-05-15 21:22:45.507 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:22:45.508 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:22:45.513 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:22:45.519 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:22:45.541 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7452
2025-05-15 21:22:45.542 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:22:45.542 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:22:45.542 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:22:45.542 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:22:45.542 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:22:45.543 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:22:45.543 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:22:45.543 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:22:45.543 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:22:45.544 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:22:45.544 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:22:45.544 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:22:45.545 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:22:45.545 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:22:45.545 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7452
2025-05-15 21:22:45.545 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:22:45.546 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:22:45.546 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=14498, deviceId=1
2025-05-15 21:22:45.546 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:22:45.546 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:22:45.546 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:22:45.546 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:22:45.546 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:22:45.546 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:22:45.547 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:22:45.547 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:22:45.547 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:22:45.547 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:22:45.549 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15380
2025-05-15 21:22:45.549 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:22:45.550 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:22:45.550 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:22:45.550 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:22:45.550 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 21:22:45.551 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:22:45.551 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:22:45.551 DEBUG [main] com.securechat.client.UserClient - Session exists: true
2025-05-15 21:22:45.551 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:22:45.562 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:22:45.562 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:22:45.563 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 21:22:45.563 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:22:45.564 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 21:22:45.564 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=CIPHERTEXT, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 21:22:45.565 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 21:22:45.565 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 21:22:45.566 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 21:22:45.566 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 21:22:45.566 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 44838807-19ee-45c6-90e1-2ca361ad5ace from sender: alice
2025-05-15 21:22:45.567 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: CIPHERTEXT
2025-05-15 21:22:45.567 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 21:22:45.567 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 21:22:45.569 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:51)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:184)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-15 21:22:45.571 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - Decryption failed or returned null for message ID: 44838807-19ee-45c6-90e1-2ca361ad5ace
2025-05-15 21:23:02.866 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:23:02.930 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9540
2025-05-15 21:23:02.931 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:23:02.954 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:23:02.954 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:23:02.955 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:02.955 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:23:02.959 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:23:02.960 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:23:02.960 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:23:02.961 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12671
2025-05-15 21:23:02.961 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:23:02.962 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:23:02.962 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:23:02.962 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:02.962 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:23:02.963 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:23:02.964 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:23:02.964 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:23:02.964 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15822
2025-05-15 21:23:02.965 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:23:02.965 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:23:02.965 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:23:02.966 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:02.966 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:23:02.967 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:23:02.967 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:23:02.968 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:23:02.970 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:23:02.973 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:23:04.979 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54221
2025-05-15 21:23:04.983 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12671
2025-05-15 21:23:04.984 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12671, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:23:04.984 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:23:04.984 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:23:04.985 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:23:04.985 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:23:04.985 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:04.986 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:23:04.987 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:23:04.988 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12671, deviceId=1
2025-05-15 21:23:04.988 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:23:04.988 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:23:05.011 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:23:05.013 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:23:05.014 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:23:05.014 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:23:05.014 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54222
2025-05-15 21:23:05.015 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15822
2025-05-15 21:23:05.015 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15822, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:23:05.015 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:23:05.015 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:23:05.015 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:23:05.015 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:23:05.016 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:23:05.016 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:23:05.016 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:05.016 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12671, deviceId=1
2025-05-15 21:23:05.016 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:23:05.016 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:23:05.016 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:23:05.016 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15822, deviceId=1
2025-05-15 21:23:05.017 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:23:05.017 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:23:05.017 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:23:05.017 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:23:05.018 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:23:05.018 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:23:05.018 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:23:05.019 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:23:05.020 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:23:05.020 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:23:05.020 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15822, deviceId=1
2025-05-15 21:23:05.020 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:23:05.021 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:23:05.027 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:23:05.033 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:05.053 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9540
2025-05-15 21:23:05.053 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:23:05.053 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:23:05.054 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:23:05.054 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:23:05.054 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:23:05.054 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:23:05.054 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:23:05.055 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:23:05.055 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:23:05.055 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:23:05.055 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:05.055 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:23:05.056 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:23:05.056 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:23:05.056 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9540
2025-05-15 21:23:05.056 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:23:05.057 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:23:05.057 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15822, deviceId=1
2025-05-15 21:23:05.057 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:23:05.057 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:23:05.057 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:23:05.057 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:23:05.058 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:23:05.058 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:23:05.058 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:23:05.058 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:23:05.058 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:23:05.059 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:05.060 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12671
2025-05-15 21:23:05.061 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:23:05.061 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:23:05.061 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:23:05.061 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:23:05.061 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 21:23:05.062 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:23:05.062 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:23:05.062 DEBUG [main] com.securechat.client.UserClient - Session exists: true
2025-05-15 21:23:05.062 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:23:05.074 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:23:05.074 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:23:05.074 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 is unchanged
2025-05-15 21:23:05.075 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:23:05.075 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 21:23:05.076 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=PREKEY, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 21:23:05.077 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 21:23:05.078 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 21:23:05.078 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 21:23:05.078 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 21:23:05.078 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: 9ba850b6-395b-48af-b84f-1297480578d7 from sender: alice
2025-05-15 21:23:05.079 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: PREKEY
2025-05-15 21:23:05.079 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 21:23:05.079 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 21:23:05.082 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:23:05.082 WARN  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:23:05.082 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:23:05.083 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:23:05.083 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:23:05.084 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15822
2025-05-15 21:23:05.085 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:23:05.085 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:23:05.086 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:23:05.087 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 2001
2025-05-15 21:23:05.087 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - From alice: testmsg
2025-05-15 21:30:01.311 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:30:01.377 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10025
2025-05-15 21:30:01.379 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:30:01.402 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:30:01.402 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:30:01.402 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:30:01.402 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:30:01.408 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:30:01.408 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:30:01.408 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:30:01.409 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 7702
2025-05-15 21:30:01.409 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:30:01.410 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:30:01.410 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:30:01.411 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:30:01.411 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:30:01.412 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:30:01.412 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:30:01.413 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:30:01.413 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9393
2025-05-15 21:30:01.413 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:30:01.414 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:30:01.414 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:30:01.414 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:30:01.414 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:30:01.415 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:30:01.415 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:30:01.415 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:30:01.418 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:30:01.421 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:30:03.425 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54244
2025-05-15 21:30:03.431 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7702
2025-05-15 21:30:03.432 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=7702, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:30:03.433 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:30:03.433 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:30:03.434 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:30:03.434 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:30:03.435 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:30:03.435 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:30:03.436 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:30:03.437 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=7702, deviceId=1
2025-05-15 21:30:03.438 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:30:03.438 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:30:03.464 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:30:03.466 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:30:03.466 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:30:03.467 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:30:03.468 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54245
2025-05-15 21:30:03.468 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:30:03.468 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9393
2025-05-15 21:30:03.469 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9393, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:30:03.469 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:30:03.469 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:30:03.469 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=7702, deviceId=1
2025-05-15 21:30:03.469 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:30:03.469 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:30:03.469 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:30:03.470 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:30:03.470 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:30:03.470 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:30:03.470 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:30:03.470 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:30:03.471 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9393, deviceId=1
2025-05-15 21:30:03.471 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:30:03.471 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:30:03.471 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:30:03.472 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:30:03.472 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:30:03.472 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:30:03.472 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-15 21:30:03.473 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:30:03.477 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current sessions stored: []
2025-05-15 21:30:03.477 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:30:03.477 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:30:03.477 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:30:03.478 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 21:30:03.478 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=9393, deviceId=1
2025-05-15 21:30:03.478 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting pre-key message for recipient bob:1
2025-05-15 21:30:03.478 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:30:03.478 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:30:03.480 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:30:03.486 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:30:03.508 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10025
2025-05-15 21:30:03.509 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:30:03.509 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:30:03.509 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:30:03.509 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:30:03.509 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:30:03.510 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:30:03.510 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:30:03.510 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:30:03.511 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:30:03.512 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10025
2025-05-15 21:30:03.512 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:30:03.513 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:30:03.513 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:30:03.513 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:30:03.513 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:30:03.513 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:30:03.514 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:30:03.514 ERROR [main] com.securechat.client.UserClient - Error sending message from alice to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptPreKeyMessage(SignalProtocolManager.java:67)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:115)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-15 21:30:03.516 INFO  [main] com.securechat.Launcher - Alice sent a prekey message to Bob
2025-05-15 21:30:03.516 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:30:03.516 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:30:03.517 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:30:03.517 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:30:03.517 WARN  [UserClient-Listener-alice] com.securechat.client.UserClient - Received unknown object: class java.lang.String
2025-05-15 21:31:34.517 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:31:34.583 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15828
2025-05-15 21:31:34.585 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:31:34.608 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:31:34.608 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:31:34.609 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:31:34.609 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:31:34.613 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:31:34.614 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:31:34.614 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:31:34.615 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2125
2025-05-15 21:31:34.615 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:31:34.616 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:31:34.616 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:31:34.616 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:31:34.616 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:31:34.617 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:31:34.618 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:31:34.618 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:31:34.618 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3944
2025-05-15 21:31:34.618 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:31:34.619 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:31:34.619 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:31:34.619 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:31:34.619 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:31:34.621 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:31:34.621 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:31:34.621 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:31:34.624 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:31:34.627 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:31:36.643 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54252
2025-05-15 21:31:36.648 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2125
2025-05-15 21:31:36.648 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=2125, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:31:36.649 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:31:36.649 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:31:36.649 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:31:36.649 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:31:36.649 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:31:36.650 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:31:36.650 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:31:36.651 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=2125, deviceId=1
2025-05-15 21:31:36.651 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:31:36.651 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:31:36.676 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:31:36.679 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:31:36.679 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:31:36.680 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:31:36.681 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54253
2025-05-15 21:31:36.681 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3944
2025-05-15 21:31:36.681 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:31:36.681 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=3944, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:31:36.682 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:31:36.682 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:31:36.682 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:31:36.682 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=2125, deviceId=1
2025-05-15 21:31:36.682 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:31:36.683 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:31:36.683 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:31:36.683 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:31:36.683 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:31:36.684 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:31:36.684 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:31:36.684 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=3944, deviceId=1
2025-05-15 21:31:36.684 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:31:36.684 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:31:36.685 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:31:36.685 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:31:36.685 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:31:36.686 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-15 21:31:36.686 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:31:36.689 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:31:36.689 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current sessions stored: []
2025-05-15 21:31:36.690 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:31:36.690 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:31:36.690 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:31:36.690 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 21:31:36.691 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=3944, deviceId=1
2025-05-15 21:31:36.691 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting pre-key message for recipient bob:1
2025-05-15 21:31:36.691 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:31:36.691 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:31:36.693 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:31:36.700 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:31:36.723 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15828
2025-05-15 21:31:36.723 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:31:36.724 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: alice:1
2025-05-15 21:31:36.724 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:31:36.724 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:31:36.724 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:31:36.724 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:31:36.724 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:31:36.724 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:31:36.725 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:31:36.726 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15828
2025-05-15 21:31:36.727 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:31:36.727 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved for address: bob:1
2025-05-15 21:31:36.727 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:31:36.727 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:31:36.727 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:31:36.728 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:31:36.728 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:31:36.728 ERROR [main] com.securechat.client.UserClient - Error sending message from alice to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptPreKeyMessage(SignalProtocolManager.java:67)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:115)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-15 21:31:36.730 INFO  [main] com.securechat.Launcher - Alice sent a prekey message to Bob
2025-05-15 21:40:32.866 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:40:32.933 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1574
2025-05-15 21:40:32.935 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:40:32.956 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:40:32.956 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:40:32.956 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:40:32.957 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:40:32.961 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:40:32.962 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:40:32.962 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:40:32.962 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 5062
2025-05-15 21:40:32.963 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:40:32.963 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:40:32.964 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:40:32.964 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:40:32.964 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:40:32.965 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:40:32.966 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:40:32.966 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:40:32.967 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2396
2025-05-15 21:40:32.967 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:40:32.967 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:40:32.968 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:40:32.968 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:40:32.968 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:40:32.969 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:40:32.969 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:40:32.969 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:40:32.972 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:40:32.975 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:40:34.986 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54290
2025-05-15 21:40:34.989 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5062
2025-05-15 21:40:34.990 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=5062, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:40:34.991 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:40:34.991 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:40:34.991 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:40:34.992 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:40:34.992 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:40:34.992 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:40:34.993 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:40:34.993 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=5062, deviceId=1
2025-05-15 21:40:34.994 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:40:34.994 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:40:35.021 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:40:35.024 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:40:35.024 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:40:35.025 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:40:35.026 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54291
2025-05-15 21:40:35.026 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2396
2025-05-15 21:40:35.026 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:40:35.026 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=2396, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:40:35.027 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:40:35.027 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:40:35.027 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:40:35.027 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=5062, deviceId=1
2025-05-15 21:40:35.027 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:40:35.028 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:40:35.028 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:40:35.028 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:40:35.028 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:40:35.028 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:40:35.028 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:40:35.028 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=2396, deviceId=1
2025-05-15 21:40:35.029 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:40:35.029 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:40:35.030 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:40:35.030 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:40:35.030 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:40:35.030 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:40:35.030 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-15 21:40:35.034 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:40:35.034 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:40:35.034 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-15 21:40:35.034 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:40:35.035 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:40:35.035 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=2396, deviceId=1
2025-05-15 21:40:35.035 DEBUG [main] com.securechat.client.UserClient - Session exists: false
2025-05-15 21:40:35.035 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:40:35.035 DEBUG [main] c.s.c.l.SignalProtocolManager - Encrypting pre-key message for recipient bob:1
2025-05-15 21:40:35.036 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:40:35.037 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:40:35.044 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:40:35.067 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1574
2025-05-15 21:40:35.067 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:40:35.068 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-15 21:40:35.068 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:40:35.068 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:40:35.068 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:40:35.068 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:40:35.069 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:40:35.069 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:40:35.070 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:40:35.071 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1574
2025-05-15 21:40:35.072 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:40:35.072 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1
2025-05-15 21:40:35.072 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:40:35.072 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:40:35.072 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:40:35.072 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:40:35.073 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:40:35.073 ERROR [main] com.securechat.client.UserClient - Error sending message from alice to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptPreKeyMessage(SignalProtocolManager.java:65)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:115)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-15 21:40:35.074 INFO  [main] com.securechat.Launcher - Alice sent a prekey message to Bob
2025-05-15 21:41:13.560 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-15 21:41:13.626 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12551
2025-05-15 21:41:13.628 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-15 21:41:13.650 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-15 21:41:13.651 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-15 21:41:13.651 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:13.651 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-15 21:41:13.656 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-15 21:41:13.656 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-15 21:41:13.657 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-15 21:41:13.657 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8401
2025-05-15 21:41:13.658 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-15 21:41:13.658 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-15 21:41:13.658 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-15 21:41:13.659 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:13.659 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-15 21:41:13.660 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-15 21:41:13.661 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-15 21:41:13.661 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:41:13.662 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 16018
2025-05-15 21:41:13.662 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-15 21:41:13.663 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-15 21:41:13.663 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-15 21:41:13.663 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:13.663 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-15 21:41:13.664 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-15 21:41:13.665 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-15 21:41:13.665 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:41:13.667 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-15 21:41:13.670 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-15 21:41:15.684 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54295
2025-05-15 21:41:15.688 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8401
2025-05-15 21:41:15.690 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8401, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-15 21:41:15.690 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-15 21:41:15.691 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-15 21:41:15.691 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-15 21:41:15.692 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-15 21:41:15.692 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:15.692 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:41:15.693 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:41:15.693 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8401, deviceId=1
2025-05-15 21:41:15.694 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:41:15.694 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:41:15.722 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:41:15.725 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received registration from user 'alice'
2025-05-15 21:41:15.725 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-15 21:41:15.725 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:41:15.726 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:54296
2025-05-15 21:41:15.726 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16018
2025-05-15 21:41:15.726 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=16018, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-15 21:41:15.726 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:41:15.727 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:41:15.727 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-15 21:41:15.727 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:41:15.727 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-15 21:41:15.727 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-15 21:41:15.727 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8401, deviceId=1
2025-05-15 21:41:15.727 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:15.728 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-15 21:41:15.728 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:41:15.728 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-15 21:41:15.728 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=16018, deviceId=1
2025-05-15 21:41:15.728 DEBUG [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-15 21:41:15.728 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-15 21:41:15.728 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:41:15.729 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:41:15.729 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-15 21:41:15.729 DEBUG [pool-1-thread-2] com.securechat.server.Server - Received registration from user 'bob'
2025-05-15 21:41:15.730 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:41:15.730 WARN  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:41:15.731 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:41:15.732 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-15 21:41:15.732 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=16018, deviceId=1
2025-05-15 21:41:15.732 INFO  [pool-1-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:41:15.732 DEBUG [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:41:15.738 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:41:15.746 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:15.767 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12551
2025-05-15 21:41:15.768 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:41:15.768 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-15 21:41:15.768 INFO  [pool-1-thread-1] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:41:15.768 INFO  [pool-1-thread-1] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-15 21:41:15.768 WARN  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:41:15.768 INFO  [pool-1-thread-1] com.securechat.server.Server - Secure session established with user 'alice'
2025-05-15 21:41:15.769 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-15 21:41:15.769 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:41:15.769 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-15 21:41:15.769 DEBUG [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-15 21:41:15.770 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:15.770 INFO  [pool-1-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-15 21:41:15.771 INFO  [pool-1-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-15 21:41:15.771 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-15 21:41:15.771 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-15 21:41:15.771 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=16018, deviceId=1
2025-05-15 21:41:15.772 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12551
2025-05-15 21:41:15.772 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-15 21:41:15.772 DEBUG [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:41:15.772 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-15 21:41:15.772 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1
2025-05-15 21:41:15.772 INFO  [pool-1-thread-2] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:41:15.773 INFO  [pool-1-thread-2] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:41:15.773 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-15 21:41:15.773 INFO  [pool-1-thread-2] com.securechat.server.Server - Secure session established with user 'bob'
2025-05-15 21:41:15.773 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-15 21:41:15.773 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:41:15.774 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:15.776 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8401
2025-05-15 21:41:15.776 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:41:15.776 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1
2025-05-15 21:41:15.776 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:41:15.776 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-15 21:41:15.777 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-15 21:41:15.777 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-15 21:41:15.777 DEBUG [main] com.securechat.client.UserClient - Checking if session exists for recipient address: bob:1
2025-05-15 21:41:15.777 DEBUG [main] com.securechat.client.UserClient - Session exists: true
2025-05-15 21:41:15.778 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-15 21:41:15.789 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-15 21:41:15.790 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-15 21:41:15.790 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 unchanged
2025-05-15 21:41:15.790 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-15 21:41:15.791 DEBUG [main] com.securechat.client.UserClient - isPreKey: false
2025-05-15 21:41:15.791 INFO  [main] com.securechat.client.UserClient - Sending message to 'bob': type=PREKEY, plaintext='testmsg', ciphertext length=148 bytes, base64 length=200
2025-05-15 21:41:15.792 INFO  [main] com.securechat.client.UserClient - Message sent successfully from alice to bob
2025-05-15 21:41:15.793 INFO  [main] com.securechat.Launcher - Alice sent an encrypted message to Bob
2025-05-15 21:41:15.793 INFO  [pool-1-thread-1] com.securechat.server.Server - Received message from 'alice': routing to 'bob'
2025-05-15 21:41:15.793 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-15 21:41:15.793 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received message ID: c1e29f12-ea3f-4474-af12-a9dd8e219622 from sender: alice
2025-05-15 21:41:15.793 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Message type: PREKEY
2025-05-15 21:41:15.794 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Base64 ciphertext length: 200
2025-05-15 21:41:15.794 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Decoded ciphertext length: 148 bytes
2025-05-15 21:41:15.797 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-15 21:41:15.797 WARN  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-15 21:41:15.797 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-15 21:41:15.798 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-15 21:41:15.798 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-15 21:41:15.799 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16018
2025-05-15 21:41:15.799 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-15 21:41:15.799 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-15 21:41:15.801 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-15 21:41:15.801 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 2001
2025-05-15 21:41:15.801 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - From alice: testmsg
