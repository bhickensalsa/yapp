2025-05-16 00:33:32.083 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 00:33:32.167 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8145
2025-05-16 00:33:32.169 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 00:33:32.192 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 00:33:32.192 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 00:33:32.193 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 00:33:32.193 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 00:33:32.197 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 00:33:32.198 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 00:33:32.198 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 00:33:32.199 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2451
2025-05-16 00:33:32.199 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 00:33:32.200 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 00:33:32.200 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 00:33:32.200 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 00:33:32.200 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 00:33:32.201 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 00:33:32.201 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 00:33:32.202 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 00:33:32.202 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4698
2025-05-16 00:33:32.202 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 00:33:32.203 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 00:33:32.203 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 00:33:32.204 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 00:33:32.204 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 00:33:32.205 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 00:33:32.205 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 00:33:32.206 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 00:33:32.208 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-16 00:33:32.212 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-16 00:33:34.216 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53638
2025-05-16 00:33:34.221 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2451
2025-05-16 00:33:34.222 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=2451, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 00:33:34.223 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 00:33:34.223 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 00:33:34.223 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 00:33:34.224 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 00:33:34.224 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 00:33:34.224 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 00:33:34.225 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 00:33:34.226 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=2451, deviceId=1
2025-05-16 00:33:34.227 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 00:33:34.227 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-16 00:33:34.259 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-16 00:33:34.260 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 00:33:34.260 DEBUG [pool-2-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-16 00:33:34.261 INFO  [pool-2-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-16 00:33:34.262 INFO  [pool-2-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 00:33:34.263 INFO  [pool-2-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 00:33:34.761 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:53639
2025-05-16 00:33:34.761 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4698
2025-05-16 00:33:34.762 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4698, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 00:33:34.762 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 00:33:34.762 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 00:33:34.762 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 00:33:34.763 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 00:33:34.763 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 00:33:34.763 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 00:33:34.763 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 00:33:34.763 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4698, deviceId=1
2025-05-16 00:33:34.764 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 00:33:34.764 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-16 00:33:34.764 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-16 00:33:34.765 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 00:33:34.765 DEBUG [pool-2-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserializing JSON to PreKeyBundleDTO
2025-05-16 00:33:34.766 INFO  [pool-2-thread-2] c.s.crypto.libsignal.PreKeyBundleDTO - Deserialization from JSON successful
2025-05-16 00:33:34.766 INFO  [pool-2-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 00:33:34.770 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 00:33:34.770 INFO  [pool-2-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 00:33:34.771 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 00:33:34.772 INFO  [main] com.securechat.client.UserClient - No session with bob. Attempting to establish session.
2025-05-16 00:33:34.773 DEBUG [pool-2-thread-1] com.securechat.server.Server - Received command from 'alice': GET_PREKEY_BUNDLE:bob
2025-05-16 00:33:34.773 DEBUG [pool-2-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serializing PreKeyBundleDTO to JSON
2025-05-16 00:33:34.774 INFO  [pool-2-thread-1] c.s.crypto.libsignal.PreKeyBundleDTO - Serialization to JSON completed
2025-05-16 00:33:34.774 INFO  [pool-2-thread-1] com.securechat.server.Server - Served prekey bundle for 'bob'
2025-05-16 00:33:34.775 WARN  [UserClient-Listener-alice] com.securechat.client.UserClient - Received unknown object: class java.lang.String
2025-05-16 01:13:01.679 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 01:13:01.751 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2350
2025-05-16 01:13:01.753 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 01:13:01.777 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 01:13:01.778 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 01:13:01.779 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:01.779 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 01:13:01.784 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 01:13:01.785 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 01:13:01.786 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 01:13:01.787 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15898
2025-05-16 01:13:01.787 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 01:13:01.788 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 01:13:01.789 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 01:13:01.789 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:01.789 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 01:13:01.791 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 01:13:01.792 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 01:13:01.793 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:13:01.794 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9353
2025-05-16 01:13:01.794 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 01:13:01.794 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 01:13:01.794 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 01:13:01.795 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:01.795 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 01:13:01.796 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 01:13:01.796 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 01:13:01.797 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:13:01.799 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-16 01:13:01.803 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-16 01:13:03.807 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:65459
2025-05-16 01:13:03.815 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15898
2025-05-16 01:13:03.815 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15898, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:13:03.816 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:13:03.816 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:13:03.816 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:13:03.816 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:13:03.817 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:03.817 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:13:03.818 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:13:03.818 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15898, deviceId=1
2025-05-16 01:13:03.819 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:13:03.827 ERROR [pool-1-thread-1] com.securechat.server.Server - Error handling client '/127.0.0.1:65459': writing aborted; java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
java.io.WriteAbortedException: writing aborted; java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1751)
	at java.base/java.io.ObjectInputStream$FieldValues.<init>(ObjectInputStream.java:2617)
	at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2468)
	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2268)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1744)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.server.Server.handleClient(Server.java:59)
	at com.securechat.server.Server.lambda$0(Server.java:44)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at com.securechat.network.PeerConnection.sendObject(PeerConnection.java:20)
	at com.securechat.client.UserClient.connectToServer(UserClient.java:65)
	at com.securechat.Launcher.main(Launcher.java:53)
2025-05-16 01:13:03.826 ERROR [main] com.securechat.client.UserClient - Failed to connect/register with server: com.securechat.crypto.libsignal.PreKeyBundleDTO
java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at com.securechat.network.PeerConnection.sendObject(PeerConnection.java:20)
	at com.securechat.client.UserClient.connectToServer(UserClient.java:65)
	at com.securechat.Launcher.main(Launcher.java:53)
2025-05-16 01:13:04.330 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:65460
2025-05-16 01:13:04.331 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9353
2025-05-16 01:13:04.331 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9353, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:13:04.332 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:13:04.332 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:13:04.332 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:13:04.333 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:13:04.333 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:04.334 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:13:04.334 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:13:04.334 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9353, deviceId=1
2025-05-16 01:13:04.335 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:13:04.337 ERROR [main] com.securechat.client.UserClient - Failed to connect/register with server: com.securechat.crypto.libsignal.PreKeyBundleDTO
java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at com.securechat.network.PeerConnection.sendObject(PeerConnection.java:20)
	at com.securechat.client.UserClient.connectToServer(UserClient.java:65)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-16 01:13:04.338 ERROR [pool-1-thread-1] com.securechat.server.Server - Error handling client '/127.0.0.1:65460': writing aborted; java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
java.io.WriteAbortedException: writing aborted; java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1751)
	at java.base/java.io.ObjectInputStream$FieldValues.<init>(ObjectInputStream.java:2617)
	at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2468)
	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2268)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1744)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.server.Server.handleClient(Server.java:59)
	at com.securechat.server.Server.lambda$0(Server.java:44)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at com.securechat.network.PeerConnection.sendObject(PeerConnection.java:20)
	at com.securechat.client.UserClient.connectToServer(UserClient.java:65)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-16 01:13:04.340 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 01:13:04.341 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 01:13:04.342 ERROR [UserClient-Listener-bob] com.securechat.client.UserClient - Listening thread encountered error: null
java.io.EOFException: null
	at java.base/java.io.ObjectInputStream$BlockDataInputStream.peekByte(ObjectInputStream.java:3225)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1695)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:166)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-05-16 01:13:04.342 ERROR [UserClient-Listener-alice] com.securechat.client.UserClient - Listening thread encountered error: null
java.io.EOFException: null
	at java.base/java.io.ObjectInputStream$BlockDataInputStream.peekByte(ObjectInputStream.java:3225)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1695)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:166)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-05-16 01:13:04.345 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 01:13:04.375 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:116)
	at com.securechat.Launcher.main(Launcher.java:67)
2025-05-16 01:13:33.001 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 01:13:33.072 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6934
2025-05-16 01:13:33.075 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 01:13:33.097 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 01:13:33.098 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 01:13:33.098 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:33.098 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 01:13:33.103 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 01:13:33.103 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 01:13:33.103 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 01:13:33.104 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13331
2025-05-16 01:13:33.104 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 01:13:33.105 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 01:13:33.105 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 01:13:33.105 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:33.105 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 01:13:33.107 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 01:13:33.107 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 01:13:33.108 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:13:33.109 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11441
2025-05-16 01:13:33.109 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 01:13:33.109 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 01:13:33.109 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 01:13:33.109 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:33.110 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 01:13:33.110 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 01:13:33.111 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 01:13:33.111 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:13:33.115 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-16 01:13:33.118 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-16 01:13:35.121 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:65464
2025-05-16 01:13:35.132 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13331
2025-05-16 01:13:35.133 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=13331, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:13:35.134 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:13:35.134 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:13:35.135 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:13:35.135 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:13:35.135 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:35.135 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:13:35.136 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:13:35.136 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=13331, deviceId=1
2025-05-16 01:13:35.137 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:13:35.146 ERROR [main] com.securechat.client.UserClient - Failed to connect/register with server: com.securechat.crypto.libsignal.PreKeyBundleDTO
java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at com.securechat.network.PeerConnection.sendObject(PeerConnection.java:20)
	at com.securechat.client.UserClient.connectToServer(UserClient.java:65)
	at com.securechat.Launcher.main(Launcher.java:53)
2025-05-16 01:13:35.146 ERROR [pool-1-thread-1] com.securechat.server.Server - Error handling client '/127.0.0.1:65464': writing aborted; java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
java.io.WriteAbortedException: writing aborted; java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1751)
	at java.base/java.io.ObjectInputStream$FieldValues.<init>(ObjectInputStream.java:2617)
	at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2468)
	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2268)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1744)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.server.Server.handleClient(Server.java:59)
	at com.securechat.server.Server.lambda$start$0(Server.java:44)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at com.securechat.network.PeerConnection.sendObject(PeerConnection.java:20)
	at com.securechat.client.UserClient.connectToServer(UserClient.java:65)
	at com.securechat.Launcher.main(Launcher.java:53)
2025-05-16 01:13:35.649 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:65465
2025-05-16 01:13:35.649 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11441
2025-05-16 01:13:35.650 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11441, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:13:35.650 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:13:35.650 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:13:35.650 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:13:35.651 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:13:35.651 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:13:35.651 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:13:35.651 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:13:35.651 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11441, deviceId=1
2025-05-16 01:13:35.652 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:13:35.655 ERROR [main] com.securechat.client.UserClient - Failed to connect/register with server: com.securechat.crypto.libsignal.PreKeyBundleDTO
java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at com.securechat.network.PeerConnection.sendObject(PeerConnection.java:20)
	at com.securechat.client.UserClient.connectToServer(UserClient.java:65)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-16 01:13:35.656 ERROR [pool-1-thread-1] com.securechat.server.Server - Error handling client '/127.0.0.1:65465': writing aborted; java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
java.io.WriteAbortedException: writing aborted; java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1751)
	at java.base/java.io.ObjectInputStream$FieldValues.<init>(ObjectInputStream.java:2617)
	at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2468)
	at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2268)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1744)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.server.Server.handleClient(Server.java:59)
	at com.securechat.server.Server.lambda$start$0(Server.java:44)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: java.io.NotSerializableException: com.securechat.crypto.libsignal.PreKeyBundleDTO
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at com.securechat.network.PeerConnection.sendObject(PeerConnection.java:20)
	at com.securechat.client.UserClient.connectToServer(UserClient.java:65)
	at com.securechat.Launcher.main(Launcher.java:63)
2025-05-16 01:13:35.659 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 01:13:35.663 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 01:13:35.663 ERROR [UserClient-Listener-alice] com.securechat.client.UserClient - Listening thread encountered error: null
java.io.EOFException: null
	at java.base/java.io.ObjectInputStream$BlockDataInputStream.peekByte(ObjectInputStream.java:3225)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1695)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:166)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-05-16 01:13:35.663 ERROR [UserClient-Listener-bob] com.securechat.client.UserClient - Listening thread encountered error: null
java.io.EOFException: null
	at java.base/java.io.ObjectInputStream$BlockDataInputStream.peekByte(ObjectInputStream.java:3225)
	at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1695)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:514)
	at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:472)
	at com.securechat.network.PeerConnection.receiveObject(PeerConnection.java:25)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:166)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-05-16 01:13:35.666 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 01:13:35.692 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:116)
	at com.securechat.Launcher.main(Launcher.java:67)
2025-05-16 01:14:38.239 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 01:14:38.312 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9287
2025-05-16 01:14:38.314 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 01:14:38.340 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 01:14:38.340 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 01:14:38.341 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:14:38.341 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 01:14:38.346 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 01:14:38.347 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 01:14:38.348 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 01:14:38.349 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12678
2025-05-16 01:14:38.349 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 01:14:38.350 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 01:14:38.350 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 01:14:38.350 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:14:38.350 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 01:14:38.352 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 01:14:38.352 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 01:14:38.353 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:14:38.353 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12351
2025-05-16 01:14:38.354 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 01:14:38.355 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 01:14:38.355 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 01:14:38.355 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:14:38.355 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 01:14:38.356 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 01:14:38.357 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 01:14:38.357 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:14:38.360 INFO  [main] com.securechat.Launcher - Server started on port 8888
2025-05-16 01:14:38.364 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on port 8888
2025-05-16 01:14:40.366 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:65477
2025-05-16 01:14:40.374 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12678
2025-05-16 01:14:40.375 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12678, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:14:40.375 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:14:40.376 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:14:40.376 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:14:40.376 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:14:40.376 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:14:40.376 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:14:40.377 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:14:40.377 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12678, deviceId=1
2025-05-16 01:14:40.378 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:14:40.380 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 01:14:40.382 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 01:14:40.382 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 01:14:40.882 INFO  [ServerThread] com.securechat.server.Server - Accepted connection from /127.0.0.1:65478
2025-05-16 01:14:40.883 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12351
2025-05-16 01:14:40.884 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12351, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:14:40.884 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:14:40.884 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:14:40.884 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:14:40.885 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:14:40.885 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:14:40.885 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:14:40.885 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:14:40.885 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12351, deviceId=1
2025-05-16 01:14:40.885 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:14:40.886 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 01:14:40.886 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 01:14:40.887 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 01:14:40.887 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 01:14:40.888 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 01:14:40.891 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 01:14:40.917 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:116)
	at com.securechat.Launcher.main(Launcher.java:67)
2025-05-16 01:37:07.435 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 01:37:07.504 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12670
2025-05-16 01:37:07.506 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 01:37:07.529 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 01:37:07.530 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 01:37:07.530 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:37:07.531 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 01:37:07.536 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 01:37:07.536 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 01:37:07.537 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 01:37:07.538 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10689
2025-05-16 01:37:07.538 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 01:37:07.538 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 01:37:07.539 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 01:37:07.539 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:37:07.539 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 01:37:07.540 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 01:37:07.540 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 01:37:07.541 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:37:07.541 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12600
2025-05-16 01:37:07.542 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 01:37:07.543 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 01:37:07.543 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 01:37:07.543 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:37:07.544 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 01:37:07.545 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 01:37:07.545 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 01:37:07.545 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:37:07.548 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 01:37:07.551 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 01:37:09.555 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:49228
2025-05-16 01:37:09.556 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:49229
2025-05-16 01:37:09.566 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10689
2025-05-16 01:37:09.567 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10689, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:37:09.568 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:37:09.568 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:37:09.569 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:37:09.569 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:37:09.569 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:37:09.569 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:37:09.570 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:37:09.571 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10689, deviceId=1
2025-05-16 01:37:09.571 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:37:09.574 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 01:37:09.575 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 01:37:09.576 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 01:37:09.576 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:49230
2025-05-16 01:37:09.577 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:49231
2025-05-16 01:37:09.577 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12600
2025-05-16 01:37:09.577 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12600, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:37:09.577 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:37:09.578 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:37:09.578 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:37:09.578 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:37:09.578 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:37:09.578 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:37:09.579 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:37:09.579 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12600, deviceId=1
2025-05-16 01:37:09.579 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:37:09.580 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 01:37:09.580 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 01:37:09.580 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 01:46:47.243 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 01:46:47.310 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8586
2025-05-16 01:46:47.311 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 01:46:47.337 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 01:46:47.337 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 01:46:47.338 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:46:47.338 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 01:46:47.343 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 01:46:47.343 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 01:46:47.344 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 01:46:47.344 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 7641
2025-05-16 01:46:47.346 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 01:46:47.346 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 01:46:47.347 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 01:46:47.347 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:46:47.347 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 01:46:47.348 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 01:46:47.349 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 01:46:47.349 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:46:47.349 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 16171
2025-05-16 01:46:47.349 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 01:46:47.350 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 01:46:47.350 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 01:46:47.350 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:46:47.350 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 01:46:47.352 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 01:46:47.352 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 01:46:47.352 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:46:47.355 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 01:46:47.358 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 01:46:49.361 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56176
2025-05-16 01:46:49.361 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56177
2025-05-16 01:46:49.372 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7641
2025-05-16 01:46:49.373 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=7641, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:46:49.373 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:46:49.374 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:46:49.374 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:46:49.374 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:46:49.375 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:46:49.375 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:46:49.375 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:46:49.376 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=7641, deviceId=1
2025-05-16 01:46:49.377 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:46:49.380 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 01:46:49.382 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 01:46:49.383 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 01:46:49.383 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56178
2025-05-16 01:46:49.384 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56179
2025-05-16 01:46:49.384 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16171
2025-05-16 01:46:49.385 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=16171, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:46:49.385 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:46:49.385 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:46:49.386 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:46:49.386 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:46:49.386 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:46:49.386 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:46:49.386 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:46:49.387 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=16171, deviceId=1
2025-05-16 01:46:49.387 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:46:49.387 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 01:46:49.388 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 01:46:49.388 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 01:46:49.388 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 01:46:49.388 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 01:46:49.391 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 01:46:49.417 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:123)
	at com.securechat.Launcher.main(Launcher.java:68)
2025-05-16 01:47:34.973 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 01:47:35.040 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6052
2025-05-16 01:47:35.042 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 01:47:35.066 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 01:47:35.066 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 01:47:35.067 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:47:35.067 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 01:47:35.071 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 01:47:35.072 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 01:47:35.072 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 01:47:35.072 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11621
2025-05-16 01:47:35.073 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 01:47:35.073 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 01:47:35.074 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 01:47:35.074 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:47:35.074 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 01:47:35.075 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 01:47:35.076 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 01:47:35.076 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:47:35.077 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1196
2025-05-16 01:47:35.077 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 01:47:35.077 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 01:47:35.078 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 01:47:35.078 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:47:35.078 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 01:47:35.079 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 01:47:35.080 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 01:47:35.080 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:47:35.083 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 01:47:35.086 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 01:47:37.088 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56184
2025-05-16 01:47:37.089 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56185
2025-05-16 01:47:37.098 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11621
2025-05-16 01:47:37.098 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11621, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:47:37.099 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:47:37.100 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:47:37.100 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:47:37.100 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:47:37.100 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:47:37.100 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:47:37.101 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:47:37.102 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11621, deviceId=1
2025-05-16 01:47:37.102 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:47:37.106 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 01:47:37.107 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 01:47:37.108 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 01:47:37.108 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56186
2025-05-16 01:47:37.108 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56187
2025-05-16 01:47:37.109 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1196
2025-05-16 01:47:37.109 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1196, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:47:37.109 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:47:37.109 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:47:37.110 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:47:37.110 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:47:37.110 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:47:37.110 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:47:37.111 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:47:37.111 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1196, deviceId=1
2025-05-16 01:47:37.111 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:47:37.112 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 01:47:37.112 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 01:47:37.113 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 01:47:38.114 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 01:47:38.115 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 01:47:38.123 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 01:47:38.152 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:123)
	at com.securechat.Launcher.main(Launcher.java:75)
2025-05-16 01:53:45.922 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 01:53:45.993 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15883
2025-05-16 01:53:45.995 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 01:53:46.019 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 01:53:46.019 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 01:53:46.019 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:53:46.020 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 01:53:46.024 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 01:53:46.024 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 01:53:46.024 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 01:53:46.025 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11024
2025-05-16 01:53:46.026 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 01:53:46.027 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 01:53:46.027 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 01:53:46.027 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:53:46.028 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 01:53:46.029 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 01:53:46.030 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 01:53:46.030 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:53:46.031 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1070
2025-05-16 01:53:46.031 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 01:53:46.031 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 01:53:46.032 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 01:53:46.032 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:53:46.032 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 01:53:46.033 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 01:53:46.034 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 01:53:46.034 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:53:46.037 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 01:53:46.040 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 01:53:48.044 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56237
2025-05-16 01:53:48.045 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56238
2025-05-16 01:53:48.056 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11024
2025-05-16 01:53:48.057 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11024, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:53:48.057 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:53:48.057 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:53:48.057 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:53:48.057 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:53:48.058 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:53:48.058 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:53:48.059 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:53:48.060 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11024, deviceId=1
2025-05-16 01:53:48.060 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:53:48.063 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 01:53:48.064 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 01:53:48.065 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 01:53:48.065 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56239
2025-05-16 01:53:48.066 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56240
2025-05-16 01:53:48.067 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1070
2025-05-16 01:53:48.067 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1070, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:53:48.067 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:53:48.067 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:53:48.068 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:53:48.068 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:53:48.068 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:53:48.068 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:53:48.068 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:53:48.069 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1070, deviceId=1
2025-05-16 01:53:48.069 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:53:48.069 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 01:53:48.070 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56241
2025-05-16 01:53:48.070 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56242
2025-05-16 01:53:48.071 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11024
2025-05-16 01:53:48.071 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11024, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:53:48.071 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:53:48.072 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:53:48.072 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:53:48.072 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:53:48.072 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:53:48.073 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:53:48.073 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:53:48.073 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11024, deviceId=1
2025-05-16 01:53:48.073 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:53:48.074 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 01:53:48.074 INFO  [pool-1-thread-4] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 01:53:48.074 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56243
2025-05-16 01:53:48.074 INFO  [pool-1-thread-4] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 01:53:48.075 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56244
2025-05-16 01:53:48.075 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1070
2025-05-16 01:53:48.075 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1070, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:53:48.075 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:53:48.076 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:53:48.076 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:53:48.076 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:53:48.076 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:53:48.076 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:53:48.076 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:53:48.077 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1070, deviceId=1
2025-05-16 01:53:48.077 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:53:48.077 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 01:53:48.078 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 01:53:48.078 INFO  [pool-1-thread-6] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 01:53:48.078 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 01:53:48.079 INFO  [pool-1-thread-6] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 01:53:49.078 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 01:53:49.079 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 01:53:49.082 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 01:53:49.108 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:123)
	at com.securechat.Launcher.main(Launcher.java:78)
2025-05-16 01:55:34.719 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 01:55:34.784 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13417
2025-05-16 01:55:34.786 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 01:55:34.807 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 01:55:34.808 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 01:55:34.808 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:55:34.809 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 01:55:34.813 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 01:55:34.813 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 01:55:34.813 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 01:55:34.814 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1482
2025-05-16 01:55:34.815 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 01:55:34.815 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 01:55:34.815 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 01:55:34.816 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:55:34.816 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 01:55:34.817 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 01:55:34.817 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 01:55:34.817 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:55:34.818 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 320
2025-05-16 01:55:34.818 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 01:55:34.818 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 01:55:34.819 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 01:55:34.819 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:55:34.819 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 01:55:34.820 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 01:55:34.820 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 01:55:34.820 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:55:34.823 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 01:55:34.826 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 01:55:36.830 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56259
2025-05-16 01:55:36.831 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56260
2025-05-16 01:55:36.843 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1482
2025-05-16 01:55:36.844 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1482, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 01:55:36.844 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 01:55:36.844 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 01:55:36.845 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 01:55:36.845 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 01:55:36.845 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:55:36.845 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:55:36.846 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:55:36.847 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1482, deviceId=1
2025-05-16 01:55:36.849 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:55:36.852 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 01:55:36.853 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 01:55:36.853 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 01:55:36.854 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:56261
2025-05-16 01:55:36.854 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:56262
2025-05-16 01:55:36.855 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 320
2025-05-16 01:55:36.855 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=320, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 01:55:36.855 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 01:55:36.855 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 01:55:36.856 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 01:55:36.856 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 01:55:36.856 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:55:36.856 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 01:55:36.856 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 01:55:36.856 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=320, deviceId=1
2025-05-16 01:55:36.857 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 01:55:36.857 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 01:55:36.858 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 01:55:36.858 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 01:55:36.858 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 01:55:36.858 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=320, deviceId=1
2025-05-16 01:55:36.859 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 01:55:36.860 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-16 01:55:36.863 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-16 01:55:36.866 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 01:55:36.872 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 01:55:36.899 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1482
2025-05-16 01:55:36.899 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-16 01:55:36.900 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1
2025-05-16 01:55:36.900 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-16 01:55:36.900 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-16 01:55:36.900 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 01:55:37.902 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-16 01:55:37.902 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 01:55:37.917 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-16 01:55:37.918 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-16 01:55:37.918 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 unchanged
2025-05-16 01:55:37.918 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-16 01:55:37.921 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 01:55:37.922 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 01:55:37.922 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 01:55:37.923 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 01:55:37.925 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:190)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:09:31.946 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:09:32.011 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3709
2025-05-16 02:09:32.012 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:09:32.035 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:09:32.035 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:09:32.035 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:09:32.035 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:09:32.040 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:09:32.040 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:09:32.041 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:09:32.041 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15841
2025-05-16 02:09:32.042 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:09:32.042 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:09:32.043 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:09:32.043 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:09:32.043 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:09:32.044 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:09:32.045 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:09:32.045 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:09:32.046 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 7381
2025-05-16 02:09:32.046 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:09:32.046 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:09:32.047 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:09:32.047 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:09:32.047 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:09:32.048 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:09:32.048 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:09:32.048 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:09:32.052 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:09:32.055 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:09:34.062 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59604
2025-05-16 02:09:34.063 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59605
2025-05-16 02:09:34.071 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15841
2025-05-16 02:09:34.072 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15841, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:09:34.073 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:09:34.073 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:09:34.073 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:09:34.074 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:09:34.074 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:09:34.075 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:09:34.075 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:09:34.076 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15841, deviceId=1
2025-05-16 02:09:34.077 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:09:34.081 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:09:34.081 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:09:34.082 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:09:34.083 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59606
2025-05-16 02:09:34.083 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59607
2025-05-16 02:09:34.083 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7381
2025-05-16 02:09:34.084 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=7381, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:09:34.084 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:09:34.084 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:09:34.084 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:09:34.084 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:09:34.084 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:09:34.085 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:09:34.085 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:09:34.085 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=7381, deviceId=1
2025-05-16 02:09:34.085 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:09:34.086 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:09:34.086 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:09:34.086 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:09:34.087 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 02:09:34.088 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=7381, deviceId=1
2025-05-16 02:09:34.088 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:09:34.089 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-16 02:09:34.092 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-16 02:09:34.095 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 02:09:34.101 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:09:34.130 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15841
2025-05-16 02:09:34.130 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-16 02:09:34.130 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1
2025-05-16 02:09:34.131 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-16 02:09:34.131 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-16 02:09:34.131 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 02:09:35.132 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-16 02:09:35.133 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 02:09:35.148 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-16 02:09:35.148 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-16 02:09:35.148 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 unchanged
2025-05-16 02:09:35.149 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-16 02:09:35.149 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBVh86lFVSDEkoIEMPMpgaBriPabTudlGoPxeT4IMlaJjGiEFqNqHyVTrr4IBlIDlmxLfy0TeEUswDsInnU3UolI6lwsiQjMKIQXUo7fsZGB23+Wc18jO7N79y6moQmnHciH6vtMxrNALDxAAGAAiEDWvgGnUMmUFpi+vaFSvqiON8x/Y99uTVCjhezDSDw==
2025-05-16 02:09:35.151 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 02:09:35.151 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 02:09:35.151 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 02:09:35.152 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 02:09:35.155 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:191)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:10:52.647 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:10:52.712 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4926
2025-05-16 02:10:52.714 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:10:52.740 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:10:52.740 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:10:52.740 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:10:52.740 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:10:52.746 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:10:52.747 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:10:52.747 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:10:52.748 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 5227
2025-05-16 02:10:52.749 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:10:52.750 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:10:52.750 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:10:52.750 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:10:52.750 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:10:52.751 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:10:52.752 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:10:52.752 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:10:52.752 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8116
2025-05-16 02:10:52.753 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:10:52.753 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:10:52.753 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:10:52.753 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:10:52.753 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:10:52.754 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:10:52.755 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:10:52.755 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:10:52.757 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:10:52.760 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:10:54.766 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59616
2025-05-16 02:10:54.767 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59617
2025-05-16 02:10:54.779 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5227
2025-05-16 02:10:54.781 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=5227, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:10:54.782 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:10:54.782 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:10:54.782 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:10:54.783 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:10:54.783 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:10:54.783 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:10:54.784 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:10:54.784 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=5227, deviceId=1
2025-05-16 02:10:54.785 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:10:54.790 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:10:54.791 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:10:54.791 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:10:54.792 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59618
2025-05-16 02:10:54.792 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59619
2025-05-16 02:10:54.792 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8116
2025-05-16 02:10:54.793 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8116, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:10:54.793 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:10:54.793 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:10:54.793 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:10:54.794 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:10:54.794 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:10:54.794 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:10:54.794 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:10:54.794 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8116, deviceId=1
2025-05-16 02:10:54.794 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:10:54.795 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:10:54.795 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:10:54.796 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:10:54.797 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 02:10:54.797 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8116, deviceId=1
2025-05-16 02:10:54.797 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:10:54.798 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-16 02:10:54.800 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-16 02:10:54.807 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 02:10:54.812 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:10:54.837 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 5227
2025-05-16 02:10:54.837 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-16 02:10:54.838 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1
2025-05-16 02:10:54.838 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-16 02:10:54.838 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-16 02:10:54.838 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 02:10:55.839 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-16 02:10:55.839 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 02:10:55.856 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-16 02:10:55.856 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-16 02:10:55.856 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 unchanged
2025-05-16 02:10:55.857 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-16 02:10:55.857 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBVhXtu1EQbNo5xd2wHcyiXnpmmfD+rnK7qhuvlVlLI1KGiEF5V4v59ErDNmHA3Lr9uGLXhMKwLK9Rll0jRFcXw8K5w0iQjMKIQXNscRqfTjzTEnI8PTG0QcrISSsiuSR/gDr+xQw0xE1HBAAGAAiEJbOXG98SmPGSP9yKTm5bE2UylqedSr+zSjrKDDSDw==
2025-05-16 02:10:55.859 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 02:10:55.860 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 02:10:55.860 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 02:10:55.861 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 02:10:55.861 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received ciphertext (Base64): MwjRDxIhBVhXtu1EQbNo5xd2wHcyiXnpmmfD+rnK7qhuvlVlLI1KGiEF5V4v59ErDNmHA3Lr9uGLXhMKwLK9Rll0jRFcXw8K5w0iQjMKIQXNscRqfTjzTEnI8PTG0QcrISSsiuSR/gDr+xQw0xE1HBAAGAAiEJbOXG98SmPGSP9yKTm5bE2UylqedSr+zSjrKDDSDw==
2025-05-16 02:10:55.863 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:194)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:13:19.776 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:13:19.844 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8974
2025-05-16 02:13:19.846 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:13:19.868 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:13:19.869 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:13:19.869 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:13:19.869 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:13:19.874 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:13:19.874 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:13:19.875 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:13:19.876 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13423
2025-05-16 02:13:19.876 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:13:19.877 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:13:19.877 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:13:19.877 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:13:19.877 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:13:19.879 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:13:19.879 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:13:19.879 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:13:19.880 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6875
2025-05-16 02:13:19.880 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:13:19.880 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:13:19.881 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:13:19.881 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:13:19.881 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:13:19.882 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:13:19.883 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:13:19.883 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:13:19.886 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:13:19.889 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:13:21.895 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59626
2025-05-16 02:13:21.895 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59627
2025-05-16 02:13:21.910 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13423
2025-05-16 02:13:21.911 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=13423, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:13:21.911 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:13:21.912 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:13:21.912 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:13:21.912 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:13:21.912 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:13:21.912 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:13:21.913 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:13:21.913 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=13423, deviceId=1
2025-05-16 02:13:21.914 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:13:21.917 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:13:21.917 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:13:21.918 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:13:21.918 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59628
2025-05-16 02:13:21.918 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59629
2025-05-16 02:13:21.919 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6875
2025-05-16 02:13:21.919 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6875, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:13:21.919 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:13:21.920 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:13:21.920 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:13:21.920 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:13:21.920 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:13:21.920 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:13:21.921 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:13:21.921 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6875, deviceId=1
2025-05-16 02:13:21.921 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:13:21.922 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:13:21.923 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:13:21.923 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:13:21.924 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 02:13:21.925 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6875, deviceId=1
2025-05-16 02:13:21.926 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:13:21.926 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1
2025-05-16 02:13:21.929 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1, trusting first seen key
2025-05-16 02:13:21.932 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 02:13:21.942 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:13:21.962 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13423
2025-05-16 02:13:21.962 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-16 02:13:21.963 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1
2025-05-16 02:13:21.963 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-16 02:13:21.963 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1
2025-05-16 02:13:21.963 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 02:13:23.965 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: true
2025-05-16 02:13:23.965 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 02:13:23.980 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1: true
2025-05-16 02:13:23.980 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1
2025-05-16 02:13:23.981 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1 unchanged
2025-05-16 02:13:23.981 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1
2025-05-16 02:13:23.982 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBc8xJNUQ+1XH3bGzvOYrmU7kaBoRfT5VK2TFU2MeJFMWGiEFQ+sEJAz7wSyGklSP6sLOlfpyl/Wd6aLva4/pglhRm1QiQjMKIQWw2xQbSbLAMygdD0C0SFSGXcBAMBnUVq9Jxe2YOLWtcxAAGAAiEAc5IrioQbCynrrs06H2i/S5jIrbmig0ESjvaDDSDw==
2025-05-16 02:13:23.984 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 02:13:23.984 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 02:13:23.986 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 02:13:23.986 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 02:13:23.986 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received ciphertext (Base64): MwjRDxIhBc8xJNUQ+1XH3bGzvOYrmU7kaBoRfT5VK2TFU2MeJFMWGiEFQ+sEJAz7wSyGklSP6sLOlfpyl/Wd6aLva4/pglhRm1QiQjMKIQWw2xQbSbLAMygdD0C0SFSGXcBAMBnUVq9Jxe2YOLWtcxAAGAAiEAc5IrioQbCynrrs06H2i/S5jIrbmig0ESjvaDDSDw==
2025-05-16 02:13:23.988 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:194)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:16:49.003 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:16:49.073 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10734
2025-05-16 02:16:49.075 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:16:49.101 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:16:49.101 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:16:49.101 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:16:49.101 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:16:49.106 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:16:49.107 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:16:49.107 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:16:49.108 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13542
2025-05-16 02:16:49.108 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:16:49.109 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:16:49.109 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:16:49.109 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:16:49.109 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:16:49.111 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:16:49.111 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:16:49.112 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:16:49.112 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10463
2025-05-16 02:16:49.113 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:16:49.113 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:16:49.113 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:16:49.114 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:16:49.114 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:16:49.115 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:16:49.115 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:16:49.115 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:16:49.118 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:16:49.121 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:16:51.124 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59675
2025-05-16 02:16:51.124 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59676
2025-05-16 02:16:51.133 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13542
2025-05-16 02:16:51.134 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=13542, deviceId=1001, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:16:51.134 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:16:51.135 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:16:51.135 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:16:51.136 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:16:51.136 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:16:51.136 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:16:51.137 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:16:51.138 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=13542, deviceId=1001
2025-05-16 02:16:51.138 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:16:51.142 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:16:51.144 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:16:51.145 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:16:51.145 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59677
2025-05-16 02:16:51.146 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59678
2025-05-16 02:16:51.146 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10463
2025-05-16 02:16:51.146 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10463, deviceId=2001, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:16:51.147 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:16:51.147 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:16:51.147 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:16:51.147 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:16:51.147 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:16:51.148 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:16:51.148 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:16:51.148 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10463, deviceId=2001
2025-05-16 02:16:51.148 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:16:51.149 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:16:51.149 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:16:51.150 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:16:51.150 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 02:16:51.150 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10463, deviceId=2001
2025-05-16 02:16:51.151 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:16:51.151 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1001
2025-05-16 02:16:51.154 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1001, trusting first seen key
2025-05-16 02:16:51.161 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:16:51.167 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:16:51.188 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13542
2025-05-16 02:16:51.188 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:16:51.188 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1001
2025-05-16 02:16:51.189 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:16:51.189 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1001
2025-05-16 02:16:51.189 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 02:16:53.191 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1001: true
2025-05-16 02:16:53.191 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:16:53.205 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1001: true
2025-05-16 02:16:53.206 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:16:53.207 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1001 unchanged
2025-05-16 02:16:53.207 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:16:53.208 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBV/3WMCbcy/L4HTBDE9WPGy+DKKHal7igXlSgxdlq8B2GiEF7AFO1CxaM2aqwN+JuvpxbX6VyCot9hjtTmdp7GHUYw8iQjMKIQWe591aU6Oz78mB+SzzLPJr6NyIB6jbZwxe94r5l9MtHBAAGAAiEP+NMZrQq0tDKKyAsWuETiROoiU+73pfMCjmaTDSDw==
2025-05-16 02:16:53.210 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 02:16:53.211 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 02:16:53.211 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 02:16:53.212 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 02:16:53.212 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received ciphertext (Base64): MwjRDxIhBV/3WMCbcy/L4HTBDE9WPGy+DKKHal7igXlSgxdlq8B2GiEF7AFO1CxaM2aqwN+JuvpxbX6VyCot9hjtTmdp7GHUYw8iQjMKIQWe591aU6Oz78mB+SzzLPJr6NyIB6jbZwxe94r5l9MtHBAAGAAiEP+NMZrQq0tDKKyAsWuETiROoiU+73pfMCjmaTDSDw==
2025-05-16 02:16:53.214 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:2001: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:190)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:17:16.036 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:17:16.107 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1674
2025-05-16 02:17:16.109 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:17:16.133 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:17:16.133 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:17:16.133 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:17:16.133 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:17:16.139 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:17:16.140 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:17:16.140 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:17:16.141 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6865
2025-05-16 02:17:16.142 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:17:16.142 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:17:16.142 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:17:16.143 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:17:16.143 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:17:16.144 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:17:16.144 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:17:16.145 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:17:16.145 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8552
2025-05-16 02:17:16.146 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:17:16.146 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:17:16.146 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:17:16.147 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:17:16.147 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:17:16.148 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:17:16.149 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:17:16.149 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:17:16.153 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:17:16.157 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:17:18.161 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59684
2025-05-16 02:17:18.162 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59685
2025-05-16 02:17:18.175 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6865
2025-05-16 02:17:18.176 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6865, deviceId=1001, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:17:18.176 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:17:18.176 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:17:18.176 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:17:18.177 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:17:18.177 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:17:18.177 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:17:18.177 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:17:18.179 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6865, deviceId=1001
2025-05-16 02:17:18.180 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:17:18.183 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:17:18.184 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:17:18.185 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:17:18.185 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59686
2025-05-16 02:17:18.185 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59687
2025-05-16 02:17:18.186 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8552
2025-05-16 02:17:18.186 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8552, deviceId=2001, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:17:18.187 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:17:18.187 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:17:18.187 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:17:18.187 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:17:18.188 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:17:18.188 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:17:18.188 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:17:18.188 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8552, deviceId=2001
2025-05-16 02:17:18.188 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:17:18.189 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:17:18.189 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:17:18.190 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:17:18.192 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 02:17:18.192 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8552, deviceId=2001
2025-05-16 02:17:18.193 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:17:18.193 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1001
2025-05-16 02:17:18.196 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1001, trusting first seen key
2025-05-16 02:17:18.202 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:17:18.208 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:17:18.233 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6865
2025-05-16 02:17:18.233 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:17:18.233 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1001
2025-05-16 02:17:18.234 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:17:18.234 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1001
2025-05-16 02:17:18.234 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 02:17:20.235 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1001: true
2025-05-16 02:17:20.236 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:17:20.252 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1001: true
2025-05-16 02:17:20.253 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:17:20.253 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1001 unchanged
2025-05-16 02:17:20.253 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:17:20.254 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBbQZVgmr7mHRXfCTKaKOx7G75En6EWBt/ko/etO/RctAGiEFCnwHq3t0cGR/aPnoCh8YqT/607NSPsGoz6y+dMLhDS4iQjMKIQWW/HlgSyKy1jAMqdHHQLuvnfT3B8DJC40smOtPs2CeexAAGAAiEE5H7msFFKuvEjiCnoc5bAq6Nm7NLAzyHCjRNTDSDw==
2025-05-16 02:17:20.257 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 02:17:20.258 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 02:17:20.259 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 02:17:20.260 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 02:17:20.260 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received ciphertext (Base64): MwjRDxIhBbQZVgmr7mHRXfCTKaKOx7G75En6EWBt/ko/etO/RctAGiEFCnwHq3t0cGR/aPnoCh8YqT/607NSPsGoz6y+dMLhDS4iQjMKIQWW/HlgSyKy1jAMqdHHQLuvnfT3B8DJC40smOtPs2CeexAAGAAiEE5H7msFFKuvEjiCnoc5bAq6Nm7NLAzyHCjRNTDSDw==
2025-05-16 02:17:20.262 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:2001: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$listen$0(UserClient.java:190)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:18:58.755 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:18:58.820 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10529
2025-05-16 02:18:58.822 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:18:58.844 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:18:58.845 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:18:58.845 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:18:58.845 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:18:58.849 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:18:58.850 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:18:58.850 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:18:58.851 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4581
2025-05-16 02:18:58.851 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:18:58.852 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:18:58.852 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:18:58.852 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:18:58.852 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:18:58.853 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:18:58.854 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:18:58.854 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:18:58.854 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9862
2025-05-16 02:18:58.855 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:18:58.855 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:18:58.855 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:18:58.856 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:18:58.856 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:18:58.857 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:18:58.857 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:18:58.857 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:18:58.859 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:18:58.863 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:19:00.866 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59705
2025-05-16 02:19:00.867 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59706
2025-05-16 02:19:00.874 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4581
2025-05-16 02:19:00.875 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=4581, deviceId=1001, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:19:00.875 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:19:00.875 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:19:00.876 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:19:00.876 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:19:00.876 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:19:00.876 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:19:00.877 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:19:00.878 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=4581, deviceId=1001
2025-05-16 02:19:00.879 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:19:00.882 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:19:00.883 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:19:00.883 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:19:00.883 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59707
2025-05-16 02:19:00.884 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59708
2025-05-16 02:19:00.885 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9862
2025-05-16 02:19:00.885 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9862, deviceId=2001, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:19:00.885 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:19:00.886 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:19:00.886 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:19:00.886 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:19:00.886 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:19:00.886 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:19:00.887 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:19:00.887 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9862, deviceId=2001
2025-05-16 02:19:00.887 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:19:00.888 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:19:00.888 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:19:00.888 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:19:00.889 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 02:19:00.890 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=9862, deviceId=2001
2025-05-16 02:19:00.891 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:19:00.892 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1001
2025-05-16 02:19:00.895 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1001, trusting first seen key
2025-05-16 02:19:00.901 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:19:00.907 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:19:00.933 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 4581
2025-05-16 02:19:00.933 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:19:00.933 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1001
2025-05-16 02:19:00.934 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:19:00.934 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1001
2025-05-16 02:19:00.934 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 02:19:02.935 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1001: true
2025-05-16 02:19:02.935 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:19:02.948 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1001: true
2025-05-16 02:19:02.948 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:19:02.948 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1001 unchanged
2025-05-16 02:19:02.948 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:19:02.949 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBdWExITAp+qrPIlj3zqewHdq5euzKBzsUFvxPqL89plWGiEFzLe4Np9C5+i5ytS0644pbeOjupvna6J2QlzPP+weSEkiQjMKIQWPvbJA7EiQxs5/q6QKn30dmFNCVCYgOeHfkV/nkzkQEBAAGAAiELFBC3Xh43yiK5kCQUY/SQY5XAdHHHbFrCjlIzDSDw==
2025-05-16 02:19:02.951 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 02:19:02.951 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 02:19:02.952 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 02:19:02.952 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 02:19:02.952 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received ciphertext (Base64): MwjRDxIhBdWExITAp+qrPIlj3zqewHdq5euzKBzsUFvxPqL89plWGiEFzLe4Np9C5+i5ytS0644pbeOjupvna6J2QlzPP+weSEkiQjMKIQWPvbJA7EiQxs5/q6QKn30dmFNCVCYgOeHfkV/nkzkQEBAAGAAiELFBC3Xh43yiK5kCQUY/SQY5XAdHHHbFrCjlIzDSDw==
2025-05-16 02:19:02.954 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:2001: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:190)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:20:10.328 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:20:10.397 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10994
2025-05-16 02:20:10.399 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:20:10.422 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:20:10.422 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:20:10.423 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:20:10.423 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:20:10.428 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:20:10.428 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:20:10.428 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:20:10.429 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12584
2025-05-16 02:20:10.430 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:20:10.430 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:20:10.431 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:20:10.431 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:20:10.431 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:20:10.433 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:20:10.433 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:20:10.433 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:20:10.434 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15666
2025-05-16 02:20:10.434 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:20:10.434 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:20:10.434 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:20:10.435 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:20:10.435 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:20:10.436 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:20:10.437 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:20:10.437 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:20:10.439 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:20:10.443 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:20:12.450 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59716
2025-05-16 02:20:12.451 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59717
2025-05-16 02:20:12.463 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12584
2025-05-16 02:20:12.464 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12584, deviceId=1001, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:20:12.465 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:20:12.465 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:20:12.465 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:20:12.466 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:20:12.466 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:20:12.466 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:20:12.466 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:20:12.467 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12584, deviceId=1001
2025-05-16 02:20:12.468 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:20:12.471 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:20:12.472 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:20:12.472 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59718
2025-05-16 02:20:12.473 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:20:12.474 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59719
2025-05-16 02:20:12.475 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15666
2025-05-16 02:20:12.475 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15666, deviceId=2001, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:20:12.475 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:20:12.475 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:20:12.476 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:20:12.476 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:20:12.476 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:20:12.476 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:20:12.476 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:20:12.476 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15666, deviceId=2001
2025-05-16 02:20:12.477 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:20:12.477 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:20:12.477 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:20:12.478 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:20:12.478 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 02:20:12.479 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15666, deviceId=2001
2025-05-16 02:20:12.479 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:20:12.480 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1001
2025-05-16 02:20:12.482 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1001, trusting first seen key
2025-05-16 02:20:12.485 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:20:12.491 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:20:12.517 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12584
2025-05-16 02:20:12.517 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:20:12.517 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1001
2025-05-16 02:20:12.517 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:20:12.518 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1001
2025-05-16 02:20:12.518 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 02:20:14.519 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1001: true
2025-05-16 02:20:14.520 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:20:14.535 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1001: true
2025-05-16 02:20:14.536 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:20:14.536 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1001 unchanged
2025-05-16 02:20:14.536 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:20:14.537 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBdONH6So37L7uXnbZmhSLxiOi782J/3Ii+XFmgGtdtw6GiEFV4uINGTXngaGIF4HsHhOfqneHWp5/Q8BSAb6dxVQZHkiQjMKIQUoRS8zrDRhNDsP0KdTXL0ugk/ilYZtPsgQnqpusBdRbRAAGAAiEPurLuYTSpdueXN4e/IDjwV/pIhWLFngCiioYjDSDw==
2025-05-16 02:20:14.540 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 02:20:14.541 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 02:20:14.541 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 02:20:14.542 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 02:20:14.542 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received ciphertext (Base64): MwjRDxIhBdONH6So37L7uXnbZmhSLxiOi782J/3Ii+XFmgGtdtw6GiEFV4uINGTXngaGIF4HsHhOfqneHWp5/Q8BSAb6dxVQZHkiQjMKIQUoRS8zrDRhNDsP0KdTXL0ugk/ilYZtPsgQnqpusBdRbRAAGAAiEPurLuYTSpdueXN4e/IDjwV/pIhWLFngCiioYjDSDw==
2025-05-16 02:20:14.544 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:2001: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:190)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:22:36.209 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:22:36.275 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 956
2025-05-16 02:22:36.277 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:22:36.299 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:22:36.299 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:22:36.299 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:22:36.300 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:22:36.304 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:22:36.304 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:22:36.305 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:22:36.306 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9080
2025-05-16 02:22:36.306 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:22:36.307 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:22:36.307 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:22:36.307 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:22:36.307 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:22:36.308 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:22:36.309 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:22:36.309 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:22:36.309 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11629
2025-05-16 02:22:36.310 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:22:36.310 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:22:36.310 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:22:36.310 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:22:36.311 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:22:36.312 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:22:36.312 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:22:36.313 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:22:36.315 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:22:36.319 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:22:38.321 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59734
2025-05-16 02:22:38.321 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59735
2025-05-16 02:22:38.333 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9080
2025-05-16 02:22:38.334 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9080, deviceId=1001, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:22:38.334 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:22:38.334 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:22:38.334 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:22:38.335 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:22:38.335 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:22:38.335 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:22:38.336 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:22:38.336 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9080, deviceId=1001
2025-05-16 02:22:38.337 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:22:38.340 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:22:38.341 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:22:38.341 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:22:38.341 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59736
2025-05-16 02:22:38.342 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59737
2025-05-16 02:22:38.343 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11629
2025-05-16 02:22:38.343 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11629, deviceId=2001, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:22:38.344 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:22:38.344 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:22:38.344 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:22:38.345 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:22:38.345 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:22:38.345 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:22:38.346 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:22:38.346 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11629, deviceId=2001
2025-05-16 02:22:38.346 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:22:38.347 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:22:38.347 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:22:38.348 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:22:38.353 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:22:38.353 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=9080, deviceId=1001
2025-05-16 02:22:38.354 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:22:38.355 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:2001
2025-05-16 02:22:38.357 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:2001, trusting first seen key
2025-05-16 02:22:38.360 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:2001
2025-05-16 02:22:38.365 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:22:38.387 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11629
2025-05-16 02:22:38.387 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:2001
2025-05-16 02:22:38.387 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:2001
2025-05-16 02:22:38.387 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:2001
2025-05-16 02:22:38.387 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:2001
2025-05-16 02:22:38.388 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:22:40.389 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1001: false
2025-05-16 02:22:40.390 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 02:22:40.390 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:22:40.390 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:124)
	at com.securechat.Launcher.main(Launcher.java:77)
2025-05-16 02:23:20.360 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:23:20.426 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12442
2025-05-16 02:23:20.428 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:23:20.451 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:23:20.451 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:23:20.451 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:23:20.452 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:23:20.456 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:23:20.456 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:23:20.457 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:23:20.457 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2793
2025-05-16 02:23:20.458 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:23:20.458 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:23:20.459 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:23:20.459 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:23:20.459 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:23:20.460 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:23:20.461 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:23:20.461 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:23:20.461 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 43
2025-05-16 02:23:20.461 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:23:20.462 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:23:20.462 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:23:20.463 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:23:20.463 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:23:20.464 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:23:20.465 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:23:20.465 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:23:20.467 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:23:20.471 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:23:22.474 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59743
2025-05-16 02:23:22.475 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59744
2025-05-16 02:23:22.485 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2793
2025-05-16 02:23:22.486 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=2793, deviceId=1001, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:23:22.487 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:23:22.487 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:23:22.487 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:23:22.487 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:23:22.488 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:23:22.488 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:23:22.488 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:23:22.489 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=2793, deviceId=1001
2025-05-16 02:23:22.491 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:23:22.495 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:23:22.496 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:23:22.498 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:23:22.498 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59745
2025-05-16 02:23:22.498 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59746
2025-05-16 02:23:22.499 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 43
2025-05-16 02:23:22.499 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=43, deviceId=2001, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:23:22.499 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:23:22.500 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:23:22.500 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:23:22.500 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:23:22.500 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:23:22.500 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:23:22.501 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:23:22.501 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=43, deviceId=2001
2025-05-16 02:23:22.501 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:23:22.502 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:23:22.502 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:23:22.502 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:23:22.504 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:23:22.505 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=2793, deviceId=1001
2025-05-16 02:23:22.505 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:23:22.506 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:2001
2025-05-16 02:23:22.508 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:2001, trusting first seen key
2025-05-16 02:23:22.515 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:2001
2025-05-16 02:23:22.521 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:23:22.542 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 43
2025-05-16 02:23:22.542 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:2001
2025-05-16 02:23:22.543 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:2001
2025-05-16 02:23:22.543 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:2001
2025-05-16 02:23:22.543 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:2001
2025-05-16 02:23:22.543 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:23:22.544 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 02:23:22.544 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=43, deviceId=2001
2025-05-16 02:23:22.544 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:23:22.545 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:1001
2025-05-16 02:23:22.545 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:1001, trusting first seen key
2025-05-16 02:23:22.545 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:23:22.545 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:23:22.547 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2793
2025-05-16 02:23:22.547 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:23:22.547 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:1001
2025-05-16 02:23:22.547 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:23:22.548 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:1001
2025-05-16 02:23:22.548 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 02:23:24.549 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1001: true
2025-05-16 02:23:24.550 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:23:24.569 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:1001: true
2025-05-16 02:23:24.570 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:1001
2025-05-16 02:23:24.570 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:1001 unchanged
2025-05-16 02:23:24.570 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:1001
2025-05-16 02:23:24.571 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBX+FFOsdL+2bUh9gS9Myt4Ej10QeMD5S28aoSc2NXh5UGiEFHZta/YswexPJzlS8PJXuRM+T2vx5si0nUGrMbOAkih4iQjMKIQVj2qrLQYnBWz0VekKQCfj7rRPTTp1pcMi3GFFicYb4KxAAGAAiELCcBYuFbMmzmWdkLDMybaydOAV8IGX77yjpFTDSDw==
2025-05-16 02:23:24.573 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 02:23:24.573 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 02:23:24.574 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 02:23:24.574 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 02:23:24.574 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received ciphertext (Base64): MwjRDxIhBX+FFOsdL+2bUh9gS9Myt4Ej10QeMD5S28aoSc2NXh5UGiEFHZta/YswexPJzlS8PJXuRM+T2vx5si0nUGrMbOAkih4iQjMKIQVj2qrLQYnBWz0VekKQCfj7rRPTTp1pcMi3GFFicYb4KxAAGAAiELCcBYuFbMmzmWdkLDMybaydOAV8IGX77yjpFTDSDw==
2025-05-16 02:23:24.576 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:2001: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:190)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:24:44.678 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:24:44.745 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15156
2025-05-16 02:24:44.746 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:24:44.770 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:24:44.771 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:24:44.771 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:44.771 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:24:44.775 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:24:44.776 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:24:44.776 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:24:44.777 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8647
2025-05-16 02:24:44.777 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:24:44.778 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:24:44.778 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:24:44.778 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:44.778 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:24:44.779 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:24:44.780 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:24:44.780 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:24:44.780 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3286
2025-05-16 02:24:44.781 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:24:44.781 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:24:44.781 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:24:44.782 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:44.782 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:24:44.784 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:24:44.784 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:24:44.784 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:24:44.787 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:24:44.791 ERROR [ServerThread] com.securechat.server.Server - Server encountered a fatal error
java.net.BindException: Address already in use: bind
	at java.base/sun.nio.ch.Net.bind0(Native Method)
	at java.base/sun.nio.ch.Net.bind(Net.java:555)
	at java.base/sun.nio.ch.Net.bind(Net.java:544)
	at java.base/sun.nio.ch.NioSocketImpl.bind(NioSocketImpl.java:648)
	at java.base/java.net.ServerSocket.bind(ServerSocket.java:388)
	at java.base/java.net.ServerSocket.<init>(ServerSocket.java:274)
	at java.base/java.net.ServerSocket.<init>(ServerSocket.java:167)
	at com.securechat.server.Server.start(Server.java:38)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-05-16 02:24:50.192 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:24:50.259 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6936
2025-05-16 02:24:50.261 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:24:50.284 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:24:50.284 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:24:50.284 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:50.284 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:24:50.289 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:24:50.290 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:24:50.290 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:24:50.291 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 487
2025-05-16 02:24:50.291 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:24:50.292 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:24:50.292 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:24:50.293 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:50.293 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:24:50.294 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:24:50.295 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:24:50.295 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:24:50.296 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11885
2025-05-16 02:24:50.296 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:24:50.296 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:24:50.297 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:24:50.297 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:50.297 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:24:50.298 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:24:50.298 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:24:50.299 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:24:50.301 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:24:50.304 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:24:52.309 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59755
2025-05-16 02:24:52.310 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59756
2025-05-16 02:24:52.319 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 487
2025-05-16 02:24:52.320 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=487, deviceId=1001, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:24:52.321 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:24:52.321 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:24:52.321 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:24:52.322 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:24:52.322 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:52.322 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:24:52.323 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:24:52.324 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=487, deviceId=1001
2025-05-16 02:24:52.325 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:24:52.328 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:24:52.330 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:24:52.330 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:24:52.331 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59757
2025-05-16 02:24:52.331 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59758
2025-05-16 02:24:52.332 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11885
2025-05-16 02:24:52.332 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11885, deviceId=2001, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:24:52.333 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:24:52.333 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:24:52.333 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:24:52.333 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:24:52.333 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:52.334 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:24:52.334 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:24:52.334 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11885, deviceId=2001
2025-05-16 02:24:52.334 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:24:52.334 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:24:52.335 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:24:52.335 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:24:52.337 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:24:52.338 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=487, deviceId=1001
2025-05-16 02:24:52.338 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:24:52.339 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:2001
2025-05-16 02:24:52.342 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:2001, trusting first seen key
2025-05-16 02:24:52.348 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:2001
2025-05-16 02:24:52.354 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:24:52.376 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11885
2025-05-16 02:24:52.376 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:2001
2025-05-16 02:24:52.376 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:2001
2025-05-16 02:24:52.377 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:2001
2025-05-16 02:24:52.377 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:2001
2025-05-16 02:24:52.377 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:24:54.378 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1001: false
2025-05-16 02:24:54.378 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 02:24:54.378 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1001
2025-05-16 02:24:54.379 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:124)
	at com.securechat.Launcher.main(Launcher.java:77)
2025-05-16 02:24:55.880 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /192.168.2.244:59769
2025-05-16 02:27:11.523 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:27:11.593 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9506
2025-05-16 02:27:11.595 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:27:11.618 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:27:11.619 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:27:11.619 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:27:11.619 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:27:11.624 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:27:11.624 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:27:11.625 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:27:11.625 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11186
2025-05-16 02:27:11.625 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1002
2025-05-16 02:27:11.626 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1002
2025-05-16 02:27:11.626 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1002
2025-05-16 02:27:11.626 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:27:11.627 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:27:11.628 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:27:11.628 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:27:11.629 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1002, signedPreKeyId=1002
2025-05-16 02:27:11.629 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 16014
2025-05-16 02:27:11.629 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2002
2025-05-16 02:27:11.630 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2002
2025-05-16 02:27:11.630 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2002
2025-05-16 02:27:11.630 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:27:11.630 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:27:11.631 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:27:11.631 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:27:11.632 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2002, signedPreKeyId=2002
2025-05-16 02:27:11.634 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:27:11.638 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:27:13.644 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59831
2025-05-16 02:27:13.645 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59832
2025-05-16 02:27:13.654 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11186
2025-05-16 02:27:13.655 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11186, deviceId=1002, preKeyId=1002, signedPreKeyId=1002
2025-05-16 02:27:13.656 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1002
2025-05-16 02:27:13.656 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1002
2025-05-16 02:27:13.656 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:27:13.657 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:27:13.657 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:27:13.657 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:27:13.658 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:27:13.659 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11186, deviceId=1002
2025-05-16 02:27:13.660 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:27:13.664 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:27:13.664 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:27:13.665 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:27:13.666 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59833
2025-05-16 02:27:13.667 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59834
2025-05-16 02:27:13.668 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16014
2025-05-16 02:27:13.668 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=16014, deviceId=2002, preKeyId=2002, signedPreKeyId=2002
2025-05-16 02:27:13.669 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2002
2025-05-16 02:27:13.669 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2002
2025-05-16 02:27:13.669 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:27:13.669 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:27:13.669 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:27:13.670 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:27:13.670 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:27:13.670 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=16014, deviceId=2002
2025-05-16 02:27:13.670 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:27:13.671 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:27:13.671 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:27:13.672 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:27:13.674 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:27:13.674 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11186, deviceId=1002
2025-05-16 02:27:13.675 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:27:13.675 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:2002
2025-05-16 02:27:13.677 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:2002, trusting first seen key
2025-05-16 02:27:13.684 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:2002
2025-05-16 02:27:13.690 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:27:13.713 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16014
2025-05-16 02:27:13.713 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:2002
2025-05-16 02:27:13.714 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:2002
2025-05-16 02:27:13.714 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:2002
2025-05-16 02:27:13.714 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:2002
2025-05-16 02:27:13.714 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:27:15.716 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1002: false
2025-05-16 02:27:15.717 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 02:27:15.717 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1002
2025-05-16 02:27:15.717 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:124)
	at com.securechat.Launcher.main(Launcher.java:77)
2025-05-16 02:30:27.544 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:30:27.609 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10400
2025-05-16 02:30:27.611 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:30:27.634 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:30:27.635 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:30:27.635 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:30:27.635 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:30:27.641 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:30:27.641 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:30:27.642 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:30:27.643 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10855
2025-05-16 02:30:27.643 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:30:27.643 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:30:27.644 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:30:27.644 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:30:27.644 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:30:27.645 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:30:27.646 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:30:27.646 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:30:27.647 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9413
2025-05-16 02:30:27.647 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:30:27.648 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:30:27.648 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:30:27.648 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:30:27.649 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:30:27.650 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:30:27.650 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:30:27.651 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:30:27.653 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:30:27.656 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:30:29.660 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59851
2025-05-16 02:30:29.660 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59852
2025-05-16 02:30:29.668 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10855
2025-05-16 02:30:29.669 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10855, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:30:29.670 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:30:29.670 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:30:29.670 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:30:29.670 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:30:29.671 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:30:29.671 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:30:29.671 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:30:29.672 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10855, deviceId=1
2025-05-16 02:30:29.672 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:30:29.676 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:30:29.677 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:30:29.678 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:30:29.678 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59853
2025-05-16 02:30:29.678 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59854
2025-05-16 02:30:29.679 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9413
2025-05-16 02:30:29.679 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9413, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:30:29.679 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:30:29.679 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:30:29.679 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:30:29.679 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:30:29.680 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:30:29.680 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:30:29.680 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:30:29.680 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9413, deviceId=1
2025-05-16 02:30:29.680 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:30:29.681 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:30:29.681 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:30:29.682 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:30:29.683 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:30:29.683 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10855, deviceId=1
2025-05-16 02:30:29.684 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:30:29.684 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:30:29.686 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:30:29.693 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:30:29.700 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:30:29.726 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9413
2025-05-16 02:30:29.727 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:30:29.727 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:30:29.727 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:30:29.727 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:30:29.727 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:30:31.729 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 02:30:31.729 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 02:30:31.729 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 02:30:31.730 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:124)
	at com.securechat.Launcher.main(Launcher.java:79)
2025-05-16 02:32:55.487 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:32:55.552 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9221
2025-05-16 02:32:55.554 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:32:55.575 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:32:55.576 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:32:55.576 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:32:55.576 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:32:55.580 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:32:55.580 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:32:55.581 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:32:55.581 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6080
2025-05-16 02:32:55.581 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:32:55.582 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:32:55.583 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:32:55.583 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:32:55.583 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:32:55.584 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:32:55.585 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:32:55.585 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:32:55.586 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11519
2025-05-16 02:32:55.586 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:32:55.586 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:32:55.586 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:32:55.586 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:32:55.587 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:32:55.587 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:32:55.588 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:32:55.588 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:32:55.590 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:32:55.594 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:32:57.600 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59877
2025-05-16 02:32:57.601 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59878
2025-05-16 02:32:57.616 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6080
2025-05-16 02:32:57.618 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6080, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:32:57.619 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:32:57.619 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:32:57.619 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:32:57.619 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:32:57.620 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:32:57.620 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:32:57.620 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:32:57.621 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6080, deviceId=1
2025-05-16 02:32:57.622 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:32:57.626 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:32:57.627 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:32:57.627 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:32:57.627 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59879
2025-05-16 02:32:57.628 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59880
2025-05-16 02:32:57.628 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11519
2025-05-16 02:32:57.628 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11519, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:32:57.629 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:32:57.629 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:32:57.629 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:32:57.629 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:32:57.629 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:32:57.630 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:32:57.630 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:32:57.630 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11519, deviceId=1
2025-05-16 02:32:57.630 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:32:57.630 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:32:57.631 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:32:57.631 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:32:57.632 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:32:57.633 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6080, deviceId=1
2025-05-16 02:32:57.634 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:32:57.636 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:32:57.638 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:32:57.645 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:32:57.651 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:32:57.672 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11519
2025-05-16 02:32:57.673 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:32:57.673 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:32:57.673 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:32:57.673 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:32:57.673 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:32:59.674 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 02:32:59.674 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 02:32:59.675 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:1
2025-05-16 02:32:59.675 ERROR [main] com.securechat.client.UserClient - Error sending message to bob: Empty key
java.lang.IllegalArgumentException: Empty key
	at java.base/javax.crypto.spec.SecretKeySpec.<init>(SecretKeySpec.java:114)
	at org.whispersystems.libsignal.ratchet.ChainKey.getBaseMaterial(ChainKey.java:57)
	at org.whispersystems.libsignal.ratchet.ChainKey.getMessageKeys(ChainKey.java:47)
	at org.whispersystems.libsignal.SessionCipher.encrypt(SessionCipher.java:97)
	at com.securechat.crypto.libsignal.SignalProtocolManager.encryptMessage(SignalProtocolManager.java:44)
	at com.securechat.client.UserClient.sendMessage(UserClient.java:137)
	at com.securechat.Launcher.main(Launcher.java:79)
2025-05-16 02:35:40.533 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:35:40.599 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 7222
2025-05-16 02:35:40.601 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:35:40.623 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:35:40.624 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:35:40.624 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:35:40.624 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:35:40.628 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:35:40.629 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:35:40.630 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:35:40.630 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6913
2025-05-16 02:35:40.631 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:35:40.631 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:35:40.631 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:35:40.632 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:35:40.632 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:35:40.633 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:35:40.634 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:35:40.634 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:35:40.634 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14819
2025-05-16 02:35:40.635 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:35:40.635 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:35:40.635 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:35:40.635 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:35:40.636 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:35:40.637 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:35:40.637 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:35:40.637 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:35:40.640 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:35:40.643 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:35:42.648 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59899
2025-05-16 02:35:42.648 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59900
2025-05-16 02:35:42.658 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6913
2025-05-16 02:35:42.659 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6913, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:35:42.660 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:35:42.660 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:35:42.661 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:35:42.661 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:35:42.661 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:35:42.662 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:35:42.662 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:35:42.663 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6913, deviceId=1
2025-05-16 02:35:42.664 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:35:42.668 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:35:42.669 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:35:42.669 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:35:42.670 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:59901
2025-05-16 02:35:42.670 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:59902
2025-05-16 02:35:42.670 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14819
2025-05-16 02:35:42.671 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=14819, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:35:42.671 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:35:42.671 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:35:42.671 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:35:42.671 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:35:42.672 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:35:42.672 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:35:42.672 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:35:42.672 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=14819, deviceId=1
2025-05-16 02:35:42.672 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:35:42.673 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:35:42.673 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:35:42.673 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:35:42.675 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:35:42.675 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6913, deviceId=1
2025-05-16 02:35:42.675 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:35:42.676 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:35:42.682 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:35:42.686 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:35:42.692 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:35:42.715 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14819
2025-05-16 02:35:42.715 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:35:42.716 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:35:42.716 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:35:42.716 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:35:42.716 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:35:44.718 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address alice:1: true
2025-05-16 02:35:44.719 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:35:44.730 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for alice:1: true
2025-05-16 02:35:44.731 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:35:44.731 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address alice:1 unchanged
2025-05-16 02:35:44.731 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:35:44.732 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjpBxIhBe6llr2Cnq/EwFHFW1cVYEs/CP+LnCQgAJALk0UdV4UJGiEFmhylQPs9PkuSDiDx9fZxYRxFHMsWRqIBVigGSgRllRciQjMKIQXf8GBgaVf0uCjRCoIH/RUmNwwbp06zWKeu4izPFFIQDhAAGAAiEAVxgGrA/NphNptQB84VKavBzDl7RmpG7CjjczDqBw==
2025-05-16 02:35:44.733 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to alice (isPreKeyMessage=false)
2025-05-16 02:35:44.734 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'bob' to 'alice'
2025-05-16 02:35:44.736 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'bob' to 'alice'
2025-05-16 02:35:44.736 INFO  [UserClient-Listener-alice] com.securechat.client.UserClient - Received message from bob (type: CIPHERTEXT)
2025-05-16 02:35:44.737 DEBUG [UserClient-Listener-alice] com.securechat.client.UserClient - Received ciphertext (Base64): MwjpBxIhBe6llr2Cnq/EwFHFW1cVYEs/CP+LnCQgAJALk0UdV4UJGiEFmhylQPs9PkuSDiDx9fZxYRxFHMsWRqIBVigGSgRllRciQjMKIQXf8GBgaVf0uCjRCoIH/RUmNwwbp06zWKeu4izPFFIQDhAAGAAiEAVxgGrA/NphNptQB84VKavBzDl7RmpG7CjjczDqBw==
2025-05-16 02:35:44.739 ERROR [UserClient-Listener-alice] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from bob:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:203)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:47:10.143 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:47:10.209 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3626
2025-05-16 02:47:10.211 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:47:10.236 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:47:10.237 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:47:10.237 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:47:10.237 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:47:10.242 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:47:10.243 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:47:10.243 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:47:10.244 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10887
2025-05-16 02:47:10.245 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:47:10.245 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:47:10.245 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:47:10.246 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:47:10.246 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:47:10.247 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:47:10.247 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:47:10.247 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:47:10.248 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 412
2025-05-16 02:47:10.248 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:47:10.249 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:47:10.250 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:47:10.250 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:47:10.251 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:47:10.252 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:47:10.252 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:47:10.252 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:47:10.255 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:47:10.258 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:47:12.264 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60058
2025-05-16 02:47:12.266 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60059
2025-05-16 02:47:12.281 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10887
2025-05-16 02:47:12.282 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10887, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:47:12.282 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:47:12.282 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:47:12.282 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:47:12.282 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:47:12.283 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:47:12.283 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:47:12.283 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:47:12.284 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10887, deviceId=1
2025-05-16 02:47:12.284 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:47:12.286 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:47:12.288 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:47:12.288 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:47:12.289 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60060
2025-05-16 02:47:12.289 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60061
2025-05-16 02:47:12.289 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 412
2025-05-16 02:47:12.290 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=412, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:47:12.290 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:47:12.290 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:47:12.290 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:47:12.290 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:47:12.290 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:47:12.291 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:47:12.291 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:47:12.291 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=412, deviceId=1
2025-05-16 02:47:12.291 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:47:12.291 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:47:12.292 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:47:12.292 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:47:12.293 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:47:12.294 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10887, deviceId=1
2025-05-16 02:47:12.294 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:47:12.295 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:47:12.297 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:47:12.304 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:47:12.310 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:47:12.332 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 412
2025-05-16 02:47:12.333 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:47:12.333 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:47:12.334 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:47:12.334 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:47:12.334 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:47:14.335 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address alice:1: true
2025-05-16 02:47:14.335 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:47:14.354 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for alice:1: true
2025-05-16 02:47:14.354 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:47:14.354 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address alice:1 unchanged
2025-05-16 02:47:14.354 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:47:14.355 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjpBxIhBWO3F2A4GybudR5HUGjEoo7m34zdb/3pTkpVXYdqnghhGiEFewk+V52i8HZ+hYFgeskLpMOdyO/0C4yBbiWK3+lgGiIiQjMKIQV4DHpu+cyrkEDT6dfgXxOjCyC01oi3xiRw0/VmByKHPBAAGAAiEPdUwf9Q5ARObSWDU3+3KxOuyj7Kr5IXpCicAzDqBw==
2025-05-16 02:47:14.357 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to alice (isPreKeyMessage=false)
2025-05-16 02:47:14.357 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'bob' to 'alice'
2025-05-16 02:47:14.358 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'bob' to 'alice'
2025-05-16 02:47:14.358 INFO  [UserClient-Listener-alice] com.securechat.client.UserClient - Received message from bob (type: CIPHERTEXT)
2025-05-16 02:47:14.359 DEBUG [UserClient-Listener-alice] com.securechat.client.UserClient - Received ciphertext (Base64): MwjpBxIhBWO3F2A4GybudR5HUGjEoo7m34zdb/3pTkpVXYdqnghhGiEFewk+V52i8HZ+hYFgeskLpMOdyO/0C4yBbiWK3+lgGiIiQjMKIQV4DHpu+cyrkEDT6dfgXxOjCyC01oi3xiRw0/VmByKHPBAAGAAiEPdUwf9Q5ARObSWDU3+3KxOuyj7Kr5IXpCicAzDqBw==
2025-05-16 02:47:14.361 ERROR [UserClient-Listener-alice] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from bob:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:60)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:211)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 02:48:47.829 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:48:47.893 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 5305
2025-05-16 02:48:47.895 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:48:47.921 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:48:47.921 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:48:47.922 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:48:47.922 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:48:47.927 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:48:47.928 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:48:47.928 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:48:47.929 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8214
2025-05-16 02:48:47.930 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:48:47.931 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:48:47.931 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:48:47.931 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:48:47.932 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:48:47.933 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:48:47.933 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:48:47.934 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:48:47.935 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1210
2025-05-16 02:48:47.935 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:48:47.936 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:48:47.936 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:48:47.936 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:48:47.936 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:48:47.937 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:48:47.938 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:48:47.938 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:48:47.940 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:48:47.944 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:48:49.949 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60074
2025-05-16 02:48:49.949 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60075
2025-05-16 02:48:49.958 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8214
2025-05-16 02:48:49.959 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8214, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:48:49.960 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:48:49.960 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:48:49.960 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:48:49.961 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:48:49.961 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:48:49.961 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:48:49.961 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:48:49.962 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8214, deviceId=1
2025-05-16 02:48:49.962 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:48:49.965 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:48:49.966 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:48:49.967 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60076
2025-05-16 02:48:49.967 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:48:49.968 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60077
2025-05-16 02:48:49.968 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1210
2025-05-16 02:48:49.969 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1210, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:48:49.969 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:48:49.969 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:48:49.969 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:48:49.969 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:48:49.970 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:48:49.970 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:48:49.970 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:48:49.970 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1210, deviceId=1
2025-05-16 02:48:49.971 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:48:49.971 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:48:49.972 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:48:49.972 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:48:49.974 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:48:49.974 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=8214, deviceId=1
2025-05-16 02:48:49.975 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:48:49.975 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:48:49.978 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:48:49.984 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:48:49.990 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:48:50.013 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1210
2025-05-16 02:48:50.013 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:48:50.013 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:48:50.013 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:48:50.014 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:48:50.014 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:48:52.016 ERROR [main] com.securechat.client.UserClient - No device ID for peer bob, establish session first
2025-05-16 02:54:19.990 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:54:20.054 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6946
2025-05-16 02:54:20.056 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:54:20.077 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:54:20.077 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:54:20.078 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:54:20.078 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:54:20.082 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:54:20.083 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:54:20.083 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:54:20.084 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 15161
2025-05-16 02:54:20.084 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:54:20.085 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:54:20.085 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:54:20.085 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:54:20.086 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:54:20.087 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:54:20.087 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:54:20.088 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:54:20.088 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3344
2025-05-16 02:54:20.088 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:54:20.089 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:54:20.089 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:54:20.089 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:54:20.089 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:54:20.091 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:54:20.092 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:54:20.092 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:54:20.095 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:54:20.099 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:54:22.104 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60106
2025-05-16 02:54:22.105 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60107
2025-05-16 02:54:22.111 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 15161
2025-05-16 02:54:22.112 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=15161, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:54:22.112 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:54:22.113 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:54:22.113 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:54:22.113 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:54:22.114 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:54:22.114 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:54:22.114 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:54:22.115 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=15161, deviceId=1
2025-05-16 02:54:22.115 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:54:22.119 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:54:22.119 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:54:22.120 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:54:22.120 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60108
2025-05-16 02:54:22.120 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60109
2025-05-16 02:54:22.121 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3344
2025-05-16 02:54:22.121 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=3344, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:54:22.121 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:54:22.121 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:54:22.122 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:54:22.122 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:54:22.122 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:54:22.122 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:54:22.123 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:54:22.123 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=3344, deviceId=1
2025-05-16 02:54:22.123 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:54:22.124 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:54:22.124 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:54:22.125 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:54:22.126 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:54:22.126 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=15161, deviceId=1
2025-05-16 02:54:22.127 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:54:22.127 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:54:22.129 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:54:22.136 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:54:22.142 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:54:22.167 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3344
2025-05-16 02:54:22.167 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:54:22.168 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:54:22.168 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:54:22.168 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:54:22.168 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:54:24.170 ERROR [main] com.securechat.client.UserClient - No device ID for peer bob, establish session first
2025-05-16 02:55:00.913 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:55:00.981 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6661
2025-05-16 02:55:00.983 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:55:01.012 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:55:01.012 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:55:01.012 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:55:01.012 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:55:01.018 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:55:01.018 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:55:01.019 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:55:01.020 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3242
2025-05-16 02:55:01.020 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:55:01.020 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:55:01.021 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:55:01.021 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:55:01.021 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:55:01.022 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:55:01.022 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:55:01.023 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:55:01.023 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 16
2025-05-16 02:55:01.024 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:55:01.024 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:55:01.025 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:55:01.025 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:55:01.025 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:55:01.026 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:55:01.027 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:55:01.027 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:55:01.030 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:55:01.034 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:55:03.036 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60115
2025-05-16 02:55:03.037 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60116
2025-05-16 02:55:03.044 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 3242
2025-05-16 02:55:03.045 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=3242, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:55:03.045 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:55:03.045 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:55:03.046 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:55:03.046 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:55:03.046 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:55:03.046 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:55:03.047 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:55:03.047 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=3242, deviceId=1
2025-05-16 02:55:03.047 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:55:03.050 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:55:03.051 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:55:03.051 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:55:03.052 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60117
2025-05-16 02:55:03.052 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60118
2025-05-16 02:55:03.053 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16
2025-05-16 02:55:03.053 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=16, deviceId=1, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:55:03.053 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:55:03.053 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:55:03.053 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:55:03.053 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:55:03.054 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:55:03.054 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:55:03.054 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:55:03.054 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=16, deviceId=1
2025-05-16 02:55:03.055 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:55:03.055 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:55:03.056 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:55:03.057 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:55:03.058 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:55:03.059 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=3242, deviceId=1
2025-05-16 02:55:03.059 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:55:03.060 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:55:03.062 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:55:03.065 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:55:03.074 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:55:03.098 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16
2025-05-16 02:55:03.099 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:55:03.099 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:55:03.099 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:55:03.099 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:55:03.099 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:55:05.100 ERROR [main] com.securechat.client.UserClient - No device ID for peer bob, establish session first
2025-05-16 02:57:36.656 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:57:36.737 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13429
2025-05-16 02:57:36.740 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:57:36.765 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:57:36.765 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:57:36.765 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:36.766 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:57:36.769 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:57:36.770 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:57:36.770 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:57:36.771 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1160
2025-05-16 02:57:36.771 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:57:36.772 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:57:36.772 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:57:36.772 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:36.772 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:57:36.773 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:57:36.773 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:57:36.774 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:57:36.774 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9263
2025-05-16 02:57:36.774 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:57:36.775 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:57:36.775 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:57:36.775 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:36.776 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:57:36.777 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:57:36.777 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:57:36.778 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:57:36.780 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:57:36.783 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:57:38.787 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60146
2025-05-16 02:57:38.788 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60147
2025-05-16 02:57:38.800 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1160
2025-05-16 02:57:38.801 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1160, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:57:38.802 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:57:38.802 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:57:38.802 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:57:38.802 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:57:38.803 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:38.803 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:57:38.804 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:57:38.804 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1160, deviceId=1
2025-05-16 02:57:38.805 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:57:38.807 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:57:38.808 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:57:38.809 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:57:38.809 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60148
2025-05-16 02:57:38.810 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60149
2025-05-16 02:57:38.811 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9263
2025-05-16 02:57:38.811 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9263, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:57:38.812 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:57:38.812 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:57:38.812 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:57:38.812 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:57:38.813 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:38.813 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:57:38.813 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:57:38.813 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9263, deviceId=2
2025-05-16 02:57:38.813 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:57:38.814 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:57:38.814 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:57:38.815 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:57:38.816 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:57:38.821 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1160, deviceId=1
2025-05-16 02:57:38.822 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:57:38.822 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:57:38.825 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:57:38.831 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:57:38.837 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:38.859 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9263
2025-05-16 02:57:38.859 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:57:38.859 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:57:38.860 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:57:38.860 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:57:38.860 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:57:40.862 ERROR [main] com.securechat.client.UserClient - No device ID for peer bob, establish session first
2025-05-16 02:57:57.174 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 02:57:57.242 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12270
2025-05-16 02:57:57.245 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 02:57:57.267 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 02:57:57.268 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 02:57:57.268 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:57.268 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 02:57:57.272 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 02:57:57.272 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 02:57:57.272 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 02:57:57.273 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9418
2025-05-16 02:57:57.274 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 02:57:57.274 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 02:57:57.275 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 02:57:57.275 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:57.275 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 02:57:57.276 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 02:57:57.276 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 02:57:57.276 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:57:57.277 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14335
2025-05-16 02:57:57.277 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 02:57:57.277 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 02:57:57.278 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 02:57:57.278 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:57.278 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 02:57:57.279 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 02:57:57.279 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 02:57:57.280 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:57:57.284 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 02:57:57.287 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 02:57:59.295 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60154
2025-05-16 02:57:59.296 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60155
2025-05-16 02:57:59.308 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 9418
2025-05-16 02:57:59.309 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=9418, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 02:57:59.309 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 02:57:59.309 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 02:57:59.309 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 02:57:59.310 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 02:57:59.310 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:59.310 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:57:59.311 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:57:59.313 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=9418, deviceId=1
2025-05-16 02:57:59.314 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:57:59.319 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 02:57:59.320 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 02:57:59.320 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 02:57:59.321 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60156
2025-05-16 02:57:59.321 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60157
2025-05-16 02:57:59.321 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14335
2025-05-16 02:57:59.322 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=14335, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 02:57:59.322 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 02:57:59.322 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 02:57:59.322 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 02:57:59.322 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 02:57:59.322 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:59.323 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 02:57:59.323 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 02:57:59.323 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=14335, deviceId=2
2025-05-16 02:57:59.323 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 02:57:59.323 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 02:57:59.324 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 02:57:59.324 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 02:57:59.327 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 02:57:59.327 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=9418, deviceId=1
2025-05-16 02:57:59.328 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 02:57:59.328 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 02:57:59.330 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 02:57:59.333 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 02:57:59.343 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 02:57:59.365 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 14335
2025-05-16 02:57:59.366 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 02:57:59.366 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 02:57:59.366 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 02:57:59.366 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 02:57:59.366 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 02:58:01.367 ERROR [main] com.securechat.client.UserClient - No device ID for peer bob, establish session first
2025-05-16 03:00:18.979 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 03:00:19.046 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12550
2025-05-16 03:00:19.048 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 03:00:19.071 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 03:00:19.072 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 03:00:19.072 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:00:19.072 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 03:00:19.077 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 03:00:19.077 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 03:00:19.078 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 03:00:19.079 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 10995
2025-05-16 03:00:19.079 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 03:00:19.080 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 03:00:19.080 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 03:00:19.080 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:00:19.080 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 03:00:19.081 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 03:00:19.082 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 03:00:19.082 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:00:19.082 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 16357
2025-05-16 03:00:19.083 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 03:00:19.083 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 03:00:19.083 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 03:00:19.083 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:00:19.084 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 03:00:19.086 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 03:00:19.086 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 03:00:19.086 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:00:19.089 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 03:00:19.093 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 03:00:21.100 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60168
2025-05-16 03:00:21.101 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60169
2025-05-16 03:00:21.113 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 10995
2025-05-16 03:00:21.114 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=10995, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:00:21.114 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 03:00:21.114 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 03:00:21.114 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 03:00:21.115 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 03:00:21.115 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:00:21.115 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:00:21.116 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:00:21.116 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=10995, deviceId=1
2025-05-16 03:00:21.116 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:00:21.119 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 03:00:21.120 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 03:00:21.120 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 03:00:21.121 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60170
2025-05-16 03:00:21.121 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60171
2025-05-16 03:00:21.121 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16357
2025-05-16 03:00:21.122 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=16357, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:00:21.122 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 03:00:21.122 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 03:00:21.122 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 03:00:21.122 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 03:00:21.122 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:00:21.123 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:00:21.123 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:00:21.123 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=16357, deviceId=2
2025-05-16 03:00:21.123 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:00:21.124 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 03:00:21.124 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 03:00:21.124 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 03:00:21.126 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 03:00:21.127 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=10995, deviceId=1
2025-05-16 03:00:21.127 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 03:00:21.128 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 03:00:21.134 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 03:00:21.138 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 03:00:21.143 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:00:21.166 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 16357
2025-05-16 03:00:21.167 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 03:00:21.167 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 03:00:21.167 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 03:00:21.167 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 03:00:21.167 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 03:00:23.169 ERROR [main] com.securechat.client.UserClient - No device ID for peer bob, establish session first
2025-05-16 03:02:51.158 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 03:02:51.223 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11485
2025-05-16 03:02:51.225 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 03:02:51.248 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 03:02:51.249 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 03:02:51.249 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:02:51.249 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 03:02:51.254 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 03:02:51.254 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 03:02:51.254 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 03:02:51.255 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 13326
2025-05-16 03:02:51.255 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 03:02:51.256 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 03:02:51.256 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 03:02:51.256 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:02:51.256 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 03:02:51.257 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 03:02:51.258 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 03:02:51.258 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:02:51.259 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 8625
2025-05-16 03:02:51.259 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 03:02:51.259 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 03:02:51.260 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 03:02:51.260 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:02:51.260 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 03:02:51.261 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 03:02:51.261 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 03:02:51.261 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:02:51.264 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 03:02:51.267 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 03:02:53.274 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60192
2025-05-16 03:02:53.275 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60193
2025-05-16 03:02:53.285 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8625
2025-05-16 03:02:53.286 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=8625, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:02:53.286 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 03:02:53.287 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 03:02:53.287 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 03:02:53.287 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 03:02:53.288 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:02:53.288 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:02:53.289 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:02:53.289 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=8625, deviceId=2
2025-05-16 03:02:53.290 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:02:53.292 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 03:02:53.293 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 03:02:53.294 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60194
2025-05-16 03:02:53.294 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 03:02:53.294 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60195
2025-05-16 03:02:53.295 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 13326
2025-05-16 03:02:53.295 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=13326, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:02:53.295 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 03:02:53.295 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 03:02:53.295 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 03:02:53.296 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 03:02:53.296 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:02:53.296 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:02:53.296 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:02:53.296 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=13326, deviceId=1
2025-05-16 03:02:53.297 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:02:53.297 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 03:02:53.298 INFO  [pool-1-thread-2] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 03:02:53.298 INFO  [pool-1-thread-2] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 03:02:53.299 INFO  [pool-1-thread-3] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 03:02:53.299 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=13326, deviceId=1
2025-05-16 03:02:53.300 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 03:02:53.301 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 03:02:53.303 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 03:02:53.309 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 03:02:53.316 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:02:53.340 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 8625
2025-05-16 03:02:53.340 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 03:02:53.341 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 03:02:53.341 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 03:02:53.341 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 03:02:53.341 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 03:02:55.343 ERROR [main] com.securechat.client.UserClient - No device ID for peer bob, establish session first
2025-05-16 03:03:09.977 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 03:03:10.054 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 14099
2025-05-16 03:03:10.056 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 03:03:10.081 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 03:03:10.081 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 03:03:10.082 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:03:10.082 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 03:03:10.088 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 03:03:10.088 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 03:03:10.088 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 03:03:10.089 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 7810
2025-05-16 03:03:10.089 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 03:03:10.090 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 03:03:10.090 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 03:03:10.091 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:03:10.091 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 03:03:10.092 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 03:03:10.092 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 03:03:10.092 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:03:10.093 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 7731
2025-05-16 03:03:10.093 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 03:03:10.094 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 03:03:10.094 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 03:03:10.094 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:03:10.094 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 03:03:10.095 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 03:03:10.096 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 03:03:10.096 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:03:10.098 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 03:03:10.101 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 03:03:12.108 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60199
2025-05-16 03:03:12.108 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60200
2025-05-16 03:03:12.117 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7731
2025-05-16 03:03:12.118 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=7731, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:03:12.118 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 03:03:12.118 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 03:03:12.119 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 03:03:12.119 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 03:03:12.119 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:03:12.119 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:03:12.119 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:03:12.120 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=7731, deviceId=2
2025-05-16 03:03:12.120 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:03:12.124 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 03:03:12.125 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 03:03:12.125 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 03:03:12.126 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60201
2025-05-16 03:03:12.127 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60202
2025-05-16 03:03:12.129 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7810
2025-05-16 03:03:12.129 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=7810, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:03:12.129 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 03:03:12.130 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 03:03:12.130 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 03:03:12.130 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 03:03:12.130 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:03:12.131 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:03:12.131 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:03:12.131 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=7810, deviceId=1
2025-05-16 03:03:12.131 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:03:12.132 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 03:03:12.132 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 03:03:12.132 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 03:03:12.134 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 03:03:12.134 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=7731, deviceId=2
2025-05-16 03:03:12.134 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 03:03:12.135 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:2
2025-05-16 03:03:12.138 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:2, trusting first seen key
2025-05-16 03:03:12.144 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:03:12.151 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:03:12.175 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7810
2025-05-16 03:03:12.175 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:03:12.175 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:2
2025-05-16 03:03:12.175 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:03:12.175 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:2
2025-05-16 03:03:12.176 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 03:03:14.177 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:2: true
2025-05-16 03:03:14.178 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:03:14.195 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:2: true
2025-05-16 03:03:14.196 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:03:14.196 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:2 unchanged
2025-05-16 03:03:14.196 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:03:14.197 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBagmFKdMDgVQWjoXrkxtyAY5afHiRkeUF81n+yCB5ZxPGiEFbuWjGzEisfJK0YULXzDyZAZlp/e7CexMi551EVSePkIiQjMKIQXbtey3kM+6P3yXAkvgxMs7Dk6h6KRqPXU2RE2+AiIAMRAAGAAiECrKyvZXP30SKsfaQeZawgDm4NzH1T74ayiCPTDSDw==
2025-05-16 03:03:14.200 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 03:03:14.200 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 03:03:14.201 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 03:03:14.202 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 03:03:14.202 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - No device ID known for sender alice, ignoring message
2025-05-16 03:06:44.750 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 03:06:44.815 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 4734
2025-05-16 03:06:44.817 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 03:06:44.840 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 03:06:44.840 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 03:06:44.841 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:06:44.841 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 03:06:44.845 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 03:06:44.845 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 03:06:44.846 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 03:06:44.847 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11615
2025-05-16 03:06:44.847 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 03:06:44.848 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 03:06:44.848 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 03:06:44.848 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:06:44.848 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 03:06:44.849 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 03:06:44.850 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 03:06:44.850 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:06:44.850 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11883
2025-05-16 03:06:44.851 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 03:06:44.851 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 03:06:44.851 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 03:06:44.851 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:06:44.852 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 03:06:44.854 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 03:06:44.854 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 03:06:44.854 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:06:44.859 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 03:06:44.862 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 03:06:46.869 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60242
2025-05-16 03:06:46.870 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60243
2025-05-16 03:06:46.886 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11883
2025-05-16 03:06:46.887 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11883, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:06:46.887 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 03:06:46.887 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 03:06:46.888 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 03:06:46.888 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 03:06:46.888 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:06:46.888 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:06:46.888 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:06:46.889 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11883, deviceId=2
2025-05-16 03:06:46.889 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:06:46.893 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 03:06:46.894 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 03:06:46.895 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 03:06:46.895 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60244
2025-05-16 03:06:46.895 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60245
2025-05-16 03:06:46.895 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11615
2025-05-16 03:06:46.895 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11615, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:06:46.895 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 03:06:46.896 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 03:06:46.896 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 03:06:46.896 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 03:06:46.896 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:06:46.896 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:06:46.896 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:06:46.897 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11615, deviceId=1
2025-05-16 03:06:46.897 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:06:46.897 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 03:06:46.898 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 03:06:46.898 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 03:06:46.900 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 03:06:46.900 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11883, deviceId=2
2025-05-16 03:06:46.900 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 03:06:46.901 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:2
2025-05-16 03:06:46.904 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:2, trusting first seen key
2025-05-16 03:06:46.911 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:06:46.917 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:06:46.939 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11615
2025-05-16 03:06:46.940 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:06:46.940 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:2
2025-05-16 03:06:46.940 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:06:46.940 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:2
2025-05-16 03:06:46.941 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 03:06:48.941 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:2: true
2025-05-16 03:06:48.942 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:06:48.962 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:2: true
2025-05-16 03:06:48.963 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:06:48.964 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:2 unchanged
2025-05-16 03:06:48.964 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:06:48.965 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBeWgadr8RrWweCREf769vaSb/I0X2+X0qQcyDMlpHOB6GiEFSSs8hHukMI1OJ0nGkHrBdWmVVM4Dp4XWCN3Cj6zXCEoiQjMKIQVnGBoet6DwbfVDdNETad/7lu0DB6t0938HNRlSq3mOFBAAGAAiEOVnmGMrnb+t5Bh62ga74U+oaQoEtn2czCjfWjDSDw==
2025-05-16 03:06:48.967 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 03:06:48.967 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 03:06:48.969 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 03:06:48.969 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 03:06:48.970 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - No device ID known for sender alice, ignoring message
2025-05-16 03:17:48.248 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 03:17:48.315 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3029
2025-05-16 03:17:48.317 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 03:17:48.339 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 03:17:48.339 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 03:17:48.340 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:17:48.340 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 03:17:48.344 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 03:17:48.345 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 03:17:48.345 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 03:17:48.346 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6185
2025-05-16 03:17:48.346 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 03:17:48.347 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 03:17:48.347 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 03:17:48.347 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:17:48.347 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 03:17:48.348 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 03:17:48.349 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 03:17:48.349 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:17:48.350 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 895
2025-05-16 03:17:48.350 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 03:17:48.350 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 03:17:48.350 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 03:17:48.351 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:17:48.351 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 03:17:48.352 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 03:17:48.353 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 03:17:48.353 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:17:48.355 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 03:17:48.359 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 03:17:50.362 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60281
2025-05-16 03:17:50.363 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60282
2025-05-16 03:17:50.373 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 895
2025-05-16 03:17:50.375 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=895, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:17:50.375 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 03:17:50.375 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 03:17:50.375 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 03:17:50.376 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 03:17:50.376 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:17:50.376 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:17:50.377 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:17:50.378 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=895, deviceId=2
2025-05-16 03:17:50.379 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:17:50.382 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 03:17:50.383 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 03:17:50.383 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 03:17:50.384 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60283
2025-05-16 03:17:50.384 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60284
2025-05-16 03:17:50.384 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6185
2025-05-16 03:17:50.384 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6185, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:17:50.384 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 03:17:50.385 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 03:17:50.385 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 03:17:50.385 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 03:17:50.385 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:17:50.386 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:17:50.386 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:17:50.386 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6185, deviceId=1
2025-05-16 03:17:50.387 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:17:50.388 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 03:17:50.388 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 03:17:50.388 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 03:17:50.389 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 03:17:50.389 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=895, deviceId=2
2025-05-16 03:17:50.390 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 03:17:50.390 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:2
2025-05-16 03:17:50.392 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:2, trusting first seen key
2025-05-16 03:17:50.400 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:17:50.406 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:17:50.430 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6185
2025-05-16 03:17:50.430 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:17:50.430 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:2
2025-05-16 03:17:50.430 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:17:50.431 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:2
2025-05-16 03:17:50.431 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 03:17:52.432 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:2: true
2025-05-16 03:17:52.433 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:17:52.455 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:2: true
2025-05-16 03:17:52.455 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:17:52.455 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:2 unchanged
2025-05-16 03:17:52.455 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:17:52.456 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBfNaE+q14+S1zZx6wVuSHwts837LVMME57o9oMS/gWt2GiEF5HJugER6p3fK7tWoUB8piIz7KZPULBlCsoZX/kDG5xIiQjMKIQXFrtGy3bIrSYinS3Te+MwLcAXI1i1jWflUuEUcJQ0fLhAAGAAiEAPeOD/NiXwmcZiCCmCkBMVxj/e68n1CYSipMDDSDw==
2025-05-16 03:17:52.458 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 03:17:52.458 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 03:17:52.459 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 03:17:52.459 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 03:17:52.460 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - No device ID known for sender alice, ignoring message
2025-05-16 03:26:48.614 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 03:26:48.677 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 9930
2025-05-16 03:26:48.679 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 03:26:48.702 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 03:26:48.703 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 03:26:48.703 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:26:48.703 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 03:26:48.708 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 03:26:48.709 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 03:26:48.709 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 03:26:48.710 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 7947
2025-05-16 03:26:48.710 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 03:26:48.710 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 03:26:48.711 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 03:26:48.711 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:26:48.711 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 03:26:48.712 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 03:26:48.713 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 03:26:48.713 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:26:48.714 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6720
2025-05-16 03:26:48.714 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 03:26:48.715 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 03:26:48.715 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 03:26:48.715 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:26:48.715 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 03:26:48.716 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 03:26:48.717 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 03:26:48.717 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:26:48.719 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 03:26:48.723 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 03:26:50.725 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60315
2025-05-16 03:26:50.726 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60316
2025-05-16 03:26:50.732 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 6720
2025-05-16 03:26:50.733 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=6720, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:26:50.734 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 03:26:50.734 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 03:26:50.735 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 03:26:50.735 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 03:26:50.735 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:26:50.735 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:26:50.736 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:26:50.736 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=6720, deviceId=2
2025-05-16 03:26:50.737 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:26:50.741 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 03:26:50.742 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 03:26:50.743 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 03:26:50.743 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60317
2025-05-16 03:26:50.744 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60318
2025-05-16 03:26:50.744 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7947
2025-05-16 03:26:50.745 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=7947, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:26:50.745 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 03:26:50.745 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 03:26:50.745 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 03:26:50.746 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 03:26:50.746 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:26:50.746 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:26:50.746 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:26:50.746 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=7947, deviceId=1
2025-05-16 03:26:50.747 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:26:50.747 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 03:26:50.748 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 03:26:50.748 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 03:26:50.748 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 03:26:50.748 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 03:26:50.749 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 03:26:50.750 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=6720, deviceId=2
2025-05-16 03:26:50.750 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 03:26:50.750 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:2
2025-05-16 03:26:50.753 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:2, trusting first seen key
2025-05-16 03:26:50.756 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:26:50.765 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:26:50.791 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 7947
2025-05-16 03:26:50.791 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:26:50.792 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:2
2025-05-16 03:26:50.792 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:26:50.792 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:2
2025-05-16 03:26:50.792 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 03:26:52.792 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:2: true
2025-05-16 03:26:52.793 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:26:52.814 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:2: true
2025-05-16 03:26:52.814 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:26:52.814 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:2 unchanged
2025-05-16 03:26:52.815 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:26:52.815 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBXzYAY3luuPoAis879hDsmM2hzNXrrPeg5rtW+bkrodhGiEFWqjR3FXc122HwxMviXibL9cN6n8tDu96PEU9swIbOB0iQjMKIQWPXWFnk+nhHROhtzwECgvhxkBJR/SYXYrSSFkxxx4WWBAAGAAiEKg3xa3YnJf/1pkaTD8MDLz8qEYI5KQjHSiLPjDSDw==
2025-05-16 03:26:52.818 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 03:26:52.818 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 03:26:52.819 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 03:26:52.819 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 03:26:52.819 WARN  [UserClient-Listener-bob] com.securechat.client.UserClient - No device ID known for sender alice, ignoring message
2025-05-16 03:27:31.648 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 03:27:31.712 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 6563
2025-05-16 03:27:31.714 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 03:27:31.736 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 03:27:31.736 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 03:27:31.737 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:27:31.737 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 03:27:31.741 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 03:27:31.741 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 03:27:31.741 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 03:27:31.742 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 1060
2025-05-16 03:27:31.743 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 03:27:31.743 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 03:27:31.744 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 03:27:31.744 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:27:31.744 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 03:27:31.745 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 03:27:31.746 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 03:27:31.746 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:27:31.747 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 2277
2025-05-16 03:27:31.747 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 03:27:31.747 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 03:27:31.747 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 03:27:31.748 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:27:31.748 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 03:27:31.749 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 03:27:31.749 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 03:27:31.750 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:27:31.752 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 03:27:31.755 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 03:27:33.758 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60337
2025-05-16 03:27:33.758 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60338
2025-05-16 03:27:33.767 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2277
2025-05-16 03:27:33.768 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=2277, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 03:27:33.769 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 03:27:33.769 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 03:27:33.770 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 03:27:33.770 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 03:27:33.771 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:27:33.771 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:27:33.772 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:27:33.772 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=2277, deviceId=2
2025-05-16 03:27:33.773 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:27:33.776 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user bob
2025-05-16 03:27:33.777 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 03:27:33.778 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 03:27:33.778 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:60339
2025-05-16 03:27:33.778 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:60340
2025-05-16 03:27:33.779 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1060
2025-05-16 03:27:33.779 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=1060, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 03:27:33.779 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 03:27:33.779 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 03:27:33.780 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 03:27:33.780 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 03:27:33.780 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:27:33.780 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 03:27:33.780 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 03:27:33.781 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=1060, deviceId=1
2025-05-16 03:27:33.781 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 03:27:33.782 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as user alice
2025-05-16 03:27:33.782 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 03:27:33.783 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 03:27:33.783 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 03:27:33.784 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 03:27:33.785 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent prekey bundle for 'bob'
2025-05-16 03:27:33.786 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=2277, deviceId=2
2025-05-16 03:27:33.786 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 03:27:33.787 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: bob:2
2025-05-16 03:27:33.789 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:2, trusting first seen key
2025-05-16 03:27:33.796 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:27:33.802 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:27:33.823 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 1060
2025-05-16 03:27:33.824 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:27:33.824 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:2
2025-05-16 03:27:33.824 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:27:33.824 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with bob:2
2025-05-16 03:27:33.824 INFO  [main] com.securechat.client.UserClient - Secure session established with bob
2025-05-16 03:27:33.824 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address alice:1: false
2025-05-16 03:27:33.824 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 03:27:33.825 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent prekey bundle for 'alice'
2025-05-16 03:27:33.825 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=1060, deviceId=1
2025-05-16 03:27:33.826 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 03:27:33.826 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with remote address: alice:1
2025-05-16 03:27:33.826 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 03:27:33.827 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 03:27:33.827 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 03:27:33.829 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 2277
2025-05-16 03:27:33.829 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 03:27:33.829 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 03:27:33.829 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 03:27:33.829 INFO  [main] c.s.c.l.SignalProtocolManager - Session initialized with alice:1
2025-05-16 03:27:33.830 INFO  [main] com.securechat.client.UserClient - Secure session established with alice
2025-05-16 03:27:35.832 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:2: true
2025-05-16 03:27:35.832 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 03:27:35.849 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:2: true
2025-05-16 03:27:35.849 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 03:27:35.849 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:2 unchanged
2025-05-16 03:27:35.849 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 03:27:35.850 DEBUG [main] com.securechat.client.UserClient - Sending ciphertext (Base64): MwjRDxIhBbC53cY5NvtLVp6MYZ7p5Xb6lRfEtuvkYW8xRzK+dxt6GiEFZQUa2ajZbLMvOX4L9BCs5X2LToowc8GQZcewGP1Y4HIiQjMKIQXocfMSmRhzLruewNwu2MJZBgTzqiw53+C7lA+ING3eHhAAGAAiEL7yg7j9R5KwKwuWl32zdeHIpPZ8pWQQxiikCDDSDw==
2025-05-16 03:27:35.852 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (isPreKeyMessage=false)
2025-05-16 03:27:35.853 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 03:27:35.853 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 03:27:35.853 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Received message from alice (type: CIPHERTEXT)
2025-05-16 03:27:35.854 DEBUG [UserClient-Listener-bob] com.securechat.client.UserClient - Received ciphertext (Base64): MwjRDxIhBbC53cY5NvtLVp6MYZ7p5Xb6lRfEtuvkYW8xRzK+dxt6GiEFZQUa2ajZbLMvOX4L9BCs5X2LToowc8GQZcewGP1Y4HIiQjMKIQXocfMSmRhzLruewNwu2MJZBgTzqiw53+C7lA+ING3eHhAAGAAiEL7yg7j9R5KwKwuWl32zdeHIpPZ8pWQQxiikCDDSDw==
2025-05-16 03:27:35.856 ERROR [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Failed to decrypt SignalMessage from alice:1: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
org.whispersystems.libsignal.InvalidMessageException: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:68)
	at com.securechat.crypto.libsignal.SignalProtocolManager.decryptMessage(SignalProtocolManager.java:66)
	at com.securechat.client.UserClient.lambda$0(UserClient.java:232)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.
	at com.google.protobuf.GeneratedMessageLite.parsePartialFrom(GeneratedMessageLite.java:1565)
	at com.google.protobuf.GeneratedMessageLite.parseFrom(GeneratedMessageLite.java:1654)
	at org.whispersystems.libsignal.protocol.SignalProtos$SignalMessage.parseFrom(SignalProtos.java:242)
	at org.whispersystems.libsignal.protocol.SignalMessage.<init>(SignalMessage.java:52)
	... 3 common frames omitted
2025-05-16 05:25:47.267 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 05:25:47.340 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 5944
2025-05-16 05:25:47.342 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 05:25:47.369 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 05:25:47.369 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 05:25:47.369 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:25:47.369 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 05:25:47.374 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 05:25:47.374 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 05:25:47.374 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 05:25:47.375 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 11388
2025-05-16 05:25:47.375 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 05:25:47.376 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 05:25:47.377 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 05:25:47.377 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:25:47.377 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 05:25:47.379 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 05:25:47.379 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 05:25:47.380 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 05:25:47.381 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12898
2025-05-16 05:25:47.382 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 05:25:47.383 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 05:25:47.384 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 05:25:47.384 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:25:47.384 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 05:25:47.386 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 05:25:47.386 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 05:25:47.386 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 05:25:47.390 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 05:25:47.394 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 05:25:49.396 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:54197
2025-05-16 05:25:49.397 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:54198
2025-05-16 05:25:49.408 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received userId 'bob'
2025-05-16 05:25:49.408 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12898
2025-05-16 05:25:49.410 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12898, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 05:25:49.411 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 05:25:49.412 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 05:25:49.412 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 05:25:49.413 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 05:25:49.413 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:25:49.413 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 05:25:49.414 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 05:25:49.416 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12898, deviceId=2
2025-05-16 05:25:49.417 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 05:25:49.421 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as 'bob'
2025-05-16 05:25:49.422 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 05:25:49.422 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 05:25:49.423 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:54199
2025-05-16 05:25:49.423 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered user 'bob' with message router
2025-05-16 05:25:49.423 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:54200
2025-05-16 05:25:49.424 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11388
2025-05-16 05:25:49.425 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=11388, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 05:25:49.425 DEBUG [pool-1-thread-3] com.securechat.server.Server - Received userId 'alice'
2025-05-16 05:25:49.425 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 05:25:49.425 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 05:25:49.425 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 05:25:49.426 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 05:25:49.426 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:25:49.426 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 05:25:49.426 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 05:25:49.427 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=11388, deviceId=1
2025-05-16 05:25:49.427 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 05:25:49.428 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as 'alice'
2025-05-16 05:25:49.429 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 05:25:49.429 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 05:25:49.430 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 05:25:49.430 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 05:25:49.430 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered user 'alice' with message router
2025-05-16 05:25:49.430 DEBUG [main] c.s.c.l.SignalProtocolManager - Session check for bob returned false
2025-05-16 05:25:49.432 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent preKey bundle for 'bob'
2025-05-16 05:25:49.432 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12898, deviceId=2
2025-05-16 05:25:49.433 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 05:25:49.433 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with bob:2
2025-05-16 05:25:49.438 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:2, trusting first seen key
2025-05-16 05:25:49.450 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 05:25:49.462 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:25:49.495 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 11388
2025-05-16 05:25:49.496 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 05:25:49.496 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:2
2025-05-16 05:25:49.496 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 05:25:49.496 INFO  [main] c.s.c.l.SignalProtocolManager - Session successfully initialized with bob:2
2025-05-16 05:25:49.496 INFO  [main] com.securechat.client.UserClient - Session established with bob
2025-05-16 05:25:49.497 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address alice:1: false
2025-05-16 05:25:49.497 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 05:25:49.497 DEBUG [main] c.s.c.l.SignalProtocolManager - Session check for alice returned false
2025-05-16 05:25:49.498 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent preKey bundle for 'alice'
2025-05-16 05:25:49.498 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=11388, deviceId=1
2025-05-16 05:25:49.498 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 05:25:49.499 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with alice:1
2025-05-16 05:25:49.499 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 05:25:49.499 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 05:25:49.500 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:25:49.502 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12898
2025-05-16 05:25:49.502 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 05:25:49.502 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 05:25:49.503 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 05:25:49.503 INFO  [main] c.s.c.l.SignalProtocolManager - Session successfully initialized with alice:1
2025-05-16 05:25:49.503 INFO  [main] com.securechat.client.UserClient - Session established with alice
2025-05-16 05:25:51.505 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:2: true
2025-05-16 05:25:51.505 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 05:25:51.523 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:2: true
2025-05-16 05:25:51.523 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 05:25:51.524 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:2 unchanged
2025-05-16 05:25:51.524 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 05:25:51.524 INFO  [main] c.s.c.l.SignalProtocolManager - Message encrypted for bob:2 (isPreKeyMessage=true)
2025-05-16 05:25:51.527 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (preKey: false)
2025-05-16 05:25:51.527 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 05:25:51.528 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 05:25:51.529 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Message from alice (type CIPHERTEXT):
2025-05-16 05:25:51.529 DEBUG [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Attempting to decrypt message from alice:1 as PreKeySignalMessage
2025-05-16 05:25:51.533 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 05:25:51.533 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for alice:1: true
2025-05-16 05:25:51.533 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 05:25:51.534 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:25:51.534 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 05:25:51.535 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12898
2025-05-16 05:25:51.536 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 05:25:51.536 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Identity for address alice:1 unchanged
2025-05-16 05:25:51.537 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 05:25:51.538 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 2001
2025-05-16 05:25:51.538 INFO  [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Successfully decrypted PreKeySignalMessage from alice:1
2025-05-16 05:25:51.539 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Decrypted message: TestTestTest
2025-05-16 05:28:27.225 INFO  [main] com.securechat.Launcher - Initializing preKeyStore and keyStores
2025-05-16 05:28:27.297 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 3164
2025-05-16 05:28:27.299 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1
2025-05-16 05:28:27.330 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1
2025-05-16 05:28:27.331 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1
2025-05-16 05:28:27.331 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:27.332 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1
2025-05-16 05:28:27.337 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1
2025-05-16 05:28:27.338 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1
2025-05-16 05:28:27.338 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1, signedPreKeyId=1
2025-05-16 05:28:27.339 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12100
2025-05-16 05:28:27.339 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 1001
2025-05-16 05:28:27.339 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 1001
2025-05-16 05:28:27.340 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 1001
2025-05-16 05:28:27.340 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:27.340 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 1002
2025-05-16 05:28:27.341 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 1002
2025-05-16 05:28:27.342 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 1002
2025-05-16 05:28:27.342 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=1001, signedPreKeyId=1002
2025-05-16 05:28:27.343 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Generated new IdentityKeyPair and registrationId 12554
2025-05-16 05:28:27.344 DEBUG [main] com.securechat.crypto.KeyManager - Generating PreKeyRecord with id 2001
2025-05-16 05:28:27.344 INFO  [main] com.securechat.crypto.KeyManager - Generated PreKeyRecord with id 2001
2025-05-16 05:28:27.345 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored PreKey with ID: 2001
2025-05-16 05:28:27.345 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:27.345 DEBUG [main] com.securechat.crypto.KeyManager - Generating SignedPreKeyRecord with id 2002
2025-05-16 05:28:27.347 INFO  [main] com.securechat.crypto.KeyManager - Generated SignedPreKeyRecord with id 2002
2025-05-16 05:28:27.347 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored SignedPreKey with ID: 2002
2025-05-16 05:28:27.348 DEBUG [main] com.securechat.Launcher - Initialized keys: preKeyId=2001, signedPreKeyId=2002
2025-05-16 05:28:27.352 INFO  [main] com.securechat.Launcher - Server started on message port 8888 and prekey port 9999
2025-05-16 05:28:27.356 INFO  [ServerThread] com.securechat.server.Server - SecureChat server started on message port 8888 and preKey port 9999
2025-05-16 05:28:29.359 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:52057
2025-05-16 05:28:29.359 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:52058
2025-05-16 05:28:29.369 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12554
2025-05-16 05:28:29.369 DEBUG [pool-1-thread-1] com.securechat.server.Server - Received userId 'bob'
2025-05-16 05:28:29.370 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12554, deviceId=2, preKeyId=2001, signedPreKeyId=2002
2025-05-16 05:28:29.370 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 05:28:29.370 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 2001
2025-05-16 05:28:29.370 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 05:28:29.370 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 2002
2025-05-16 05:28:29.371 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:29.371 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 05:28:29.372 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 05:28:29.372 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12554, deviceId=2
2025-05-16 05:28:29.373 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 05:28:29.378 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as 'bob'
2025-05-16 05:28:29.379 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered prekey bundle for user 'bob'
2025-05-16 05:28:29.380 INFO  [pool-1-thread-1] c.securechat.network.MessageRouter - Registered peer connection for user 'bob'
2025-05-16 05:28:29.380 INFO  [pool-1-thread-1] com.securechat.server.Server - Registered user 'bob' with message router
2025-05-16 05:28:29.380 INFO  [ServerThread] com.securechat.server.Server - Accepted message connection from /127.0.0.1:52059
2025-05-16 05:28:29.381 INFO  [ServerThread] com.securechat.server.Server - Accepted preKey connection from /127.0.0.1:52060
2025-05-16 05:28:29.382 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12100
2025-05-16 05:28:29.382 DEBUG [pool-1-thread-3] com.securechat.server.Server - Received userId 'alice'
2025-05-16 05:28:29.382 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Building PreKeyBundle with registrationId=12100, deviceId=1, preKeyId=1001, signedPreKeyId=1002
2025-05-16 05:28:29.383 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 05:28:29.383 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded PreKeyRecord for id 1001
2025-05-16 05:28:29.383 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 05:28:29.384 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - Loaded SignedPreKeyRecord for id 1002
2025-05-16 05:28:29.384 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:29.384 DEBUG [main] c.s.c.libsignal.PreKeyBundleBuilder - Using identity public key for PreKeyBundle
2025-05-16 05:28:29.385 INFO  [main] c.s.c.libsignal.PreKeyBundleBuilder - PreKeyBundle successfully built
2025-05-16 05:28:29.385 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting PreKeyBundle to DTO for registrationId=12100, deviceId=1
2025-05-16 05:28:29.385 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundleDTO created successfully
2025-05-16 05:28:29.386 INFO  [main] com.securechat.client.UserClient - Registered prekey bundle with server as 'alice'
2025-05-16 05:28:29.386 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered prekey bundle for user 'alice'
2025-05-16 05:28:29.387 INFO  [pool-1-thread-3] c.securechat.network.MessageRouter - Registered peer connection for user 'alice'
2025-05-16 05:28:29.387 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:1: false
2025-05-16 05:28:29.387 INFO  [pool-1-thread-3] com.securechat.server.Server - Registered user 'alice' with message router
2025-05-16 05:28:29.387 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 05:28:29.388 DEBUG [main] c.s.c.l.SignalProtocolManager - Session check for bob returned false
2025-05-16 05:28:29.389 INFO  [pool-1-thread-4] com.securechat.server.Server - Sent preKey bundle for 'bob'
2025-05-16 05:28:29.390 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12554, deviceId=2
2025-05-16 05:28:29.390 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 05:28:29.391 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with bob:2
2025-05-16 05:28:29.393 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address bob:2, trusting first seen key
2025-05-16 05:28:29.401 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 05:28:29.409 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:29.439 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12100
2025-05-16 05:28:29.440 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 05:28:29.440 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: bob:2
2025-05-16 05:28:29.441 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 05:28:29.441 INFO  [main] c.s.c.l.SignalProtocolManager - Session successfully initialized with bob:2
2025-05-16 05:28:29.441 INFO  [main] com.securechat.client.UserClient - Session established with bob
2025-05-16 05:28:29.442 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address alice:1: false
2025-05-16 05:28:29.442 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Current stored sessions: []
2025-05-16 05:28:29.442 DEBUG [main] c.s.c.l.SignalProtocolManager - Session check for alice returned false
2025-05-16 05:28:29.443 INFO  [pool-1-thread-2] com.securechat.server.Server - Sent preKey bundle for 'alice'
2025-05-16 05:28:29.443 DEBUG [main] c.s.crypto.libsignal.PreKeyBundleDTO - Converting DTO to PreKeyBundle for registrationId=12100, deviceId=1
2025-05-16 05:28:29.444 INFO  [main] c.s.crypto.libsignal.PreKeyBundleDTO - PreKeyBundle conversion successful
2025-05-16 05:28:29.444 DEBUG [main] c.s.c.l.SignalProtocolManager - Initializing session with alice:1
2025-05-16 05:28:29.444 WARN  [main] c.s.crypto.libsignal.SignalKeyStore - No trusted identity for address alice:1, trusting first seen key
2025-05-16 05:28:29.445 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 05:28:29.446 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:29.448 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12554
2025-05-16 05:28:29.448 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 05:28:29.449 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - New identity saved/updated for address: alice:1
2025-05-16 05:28:29.449 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 05:28:29.449 INFO  [main] c.s.c.l.SignalProtocolManager - Session successfully initialized with alice:1
2025-05-16 05:28:29.449 INFO  [main] com.securechat.client.UserClient - Session established with alice
2025-05-16 05:28:31.450 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address bob:2: true
2025-05-16 05:28:31.451 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 05:28:31.468 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:2: true
2025-05-16 05:28:31.468 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 05:28:31.468 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:2 unchanged
2025-05-16 05:28:31.468 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 05:28:31.469 INFO  [main] c.s.c.l.SignalProtocolManager - Message encrypted for bob:2 (isPreKeyMessage=true)
2025-05-16 05:28:31.471 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to bob (preKey: false)
2025-05-16 05:28:31.472 INFO  [pool-1-thread-3] com.securechat.server.Server - Routing message from 'alice' to 'bob'
2025-05-16 05:28:31.472 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Contains session for address alice:1: true
2025-05-16 05:28:31.472 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 05:28:31.473 DEBUG [pool-1-thread-3] c.securechat.network.MessageRouter - Routed message from 'alice' to 'bob'
2025-05-16 05:28:31.474 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Message from alice (type CIPHERTEXT):
2025-05-16 05:28:31.474 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for alice:1: true
2025-05-16 05:28:31.475 DEBUG [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Attempting to decrypt message from alice:1 as PreKeySignalMessage
2025-05-16 05:28:31.475 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 05:28:31.475 DEBUG [main] c.s.crypto.libsignal.SignalKeyStore - Identity for address alice:1 unchanged
2025-05-16 05:28:31.475 INFO  [main] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 05:28:31.475 INFO  [main] c.s.c.l.SignalProtocolManager - Message encrypted for alice:1 (isPreKeyMessage=true)
2025-05-16 05:28:31.476 INFO  [main] com.securechat.client.UserClient - Sent CIPHERTEXT message to alice (preKey: false)
2025-05-16 05:28:31.476 INFO  [pool-1-thread-1] com.securechat.server.Server - Routing message from 'bob' to 'alice'
2025-05-16 05:28:31.477 DEBUG [pool-1-thread-1] c.securechat.network.MessageRouter - Routed message from 'bob' to 'alice'
2025-05-16 05:28:31.478 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: alice:1
2025-05-16 05:28:31.478 INFO  [UserClient-Listener-alice] com.securechat.client.UserClient - Message from bob (type CIPHERTEXT):
2025-05-16 05:28:31.478 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for alice:1: true
2025-05-16 05:28:31.478 DEBUG [UserClient-Listener-alice] c.s.c.l.SignalProtocolManager - Attempting to decrypt message from bob:2 as PreKeySignalMessage
2025-05-16 05:28:31.479 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 2002
2025-05-16 05:28:31.480 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:31.480 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 2001
2025-05-16 05:28:31.481 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12554
2025-05-16 05:28:31.481 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: alice:1
2025-05-16 05:28:31.482 DEBUG [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Identity for address alice:1 unchanged
2025-05-16 05:28:31.483 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: alice:1
2025-05-16 05:28:31.483 INFO  [UserClient-Listener-bob] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 2001
2025-05-16 05:28:31.484 INFO  [UserClient-Listener-bob] c.s.c.l.SignalProtocolManager - Successfully decrypted PreKeySignalMessage from alice:1
2025-05-16 05:28:31.484 DEBUG [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Loading session for address: bob:2
2025-05-16 05:28:31.484 INFO  [UserClient-Listener-bob] com.securechat.client.UserClient - Decrypted message: Hi Bob!
2025-05-16 05:28:31.484 DEBUG [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Is trusted identity for bob:2: true
2025-05-16 05:28:31.484 DEBUG [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Loading SignedPreKey with ID: 1002
2025-05-16 05:28:31.484 DEBUG [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Retrieving IdentityKeyPair
2025-05-16 05:28:31.485 DEBUG [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Loading PreKey with ID: 1001
2025-05-16 05:28:31.486 DEBUG [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Retrieving local registration ID: 12100
2025-05-16 05:28:31.486 DEBUG [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Saving identity for address: bob:2
2025-05-16 05:28:31.487 DEBUG [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Identity for address bob:2 unchanged
2025-05-16 05:28:31.488 INFO  [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Stored session for address: bob:2
2025-05-16 05:28:31.488 INFO  [UserClient-Listener-alice] c.s.crypto.libsignal.SignalKeyStore - Removed PreKey with ID: 1001
2025-05-16 05:28:31.488 INFO  [UserClient-Listener-alice] c.s.c.l.SignalProtocolManager - Successfully decrypted PreKeySignalMessage from bob:2
2025-05-16 05:28:31.489 INFO  [UserClient-Listener-alice] com.securechat.client.UserClient - Decrypted message: Hi Alice!
